---
displayed_sidebar: English
---

# 特性

StarRocks 提供了丰富的功能集，以在大规模数据上提供极速的实时分析体验。

## MPP 架构

StarRocks 采用了大规模并行处理（MPP）架构。一个查询请求会被分割成多个物理计算单元，这些单元可以在多台机器上并行执行。每台机器都配备了专用的 CPU 和内存资源。MPP 架构充分利用了所有 CPU 核心和机器的资源，随着集群的扩展，单个查询的性能可以持续提升。

![MPP](../assets/1.1-3-mpp.png)

如上图所示，StarRocks 根据 SQL 语句的语义，将其解析为多个逻辑执行单元（查询片段）。然后，根据计算复杂性，每个片段由一个或多个物理执行单元（片段实例）实现。物理执行单元是 StarRocks 中最小的调度单元。它们将被调度至后端（BE）执行。一个逻辑执行单元可以包含一个或多个操作符，如图右侧所示的 Scan、Project 和 Agg 操作符。每个物理执行单元仅处理部分数据，最终的结果将被合并。**逻辑执行单元的并行执行充分利用了所有 CPU 核心和物理机器的资源，加速了查询速度。**

![MPP](../assets/1.1-4-mpp.png)

与许多其他数据分析系统使用的 Scatter-Gather 架构不同，MPP 架构能够利用更多资源来处理查询请求。在 Scatter-Gather 架构中，只有 Gather 节点可以执行最终的合并操作。在 MPP 架构中，数据会被分发到多个节点上进行合并操作。对于如高基数字段的 Group By 和大表连接等复杂查询，StarRocks 的 MPP 架构相较于 Scatter-Gather 架构具有显著的性能优势。

## 全矢量化执行引擎

全矢量化执行引擎更高效地利用 CPU 处理能力，因为此引擎以列式方式组织和处理数据。具体而言，StarRocks 存储数据、在内存中组织数据以及计算 SQL 操作符均采用列式方式。列式组织充分利用了 CPU 缓存，列式计算减少了虚拟函数调用和分支判断，从而实现了更高效的 CPU 指令流。

矢量化执行引擎还充分利用 SIMD 指令，能够用更少的指令完成更多的数据操作。标准数据集上的测试显示，这种引擎使得操作符的整体性能提升了 3 至 10 倍。

除了操作符矢量化之外，StarRocks 还对查询引擎进行了其他优化。例如，StarRocks 使用编码数据操作技术，可以直接在编码的字符串上执行操作符，无需解码。这显著降低了 SQL 的复杂性，并使查询速度提高了两倍以上。

## 存储与计算分离

从 3.0 版本开始，StarRocks 引入了[存储与计算分离架构](./Architecture.md)。在此架构下，计算与存储被解耦，以实现资源隔离、计算节点的弹性伸缩和高性能查询。存储与计算分离为 StarRocks 带来了更好的灵活性、更高的性能和数据可用性，以及更低的成本。

![shared-data](../assets/share_data_arch.png)

在存储与计算分离模式下，计算和存储被解耦，可以独立扩展，这消除了在存储与计算耦合模式中存在的问题，即每当用户想要添加计算节点时就必须扩展存储的成本。此外，计算可以在几秒钟内动态伸缩，提高了资源利用率，特别是在流量高峰和低谷时。

存储层利用对象存储的几乎无限容量和高可靠性来实现海量数据存储和持久化。StarRocks 可以与 AWS S3、Google Cloud Storage、Azure Blob Storage、HDFS 以及 MinIO 等其他 S3 兼容存储系统配合使用。

用户可以选择将 StarRocks 部署在公有云、私有云或本地数据中心。StarRocks 支持基于 Kubernetes 的部署，并提供了 Operator 用于自动化部署存储与计算解耦的集群。

在存储与计算分离模式下，StarRocks 提供与存储与计算耦合模式相同的功能。数据写入和热数据查询的性能也相同。用户可以像在存储与计算耦合模式下一样，执行数据更新、数据湖分析和物化视图加速。

有关如何部署存储与计算解耦的 StarRocks 集群的信息，请参见[部署共享数据](../deployment/shared_data/s3.md)集群。

## 基于成本的优化器（CBO）

![CBO](../assets/1.1-5-cbo.png)

多表连接查询的性能优化是一项挑战。仅凭执行引擎无法实现最佳性能，因为在多表连接查询场景中，执行计划的复杂度可能会有巨大差异。关联的表越多，可能的执行计划就越多，选择最优计划变得非常困难，这是一个 NP 难问题。只有出色的查询优化器才能为高效的多表分析选择一个相对最优的查询计划。

StarRocks 从零开始设计了一个全新的 [CBO](../using_starrocks/Cost_based_optimizer.md)。这个 CBO 采用了类似级联的框架，并针对矢量化执行引擎进行了深度定制，包括了许多优化和创新。这些优化包括公共表达式（CTE）的重用、子查询的改写、横向连接（Lateral Join）、连接重排、分布式连接执行策略的选择以及低基数优化。CBO 支持共 99 条 TPC-DS SQL 语句。

CBO 使 StarRocks 在多表连接查询中的性能超越了竞争对手，尤其是在复杂的多表连接查询中。

## 实时、可更新的列式存储引擎

StarRocks 是一个列式存储引擎，允许同类型数据连续存储。在列式存储中，数据可以更有效地编码，提高了压缩比率并降低了存储成本。列式存储也减少了总体数据读取 I/O，从而提高查询性能。此外，在大多数 OLAP 场景中，通常只查询特定的列。列式存储允许用户只查询部分列，显著减少了磁盘 I/O。

StarRocks 能够在几秒内加载数据，实现近乎实时的分析。StarRocks 的存储引擎确保了每次数据摄取操作的原子性、一致性、隔离性和持久性（ACID）。对于数据加载事务，整个事务要么全部成功，要么全部失败。并发事务不会相互影响，实现了事务级别的隔离。

![Realtime](../assets/1.1-6-realtime.png)

StarRocks 的存储引擎采用删除-插入模式，支持高效的部分更新和插入更新（Upsert）操作。存储引擎可以快速通过主键索引来过滤数据，无需在数据读取时进行排序和合并操作。引擎还可以充分利用二级索引，在大量数据更新的情况下，仍能提供快速且可预测的查询性能。

## 智能物化视图

StarRocks 通过智能[物化视图](../using_starrocks/Materialized_view.md)加速查询和数据仓库层次化。与其他类似产品的物化视图不同，需要手动数据同步，StarRocks' 物化视图会根据基表数据变化自动更新，无需额外维护操作。此外，物化视图的选择也是自动的。如果 StarRocks 确定合适的物化视图（MV）以提升查询性能，它会自动重写查询以利用该 MV。这一智能过程显著增强了查询效率，无需人工干预。

StarRocks 的 MV 可以替代传统的 ETL 数据建模流程：您现在可以选择在 StarRocks 中使用 MV 转换数据，而不是在上游应用中进行转换，简化了数据处理流程。

例如，如图所示，可以使用数据湖上的原始数据，基于外部 MV 创建规范化表。然后，可以通过异步物化视图从规范化表创建非规范化表。另外，可以从规范化表创建 MV，以支持高并发查询和更好的查询性能。

![MV](../assets/1.1-7-mv.png)

## 数据湖分析

![DLA](../assets/1.1-8-dla.png)

StarRocks 不仅能高效分析本地数据，还可以作为计算引擎分析存储在 [data lakes](../data_source/catalog/catalog_overview.md) such as Apache Hive, Apache Iceberg, Apache Hudi, 和 Delta Lake 等数据湖中的数据。StarRocks 的关键特性之一是其外部目录，它作为与外部维护的元数据存储的链接。这一功能为用户提供了无缝查询外部数据源的能力，消除了数据迁移的需要。因此，用户可以分析来自不同系统（如 HDFS 和 Amazon S3）的数据，并支持多种文件格式，如 Parquet、ORC 和 CSV 等。

上图展示了一个数据湖分析场景，其中 StarRocks 负责数据计算和分析，数据湖负责数据的存储、组织和维护。数据湖允许用户以开放存储格式存储数据，并使用灵活的模式为不同的 BI、AI、即席查询和报告用例生成基于“单一数据源”的报告。StarRocks 充分利用其矢量化引擎和 CBO 的优势，显著提升了数据湖分析的性能。
