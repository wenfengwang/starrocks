---
displayed_sidebar: English
---

# 数组映射

## 描述

array_map() 是一个高阶 SQL 函数，它能够接受 lambda 函数作为参数。此函数对输入数组应用 lambda 函数，并返回一个新的数组。

array_map() 能够接收多个数组，并且能够与 lambda 函数嵌套，以便捕获变量。想要了解更多关于 lambda 函数的信息，请参见 [Lambda expression](../Lambda_expression.md)。该函数从 v2.5 版本开始支持。

此函数的别名是 transform()。

## 语法

```Haskell
array_map(lambda_function, arr1, arr2...)
array_map(arr1, arr2..., lambda_function)
```

## 使用说明

- Lambda 函数只能作为高阶函数的**第一个**参数或**最后一个**参数使用。参数的位置不会影响计算结果。
- 数组的数量必须与 lambda 函数中的输入参数数量相匹配。如果不相同，将返回错误。
- 所有数组都必须具有相同的元素个数。如果不一致，将返回错误。

## 示例

示例 1：将数组中的每个元素增加 100。

```Plain
select array_map(x -> x+100,[1,2,3]);
+------------------------------------+
| array_map(x -> x + 100, [1, 2, 3]) |
+------------------------------------+
| [101,102,103]                      |
+------------------------------------+
```

示例 2：逐个元素对 array1 [1,2,3] 和 array2 [11,12,13] 进行求和。

```Plain
select array_map((x,y) -> x + y, [1,2,3], [11,12,13]);
+-----------------------------------------------------+
| array_map((x, y) -> x + y, [1, 2, 3], [11, 12, 13]) |
+-----------------------------------------------------+
| [12,14,16]                                          |
+-----------------------------------------------------+
```

示例 3：判断 x 中的元素是否大于 1.5。如果大于，返回该元素的 log(x)；如果不大于，返回对应元素的 (x+y)。

```Plain
select array_map((x,y) -> if(x>1.5,log(x),x+y), [1,2,3], [11,12,13]);
+--------------------------------------------------------------------------+
| array_map((x, y) -> if(x > 1.5, log(x), x + y), [1, 2, 3], [11, 12, 13]) |
+--------------------------------------------------------------------------+
| [12,0.6931471805599453,1.0986122886681098]                               |
+--------------------------------------------------------------------------+
```

示例 4：使用 array_map() 捕获变量。返回值为 1 的元素表示条件得到满足。

```Plain
-- In the example table, last_avg is the average score in the last exam. score represents the scores of three subjects in the current exam.

+------+----------+------------+
| id   | last_avg | score      |
+------+----------+------------+
|    1 |       55 | [50,60,70] |
|    2 |       73 | [70,65,75] |
|    3 |       89 | [88,92,90] |
+------+----------+------------+

-- Find the score that is higher than the average score of the last exam.
select array_map(x -> x > last_avg, score) from test_tbl;
+--------------------------------------+
| array_map(x -> x > last_avg, score)  |
+--------------------------------------+
| [0,1,1]                              |
| [0,0,1]                              |
| [0,1,1]                              |
+--------------------------------------+
```

示例 5：使用嵌套的 lambda 函数。

```Plain
select array_map(x -> array_map(x->x+100, x),[[1,2.3],[4,3,2]]);
+-------------------------------------------------------------------+
| array_map(x -> array_map(x -> x + 100, x), [[1, 2.3], [4, 3, 2]]) |
+-------------------------------------------------------------------+
| [[101,102.3],[104,103,102]]                                       |
+-------------------------------------------------------------------+
```

示例 6：由于数组数量与 lambda 参数的数量不一致，返回错误。lambda 函数仅需要一个数组，但却传入了两个数组。

```Plain
select array_map(x -> x,[1],[2,4]);
ERROR 1064 (HY000): Lambda arguments should equal to lambda input arrays.
```
