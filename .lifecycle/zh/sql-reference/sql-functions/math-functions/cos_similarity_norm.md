---
displayed_sidebar: English
---

# 余弦相似度标准化

## 描述

通过计算两个标准化向量间角度的余弦值来衡量两个向量的相似性。这里的角度是由向量的方向所决定的，同时忽略它们的幅度差异。此函数假设输入的向量已经过标准化。如果你需要在计算余弦相似度之前对向量进行标准化，请使用[cosine_similarity](./cos_similarity.md)函数。

相似度的取值范围在-1到1之间。向量间的角度越小，余弦相似度越高。

- 如果两个向量方向相同，则它们之间的角度为0度，余弦相似度为1。
- 垂直的向量间的角度为90度，其余弦相似度为0。
- 方向相反的向量间的角度为180度，其余弦相似度为-1。

## 语法

```Haskell
cosine_similarity_norm(a, b)
```

## 参数

a和b是需要比较的向量。它们必须具有相同的维度。支持的数据类型为Array<float>。两个数组必须具有相同的元素数量，否则会返回错误。

## 返回值

返回一个介于[-1, 1]范围内的FLOAT值。如果任何输入参数为空或无效，将报告错误。

## 示例

1. 创建一个表格以存储向量，并向该表格插入数据。

   ```SQL
   CREATE TABLE t1_similarity 
   (id int, data array<float>)
   DISTRIBUTED BY HASH(id);
   
   INSERT INTO t1_similarity VALUES
   (1, array<float>[0.1, 0.2, 0.3]), 
   (2, array<float>[0.2, 0.1, 0.3]), 
   (3, array<float>[0.3, 0.2, 0.1]);
   ```

2. 计算数据列中每一行与数组[0.1, 0.2, 0.3]的相似度，并按降序排列结果。

   ```Plain
   SELECT id, data, cosine_similarity_norm([0.1, 0.2, 0.3], data) as dist
   FROM t1_similarity 
   ORDER BY dist DESC;
   
   +------+---------------+------------+
   | id   | data          | dist       |
   +------+---------------+------------+
   |    1 | [0.1,0.2,0.3] | 0.14000002 |
   |    2 | [0.2,0.1,0.3] | 0.13000001 |
   |    3 | [0.3,0.2,0.1] | 0.10000001 |
   +------+---------------+------------+
   ```
