---
displayed_sidebar: English
---

# 用户自定义变量

本主题将介绍如何声明和使用用户自定义变量。

StarRocks 2.5及更高版本支持用户自定义变量。这些变量用于存储特定值，以便在后续的SQL语句中引用，从而简化SQL语句的编写并避免重复计算。

## 使用须知

- 用户自定义变量是用户可以创建的变量，并且只存在于当前会话中。这意味着其他用户无法访问某个用户声明的自定义变量，并且当会话结束时这些变量将失效。
- StarRocks 不支持使用 SHOW 语句来查看现有的用户自定义变量。
- 以下类型的值不能被声明为用户自定义变量：BITMAP、HLL、PERCENTILE 和 ARRAY。JSON 类型的用户自定义变量在存储时会被转换为 STRING 类型。

## 声明用户自定义变量

### 语法

```Plain
SET @var_name = expr [, ...];
```

> **注意**
- 所有变量前都必须加上一个 at 符号 (@)。
- 可以在同一个 SET 语句中声明多个变量，变量之间需用逗号（,）分隔。
- 可以多次声明同一个变量，新声明的值将覆盖原有值。
- 如果使用了未声明的变量，则该变量的默认值为 NULL，且 NULL 的类型为 STRING。

### 参数

|参数|必填|说明|
|---|---|---|
|var_name|Yes|用户定义变量的名称。命名规则如下：名称可以包含字母、数字（0-9）和下划线（\_）。名称长度不能超过 64 个字符。您可以将字符串声明为用户定义变量，例如 @'my-var'、@"my-var" 和 @\`my-var\`。 STRING类型的用户自定义变量可以包含字母、数字、下划线(_)以外的字符，如句点(.)。|
|expr|Yes|用户定义变量的值。您可以为此参数指定数字（例如 43）或复杂表达式（例如 SELECT 语句返回的值）。变量的数据类型与表达式返回结果的数据类型相同。|

### 示例

示例1：将一个数字声明为用户自定义变量。

```SQL
SET @var = 43;
```

示例2：将SELECT查询返回的值声明为用户自定义变量。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

示例3：在同一个SET语句中声明多个用户自定义变量。

```SQL
SET @v1=1, @v2=2;
```

## 在SQL中使用用户自定义变量

- 简化SQL语句的编写。例如，在执行以下SELECT语句时，StarRocks会将@var解析为1。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 避免重复计算。例如，在执行以下SELECT语句时，StarRocks会将@var解析为select sum(c1) from tbl命令返回的结果。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```
