---
displayed_sidebar: "English"
---

# 功能

StarRocks提供了丰富的功能集，可在大规模数据上提供快速、实时的分析体验。

## MPP框架

StarRocks采用了大规模并行处理（MPP）框架。一个查询请求会被拆分为多个物理计算单元，可以并行在多台机器上执行。每台机器都有专用的CPU和内存资源。MPP框架充分利用了所有CPU核心和机器的资源。随着集群的扩展，单个查询的性能可以持续提高。

![MPP](../assets/1.1-3-mpp.png)

在上图中，StarRocks根据语句的语义将SQL语句解析为多个逻辑执行单元（查询片段）。然后，根据计算复杂度，每个片段由一个或多个物理执行单元（片段实例）实现。物理执行单元是StarRocks中最小的调度单元。它们将被调度到后端（BE）进行执行。一个逻辑执行单元可以包含一个或多个运算符，比如扫描、投影和聚合运算符，如图右侧所示。每个物理执行单元只处理部分数据，结果将被合并生成最终数据。**逻辑执行单元的并行执行充分利用了所有CPU核心和物理机器的资源，并加速了查询速度。**

![MPP](../assets/1.1-4-mpp.png)

与许多其他数据分析系统使用的散列-聚集框架不同，MPP框架可以利用更多资源来处理查询请求。在散列-聚集框架中，只有聚集节点可以执行最终合并操作。在MPP框架中，数据被洗牌到多个节点进行合并操作。对于复杂查询，例如在高基数字段和大表连接上的分组，StarRocks的MPP框架相对于散列-聚集框架具有明显的性能优势。

## 完全矢量化执行引擎

完全矢量化执行引擎更高效地利用了CPU处理能力，因为该引擎以列式方式组织和处理数据。具体来说，StarRocks以列式组织数据、内存中组织数据并计算SQL运算符。列式组织充分利用了CPU缓存。列式计算减少了虚拟函数调用和分支判断的次数，从而提供更充分的CPU指令流。

矢量化执行引擎还充分利用了SIMD指令。该引擎可以用更少的指令完成更多的数据操作。对标准数据集的测试显示，该引擎将操作符的整体性能提高了3到10倍。

除了运算符矢量化外，StarRocks还对查询引擎实施了其他优化。例如，StarRocks使用了编码数据操作技术，在不需要解码的情况下直接在编码字符串上执行运算符。这显著降低了SQL的复杂性，并将查询速度提高了2倍以上。

## 存储和计算分离

[存储计算分离架构](./Architecture.md)是从3.0版引入的。在这种架构中，计算和存储被解耦，以实现资源隔离、计算节点的弹性扩展以及高性能的查询。存储计算分离为StarRocks提供了更好的灵活性、更高的性能和数据可用性，以及更低的成本。

![shared-data](../assets/share_data_arch.png)

在存储和计算分离模式下，计算和存储被解耦，可以独立扩展，消除了在存储-计算耦合模式中长期存在的存储随时扩展的成本。此外，计算可以在几秒内动态扩展，在明显的流量高峰和低谷时尤其提高了资源利用率。

存储层利用对象存储的几乎无限容量和高可靠性来实现大规模数据存储和数据持久性。StarRocks可以与各种对象存储系统配合使用，如AWS S3、Google Cloud Storage、Azure Blob Storage、HDFS以及其他兼容S3的存储，比如MinIO。

用户可以选择在公共云、私有云或本地数据中心部署StarRocks。StarRocks支持基于Kubernetes的部署，并提供了用于自动部署存储计算分离的集群的Operator。

存储计算分离模式下的StarRocks提供了与存储计算耦合模式相同的功能。数据写入和热数据查询性能也是相同的。用户可以像在存储计算耦合模式中那样执行数据更新、数据湖分析和材料化视图加速。

有关如何部署具有存储和计算分离的StarRocks集群的信息，请参见[部署共享数据集群](../deployment/shared_data/s3.md)。

## 基于成本的优化器

![CBO](../assets/1.1-5-cbo.png)

优化多表连接查询的性能是困难的。仅仅依靠执行引擎是无法实现卓越性能的，因为在多表连接查询场景中，执行计划的复杂度可能有几个数量级的差异。表关联的数量越多，执行计划就越多，这使得为高效的多表分析选择最佳计划成为NP-难问题。只有足够出色的查询优化器才能为复杂的多表分析选择相对最佳的查询计划。

StarRocks从头开始设计了一个全新的[CBO](../using_starrocks/Cost_based_optimizer.md)。这个CBO采用了类似级联的框架，并且针对矢量化执行引擎进行了深度定制，具有多个优化和创新。这些优化包括通用表达式（CTEs）的重用、子查询的重写、Lateral Join、Join Reorder、分布式Join执行的策略选择以及低基数优化。CBO支持共计99个TPC-DS SQL语句。

CBO使StarRocks能够在复杂的多表连接查询中提供比竞争对手更好的性能。

## 实时、可更新的列式存储引擎

StarRocks是一个列式存储引擎，允许相同类型的数据连续存储。在列式存储中，数据可以以更高效的方式进行编码，增加了压缩比并降低了存储成本。列式存储还减少了总数据读取的I/O操作，提高了查询性能。此外，在大多数OLAP场景中，只查询特定列。列式存储使用户只能查询部分列，大大减少了磁盘I/O。

StarRocks可以在几秒内加载数据，进行几乎实时的分析。StarRocks的存储引擎保证了每次数据摄入操作的原子性、一致性、隔离性和持久性（ACID）。对于数据加载事务，整个事务要么成功，要么失败。并发事务不会相互影响，提供了事务级的隔离。
 
![Realtime](../assets/1.1-6-realtime.png)

StarRocks的存储引擎采用删除-插入模式，可以进行高效的部分更新和Upsert操作。存储引擎可以快速使用主键索引过滤数据，消除了数据读取时排序和合并操作的需求。该引擎还充分利用了二级索引。即使在大量数据更新的情况下，它也能提供快速而可预测的查询性能。

## 智能材料化视图

StarRocks使用智能[材料化视图](../using_starrocks/Materialized_view.md)来加速查询和数据仓库层。与其他类似产品的材料化视图不同，StarRocks的材料化视图在不需要与基表进行手动数据同步的情况下，自动根据基表数据变化进行数据更新。此外，材料化视图的选择也是自动的。如果StarRocks发现了一个可用的材料化视图（MV）来改进查询性能，它将自动重写查询以利用这个MV。这一智能的过程显著提高了查询效率，而无需手动干预。

StarRocks的MV可以取代传统的ETL数据建模过程：现在您可以选择在StarRocks中使用MV来转换上游应用程序中的数据，简化数据处理流程。

例如，在图中，数据湖上的原始数据可用于基于外部MV创建一个归一化表。通过异步材料化视图，可以从归一化表创建一个非归一化表。可以从归一化表创建另一个MV以支持高并发查询和更好的查询性能。

![MV](../assets/1.1-7-mv.png)

## 数据湖分析

![DLA](../assets/1.1-8-dla.png)

除了对本地数据进行高效的分析之外，StarRocks还可以作为计算引擎来分析存储在[data lakes](../data_source/catalog/catalog_overview.md)中的数据，例如Apache Hive、Apache Iceberg、Apache Hudi和Delta Lake等。StarRocks的一个关键特性是其外部目录，它充当对外部维护的元数据存储的连接点。此功能使用户能够无缝地查询外部数据源，消除了数据迁移的需求。因此，用户可以分析来自不同系统（如HDFS和Amazon S3）的数据，以及来自Parquet、ORC、CSV等各种文件格式的数据。

上图显示了一个数据湖分析场景，在这个场景中，StarRocks负责进行数据计算和分析，而数据湖负责数据存储、组织和维护。数据湖允许用户将数据存储在开放式存储格式中，并使用灵活的架构在“单一真相源”上生成BI、AI、自适应和报表用例的报告。StarRocks充分利用其矢量化引擎和CBO的优势，显著提高了数据湖分析的性能。