---
displayed_sidebar: "Chinese"
---

# array_map

## 描述

array_map()是一个高阶SQL函数，可以接受lambda函数作为参数。它将lambda函数应用于输入数组，并返回一个新数组。

array_map()可以接受多个数组，并且可以嵌套使用lambda函数来捕获变量。有关lambda函数的更多信息，请参见[Lambda表达式](../Lambda_expression.md)。此函数从v2.5开始受支持。

别名为transform()。

## 语法

```Haskell
array_map(lambda_function, arr1, arr2...)
array_map(arr1, arr2..., lambda_function)
```

## 使用注意事项

- Lambda函数只能用作高阶函数的**第一个**或**最后一个**参数。其位置不影响计算。
- 数组的数量必须与lambda函数中的输入参数相同。否则会返回错误。
- 所有数组必须具有相同数量的元素。否则会返回错误。

## 示例

示例 1：将数组的每个元素增加100。

```Plain
select array_map(x -> x + 100, [1, 2, 3]);
+------------------------------------+
| array_map(x -> x + 100, [1, 2, 3]) |
+------------------------------------+
| [101, 102, 103]                     |
+------------------------------------+
```

示例 2：逐个对数组1 [1,2,3] 和数组2 [11,12,13] 求和。

```Plain
select array_map((x, y) -> x + y, [1, 2, 3], [11, 12, 13]);
+-----------------------------------------------------+
| array_map((x, y) -> x + y, [1, 2, 3], [11, 12, 13]) |
+-----------------------------------------------------+
| [12, 14, 16]                                         |
+-----------------------------------------------------+
```

示例 3：确定`x`中的元素是否大于1.5。如果是，则返回元素的log(x)。如果不是，则返回对应元素的(x + y)。

```Plain
select array_map((x, y) -> if(x > 1.5, log(x), x + y), [1, 2, 3], [11, 12, 13]);
+--------------------------------------------------------------------------+
| array_map((x, y) -> if(x > 1.5, log(x), x + y), [1, 2, 3], [11, 12, 13]) |
+--------------------------------------------------------------------------+
| [12, 0.6931471805599453, 1.0986122886681098]                            |
+--------------------------------------------------------------------------+
```

示例 4：使用array_map()来捕获变量。返回值为1表示满足条件。

```Plain
-- 在示例表中，last_avg是上次考试的平均分。score表示当前考试的三门科目的分数。

+------+----------+------------+
| id   | last_avg | score      |
+------+----------+------------+
|    1 |       55 | [50, 60, 70]|
|    2 |       73 | [70, 65, 75]|
|    3 |       89 | [88, 92, 90]|
+------+----------+------------+

-- 查找高于上次考试平均分的分数。
select array_map(x -> x > last_avg, score) from test_tbl;
+--------------------------------------+
| array_map(x -> x > last_avg, score)  |
+--------------------------------------+
| [0, 1, 1]                            |
| [0, 0, 1]                            |
| [0, 1, 1]                            |
+--------------------------------------+
```

示例 5：使用嵌套lambda函数。

```Plain
select array_map(x -> array_map(x -> x + 100, x), [[1, 2.3], [4, 3, 2]]);
+-------------------------------------------------------------------+
| array_map(x -> array_map(x -> x + 100, x), [[1, 2.3], [4, 3, 2]]) |
+-------------------------------------------------------------------+
| [[101, 102.3], [104, 103, 102]]                                  |
+-------------------------------------------------------------------+
```

示例 6：因数组数量和lambda参数不一致而返回错误。lambda函数只需要一个数组，但传入了两个数组。

```Plain
select array_map(x -> x, [1], [2, 4]);
ERROR 1064 (HY000): Lambda arguments should equal to lambda input arrays.
```