---
displayed_sidebar: "Chinese"
---

# 数据加载

## 1. 如果出现“关闭索引通道失败”或“太多的tablet版本”错误，我该怎么办？

您运行了加载作业的频率过高，并且数据未能及时压缩。结果，加载过程中生成的数据版本数量超过了允许的最大数据版本数（默认为1000）。请使用以下方法之一解决此问题：

- 增加每个单独作业中加载的数据量，从而减少加载频率。

- 修改每个BE的BE配置文件**be.conf**中的配置项，从而加速数据压缩：

    ```Plain
    cumulative_compaction_num_threads_per_disk = 4
    base_compaction_num_threads_per_disk = 2
    cumulative_compaction_check_interval_seconds = 2
    ```

  修改上述配置项后，必须观察内存和I/O，确保它们处于正常状态。

## 2. 如果出现“标签已存在”错误，我该怎么办？

此错误是因为加载作业与同一StarRocks数据库中已成功运行或正在运行的另一个加载作业具有相同标签。

Stream Load作业按照HTTP进行提交。通常，所有编程语言的HTTP客户端中都嵌入了请求重试逻辑。当StarRocks集群从HTTP客户端接收到加载作业请求后，立即开始处理该请求，但未能及时将作业结果返回给HTTP客户端。因此，HTTP客户端再次发送相同的加载作业请求。但是，StarRocks集群已经在处理第一个请求，因此对于第二个请求返回“标签已存在”错误。

执行以下操作，检查通过不同加载方法提交的加载作业是否具有相同标签并且重复提交：

- 查看FE日志，检查失败加载作业的标签是否记录了两次。如果标签记录了两次，则客户端已提交了两次加载作业请求。

  > **注意**
  >
  > StarRocks集群不区分基于加载方法的加载作业的标签。因此，通过不同加载方法提交的加载作业可能具有相同标签。

- 运行SHOW LOAD WHERE LABEL = "xxx"，检查具有相同标签并处于**FINISHED**状态的加载作业。

  > **注意**
  >
  > `xxx`是要检查的标签。

在提交加载作业之前，建议您计算加载数据所需的大致时间，然后相应地调整客户端侧的请求超时期限。这样，您可以防止客户端多次提交加载作业请求。

## 3. 如果出现“ETL_QUALITY_UNSATISFIED; msg:quality not good enough to cancel”错误，我该怎么办？

执行[SHOW LOAD](../../sql-reference/sql-statements/data-manipulation/SHOW_LOAD.md)，并使用返回的执行结果中的错误URL查看错误详情。

常见的数据质量错误包括：

- “将CSV字符串转换为INT失败。”

  来自源列的字符串未能被转换为匹配目的地列的数据类型。例如，`abc`未能被转换为数值。

- “输入长度超出了模式。”

  来自源列的值的长度不受目的地列支持。例如，CHAR数据类型的源列值超过了在表创建时指定的目的地列的最大长度，或者INT数据类型的源列值超出了4个字节。

- “实际列数少于模式列数。”

  在使用加载命令或语句指定的列分隔符进行解析源行后，获取的列数小于目的地表中的列数。可能的原因是加载命令或语句中指定的列分隔符与实际在该行中使用的列分隔符不同。

- “实际列数多于模式列数。”

  在使用加载命令或语句指定的列分隔符进行解析源行后，获取的列数多于目的地表中的列数。可能的原因是加载命令或语句中指定的列分隔符与实际在该行中使用的列分隔符不同。

- “小数部分长度超出模式比例。”

  来自DECIMAL类型源列的小数部分超出了指定的长度。

- “整数部分长度超出模式精度。”

  来自DECIMAL类型源列的整数部分超出了指定的长度。

- “此键没有对应的分区。”

  源行的分区列中的值不在分区范围内。

## 4. 如果RPC超时，我该怎么办？

检查每个BE的BE配置文件**be.conf**中`write_buffer_size`配置项的设置。此配置项用于控制BE上每个内存块的最大大小，默认最大大小为100 MB。如果最大大小过大，远程过程调用（RPC）可能会超时。要解决此问题，请调整BE配置文件中`write_buffer_size`和`tablet_writer_rpc_timeout_sec`配置项的设置。有关更多信息，请参见[BE配置](../../loading/Loading_intro.md#be-configurations)。

## 5. 如果“值计数与列计数不匹配”错误发生，我该怎么办？

在我的加载作业失败后，我使用作业结果中返回的错误URL检索错误详情，并发现“值计数与列计数不匹配”错误，表明源数据文件中的列数与目的地StarRocks表中的列数不匹配：

```Java
错误：值计数与列计数不匹配。期望3，实际得到1。行：2023-01-01T18:29:00Z,cpu0,80.99
错误：值计数与列计数不匹配。期望3，实际得到1。行：2023-01-01T18:29:10Z,cpu1,75.23
错误：值计数与列计数不匹配。期望3，实际得到1。行：2023-01-01T18:29:20Z,cpu2,59.44
```

出现此问题的原因如下：

加载命令或语句中指定的列分隔符与源数据文件中实际使用的列分隔符不同。在前述示例中，CSV格式的数据文件由三个用逗号（`,`）分隔的列组成。但是，在加载命令或语句中指定了`\t`作为列分隔符。因此，来自源数据文件的三列被错误地解析为一列。

请在加载命令或语句中指定逗号（`,`）作为列分隔符，然后重新提交加载作业。