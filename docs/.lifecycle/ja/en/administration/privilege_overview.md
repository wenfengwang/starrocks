---
displayed_sidebar: English
---

# 権限の概要

このトピックでは、StarRocksの権限システムの基本概念について説明します。権限は、どのユーザーがどのオブジェクトに対してどの操作を実行できるかを決定するため、データとリソースをより安全にきめ細かく管理できます。

> 注: このトピックで説明する権限は、v3.0 以降でのみ使用できます。v3.0 の権限フレームワークと構文は、以前のバージョンとは下位互換性がありません。v3.0 へのアップグレード後も、特定の操作に関する権限を除き、元の権限のほとんどは引き続き保持されます。詳細な違いについては、[アップグレードノート]を[StarRocksでサポートされる権限](privilege_item.md)でご確認ください。

StarRocksは、2つの権限モデルを採用しています：

- ロールベースのアクセス制御 (RBAC)：権限はロールに割り当てられ、そのロールはユーザーに割り当てられます。この場合、権限はロールを介してユーザーに伝達されます。
- アイデンティティベースのアクセス制御 (IBAC)：権限は直接ユーザーのアイデンティティに割り当てられます。

したがって、各ユーザーのアイデンティティの最大権限範囲は、そのアイデンティティ自身の権限と、そのユーザーのアイデンティティに割り当てられたロールの権限の和集合です。

StarRocksの権限システムを理解するための**基本概念**：

- **オブジェクト**：アクセス権を付与できるエンティティ。許可されない限りアクセスは拒否されます。オブジェクトの例には、CATALOG、DATABASE、TABLE、VIEWなどがあります。詳細については、[StarRocksでサポートされる権限](privilege_item.md)を参照してください。
- **権限**：オブジェクトへの定義されたアクセスレベル。複数の権限を使用して、オブジェクトに付与されるアクセスの粒度を制御できます。権限はオブジェクト固有です。異なるオブジェクトには異なる権限があります。権限の例には、SELECT、ALTER、DROPなどがあります。
- **ユーザー アイデンティティ**：ユーザーの一意のアイデンティティであり、権限を付与できるエンティティです。ユーザー アイデンティティは`username@'userhost'`として表され、ユーザー名とユーザーがログインするIPから構成されます。アイデンティティを使用することで属性の設定が簡素化されます。同じユーザー名を共有するユーザー アイデンティティは、同じ属性を共有します。ユーザー名に対して属性を設定すると、この属性はそのユーザー名を共有するすべてのユーザー アイデンティティに適用されます。
- **ロール**：権限を付与できるエンティティ。ロールは権限の抽象的な集合です。ロールはユーザーに割り当てることができます。また、ロールを他のロールに割り当ててロール階層を作成することもできます。データ管理を容易にするため、StarRocksはシステム定義のロールを提供します。さらに柔軟性を持たせるために、ビジネス要件に応じてカスタムロールを作成することもできます。

次の図は、RBACおよびIBAC権限モデルの下での権限管理の例を示しています。

モデルでは、オブジェクトへのアクセスは、ロールとユーザーに割り当てられた権限を通じて許可されます。ロールは、他のロールやユーザーに割り当てられます。

![権限管理](../assets/privilege-manage.png)

## オブジェクトと権限

オブジェクトには論理的な階層があり、それは表される概念と関連しています。例えば、データベースはカタログに含まれ、テーブル、ビュー、マテリアライズド ビュー、および関数はデータベースに含まれます。次の図は、StarRocksシステム内のオブジェクト階層を示しています。

![権限オブジェクト](../assets/privilege-object.png)

各オブジェクトには、付与可能な権限項目のセットがあります。これらの権限は、これらのオブジェクトに対して実行できる操作を定義します。ロールやユーザーに権限を付与または取り消すには、[GRANT](../sql-reference/sql-statements/account-management/GRANT.md)コマンドと[REVOKE](../sql-reference/sql-statements/account-management/REVOKE.md)コマンドを使用します。

## ユーザー

### ユーザー アイデンティティ

StarRocksでは、各ユーザーは一意のユーザーIDで識別されます。これは、IPアドレス（ユーザーホスト）とユーザー名で構成され、`username@'userhost'`の形式で表されます。StarRocksは、同じユーザー名でも異なるIPアドレスからのユーザーを異なるユーザー アイデンティティとして識別します。例えば、`user1@'starrocks.com'`と`user1@'mirrorship.com'`は2つの異なるユーザー アイデンティティです。

ユーザー アイデンティティの別の表現は`username@['domain']`で、`domain`はDNSによってIPアドレスのセットとして解決できるドメイン名です。`username@['domain']`は最終的に`username@'userhost'`のセットとして表されます。`userhost`の部分には`%`を使用して曖昧なマッチングが可能です。`userhost`が指定されていない場合、デフォルトは`'%'`となり、これは任意のホストからログインする同じ名前のユーザーを意味します。

### ユーザーに権限を付与する

ユーザーは権限を付与できるエンティティです。権限とロールの両方をユーザーに割り当てることができます。各ユーザー アイデンティティの最大権限範囲は、そのアイデンティティ自身の権限と、そのユーザー アイデンティティに割り当てられたロールの権限の和集合です。StarRocksは、各ユーザーが許可された操作のみを実行できるように保証します。

ほとんどの場合、**ロールを使用して権限を伝達する**ことを推奨します。例えば、ロールを作成した後、そのロールに権限を付与し、そのロールをユーザーに割り当てることができます。一時的な権限や特別な権限を付与する場合は、ユーザーに直接付与することができます。これにより、権限管理が簡素化され、柔軟性が提供されます。

## ロール

ロールは、権限を付与および取り消すことができるエンティティです。ロールは、必要なアクションを実行できるようにユーザーに割り当てることができる権限のコレクションと見なすことができます。ユーザーには複数のロールを割り当てることができるため、異なる権限セットを使用してさまざまなアクションを実行できます。管理を簡素化するために、StarRocksでは**ロールを通じて権限を管理する**ことを推奨しています。特別な権限と一時的な権限は、ユーザーに直接付与することができます。

管理を容易にするために、StarRocksは特定の権限を持つ**システム定義ロール**を提供し、日常の管理とメンテナンスの要件を満たすのに役立ちます。また、特定のビジネスニーズやセキュリティニーズに合わせて**カスタムロール**を柔軟に設定することもできます。システム定義ロールの権限範囲は変更できないことに注意してください。

ロールがアクティブ化されると、ユーザーはロールによって承認された操作を実行できます。ユーザーがログイン時に自動的にアクティブ化される**デフォルトロール**を設定できます。ユーザーは、現在のセッションでこのユーザーが所有するロールを手動でアクティブ化することもできます。

### システム定義ロール

StarRocksは、いくつかのタイプのシステム定義ロールを提供します。

![roles](../assets/privilege-role.png)

- `root`: グローバル権限を持ちます。デフォルトでは、`root` ユーザーには `root` ロールがあります。
   StarRocksクラスタが作成された後、システムは自動的にroot権限を持つrootユーザーを生成します。rootユーザーとロールはシステムの全ての権限を持っているため、リスクのある操作を防ぐために新しいユーザーとロールを作成することを推奨します。rootユーザーのパスワードは適切に保管してください。
- `cluster_admin`: クラスタ管理権限を持ち、ノード関連の操作、例えばノードの追加や削除を実行できます。
  `cluster_admin` は、クラスタノードを追加、削除、および使用停止する権限を持っています。予期しないノード変更を防ぐために、`cluster_admin` やその権限を含むカスタムロールをユーザーのデフォルトロールとして割り当てないことを推奨します。
- `db_admin`: カタログ、データベース、テーブル、ビュー、マテリアライズドビュー、関数、グローバル関数、リソースグループ、およびプラグインに対する全操作を含むデータベース管理権限を持っています。
- `user_admin`: ユーザーとロールの管理権限を持ち、ユーザー、ロール、および権限の作成を含む権限を持っています。

  上記のシステム定義ロールは、複雑なデータベース権限を集約して、日常の管理を容易にするように設計されています。**上記のロールの権限範囲は変更できません。**

  さらに、すべてのユーザーに特定の権限を付与する必要がある場合、StarRocksはシステム定義のロール`public`も提供しています。

- `public`: このロールはすべてのユーザーが所有し、新規ユーザー追加を含む任意のセッションでデフォルトでアクティブ化されます。`public` ロールはデフォルトでは権限を持っていません。このロールの権限範囲を変更することができます。

### カスタムロール

特定のビジネス要件を満たすカスタムロールを作成し、その権限範囲を変更できます。同時に、管理の便宜上、ロールを他のロールに割り当てて、権限階層と継承を作成できます。その後、ロールに関連付けられた権限は、別のロールに継承されます。

#### ロール階層と権限の継承

次の図は、権限の継承の例を示しています。

> 注: ロールの継承レベルの最大数は16です。継承関係は双方向にすることはできません。

![role inheritance](../assets/privilege-role_inheri.png)

図に示すように：

- `role_s` は `role_p` に割り当てられます。`role_p` は `role_s` の `priv_1` を暗黙的に継承します。
- `role_p` は `role_g` に割り当てられ、`role_g` は `role_p` の `priv_2` と `role_s` の `priv_1` を暗黙的に継承します。
- ロールがユーザーに割り当てられた後、そのユーザーはこのロールの権限も持ちます。

### アクティブロール

アクティブロールを使用すると、ユーザーは現在のセッションでロールの権限を適用できます。`SELECT CURRENT_ROLE();` を使用すると、現在のセッションでアクティブなロールを表示できます。詳細については、[current_role](../sql-reference/sql-functions/utility-functions/current_role.md)を参照してください。

#### デフォルトロール

デフォルトロールは、ユーザーがクラスタにログインすると自動的にアクティブ化されます。これは、一人または複数のユーザーが所有するロールです。管理者は、[CREATE USER](../sql-reference/sql-statements/account-management/CREATE_USER.md)の`DEFAULT ROLE`キーワードを使用してデフォルトロールを設定し、[ALTER USER](../sql-reference/sql-statements/account-management/ALTER_USER.md)を使用してデフォルトロールを変更できます。

ユーザーは、[SET DEFAULT ROLE](../sql-reference/sql-statements/account-management/SET_DEFAULT_ROLE.md)を使用して自分のデフォルトロールを変更することもできます。

デフォルトロールは、ユーザーに基本的な権限保護を提供します。例えば、ユーザーAは`role_query`と`role_delete`を持っており、それぞれクエリと削除の権限があります。`DELETE`や`TRUNCATE`などのリスクの高い操作によるデータ損失を防ぐために、`role_query`のみをデフォルトロールとして使用することを推奨します。これらの操作を実行する必要がある場合は、アクティブロールを手動で設定した後に実行できます。

デフォルトロールを持たないユーザーでも、`public`ロールがあり、ユーザーがクラスタにログインした後に自動的にアクティブ化されます。

#### ロールを手動でアクティブ化する

デフォルトのロールに加えて、ユーザーはセッション内で1つ以上の既存のロールを手動でアクティブにすることもできます。アクティブにできる権限とロールを表示するには [SHOW GRANTS](../sql-reference/sql-statements/account-management/SHOW_GRANTS.md) を使用し、現在のセッションで有効なアクティブロールを設定するには [SET ROLE](../sql-reference/sql-statements/account-management/SET_ROLE.md) を使用します。

SET ROLE コマンドはお互いに上書きされることに注意してください。例えば、ユーザーがログインした後、`default_role` がデフォルトでアクティブになります。その後ユーザーが `SET ROLE role_s` を実行すると、この時点でユーザーは `role_s` の権限と自分自身の権限のみを持っています。`default_role` は上書きされます。

## 参照

- [StarRocks によってサポートされる権限](privilege_item.md)
- [ユーザー権限の管理](User_privilege.md)
