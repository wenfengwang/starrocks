---
displayed_sidebar: English
---

# array_map

## 説明

`array_map()` は、ラムダ関数を引数として取ることができる高階SQL関数です。この関数はラムダ関数を入力配列に適用し、新しい配列を返します。

`array_map()` は複数の配列を受け取ることができ、ラムダ関数をネストして変数をキャプチャすることが可能です。ラムダ関数についての詳細は、[ラムダ式](../Lambda_expression.md)を参照してください。この関数はv2.5からサポートされています。

エイリアスは `transform()` です。

## 構文

```Haskell
array_map(lambda_function, arr1, arr2...)
array_map(arr1, arr2..., lambda_function)
```

## 使用上の注意

- ラムダ関数は、高階関数の**最初**または**最後**のパラメータとしてのみ使用できます。位置は計算結果に影響しません。
- 配列の数はラムダ関数の入力パラメータの数と同じでなければなりません。そうでない場合、エラーが返されます。
- すべての配列は同じ数の要素を持っている必要があります。そうでない場合、エラーが返されます。

## 例

例1: 配列の各要素に100を加算します。

```Plain
select array_map(x -> x+100,[1,2,3]);
+------------------------------------+
| array_map(x -> x + 100, [1, 2, 3]) |
+------------------------------------+
| [101,102,103]                      |
+------------------------------------+
```

例2: array1 [1,2,3] と array2 [11,12,13] の各要素を足します。

```Plain
select array_map((x,y) -> x + y, [1,2,3], [11,12,13]);
+-----------------------------------------------------+
| array_map((x, y) -> x + y, [1, 2, 3], [11, 12, 13]) |
+-----------------------------------------------------+
| [12,14,16]                                          |
+-----------------------------------------------------+
```

例3: `x` の要素が1.5より大きいかどうかを判定します。もし大きければ、その要素に対して log(x) を返し、そうでなければ対応する要素に対して (x+y) を返します。

```Plain
select array_map((x,y) -> if(x>1.5,log(x),x+y), [1,2,3], [11,12,13]);
+--------------------------------------------------------------------------+
| array_map((x, y) -> if(x > 1.5, log(x), x + y), [1, 2, 3], [11, 12, 13]) |
+--------------------------------------------------------------------------+
| [12,0.6931471805599453,1.0986122886681098]                               |
+--------------------------------------------------------------------------+
```

例4: `array_map()` を使用して変数をキャプチャします。1の値を持つ要素は条件が満たされたことを示します。

```Plain
-- 例のテーブルでは、last_avg は最後の試験の平均点です。score は現在の試験の3科目の得点を表しています。

+------+----------+------------+
| id   | last_avg | score      |
+------+----------+------------+
|    1 |       55 | [50,60,70] |
|    2 |       73 | [70,65,75] |
|    3 |       89 | [88,92,90] |
+------+----------+------------+

-- 最後の試験の平均点より高い得点を見つけます。
select array_map(x -> x > last_avg, score) from test_tbl;
+--------------------------------------+
| array_map(x -> x > last_avg, score)  |
+--------------------------------------+
| [0,1,1]                              |
| [0,0,1]                              |
| [0,1,1]                              |
+--------------------------------------+
```

例5: 入れ子になったラムダ関数を使用します。

```Plain
select array_map(x -> array_map(x->x+100, x),[[1,2.3],[4,3,2]]);
+-------------------------------------------------------------------+
| array_map(x -> array_map(x -> x + 100, x), [[1, 2.3], [4, 3, 2]]) |
+-------------------------------------------------------------------+
| [[101,102.3],[104,103,102]]                                       |
+-------------------------------------------------------------------+
```

例6: 配列とラムダパラメータの数が一致しないため、エラーが返されます。ラムダ関数は1つの配列のみを要求しますが、2つの配列が渡されています。

```Plain
select array_map(x -> x,[1],[2,4]);
ERROR 1064 (HY000): Lambda arguments should equal to lambda input arrays.
```
