---
displayed_sidebar: English
---

# cos_similarity

## 説明

2つのベクトル間の角度のコサインを計算することで、2つのベクトルの類似度を測定します。角度はベクトルの方向によって形成され、それらの大きさの差は無視されます。

類似度は-1から1の間です。ベクトル間の角度が小さいほど、コサイン類似度は高くなります。

- 2つのベクトルが同じ方向を向いている場合、角度は0度で、コサイン類似度は1です。
- 垂直なベクトルは90度の角度を持ち、コサイン類似度は0です。
- 反対方向のベクトルは180度の角度を持ち、コサイン類似度は-1です。

`cosine_similarity`は、テキストやビデオの類似性を評価するために一般的に使用されます。

この関数は、コサイン類似度を測定する前にベクトルを正規化します。入力ベクトルが既に正規化されている場合は、[cosine_similarity_norm](./cos_similarity_norm.md)を使用できます。

## 構文

```Haskell
cosine_similarity(a, b)
```

## パラメータ

`a`と`b`は比較するベクトルです。両方とも同じ次元でなければなりません。サポートされているデータ型は`Array<float>`です。2つの配列は同じ数の要素を持っていなければなりません。そうでない場合、エラーが返されます。

## 戻り値

[-1, 1]の範囲のFLOAT値を返します。いずれかの入力パラメータがnullまたは無効である場合、エラーが報告されます。

## 例

1. ベクトルを格納するためのテーブルを作成し、そのテーブルにデータを挿入します。

    ```SQL
    CREATE TABLE t1_similarity 
    (id int, data array<float>)
    DISTRIBUTED BY HASH(id);

    INSERT INTO t1_similarity VALUES
    (1, array<float>[0.1, 0.2, 0.3]), 
    (2, array<float>[0.2, 0.1, 0.3]), 
    (3, array<float>[0.3, 0.2, 0.1]);
    ```

2. 配列`[0.1, 0.2, 0.3]`と比較した`data`列の各行の類似度を計算し、結果を降順でリストします。

    ```Plain
    SELECT id, data, cosine_similarity([0.1, 0.2, 0.3], data) as dist
    FROM t1_similarity 
    ORDER BY dist DESC;

    +------+---------------+-----------+
    | id   | data          | dist      |
    +------+---------------+-----------+
    |    1 | [0.1,0.2,0.3] | 0.9999999 |
    |    2 | [0.2,0.1,0.3] | 0.9285713 |
    |    3 | [0.3,0.2,0.1] | 0.7142856 |
    +------+---------------+-----------+
    ```
