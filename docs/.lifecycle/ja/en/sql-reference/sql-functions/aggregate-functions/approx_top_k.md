---
displayed_sidebar: English
---

# approx_top_k

## 説明

`expr` 内で最も頻繁に発生するアイテムの上位 `k` 個の値と、それらのおおよそのカウントを返します。

## 構文

```Haskell
APPROX_TOP_K(<expr> [ , <k> [ , <counter_num> ] ] )
```

## 引数

* `expr`: STRING、BOOLEAN、DATE、DATETIME、または数値型の式。
* `k`: 0より大きい任意のINTEGERリテラル。`k`が指定されていない場合、デフォルトは`5`です。
    * 最大値は`100000`
* `counter_num`: `k`以上の任意のINTEGERリテラル。`counter_num`が大きいほど、結果はより正確になりますが、CPUとメモリのコストも増加します。
    * 最大値は`100000`
    * `counter_num`が指定されていない場合、デフォルトは`max(min(2 * k, 100), 100000)`です。

## 戻り値

結果はSTRUCT型のARRAYとして返され、各STRUCTには値の`item`フィールド（元の入力型）と、おおよその出現回数の`count`フィールド（BIGINT型）が含まれます。配列は`count`の降順にソートされます。

この集約関数は、式`expr`内で最も頻繁に発生するアイテムの上位`k`個の値と、そのおおよそのカウントを返します。各カウントの誤差は最大で`2.0 * numRows / counter_num`になる可能性があります。ここで`numRows`は総行数です。`counter_num`の値が大きいほど精度は向上しますが、メモリ使用量も増加します。`counter_num`より少ない個別のアイテムを持つ式は、正確なアイテムカウントを提供します。結果には`NULL`値も独自のアイテムとして含まれます。

## 例

```plain text
MySQL > SELECT APPROX_TOP_K(L_LINESTATUS) FROM lineitem;
+-------------------------------------------------------------+
| approx_top_k(L_LINESTATUS)                                  |
+-------------------------------------------------------------+
| [{"item":"O","count":3004998},{"item":"F","count":2996217}] |
+-------------------------------------------------------------+

MySQL > SELECT APPROX_TOP_K(L_LINENUMBER) FROM lineitem GROUP BY L_RETURNFLAG;
+-------------------------------------------------------------------------------------------------------------------------------------+
| approx_top_k(L_LINENUMBER)                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------+
| [{"item":1,"count":761151},{"item":2,"count":652280},{"item":3,"count":543265},{"item":4,"count":434834},{"item":5,"count":326135}] |
| [{"item":1,"count":368853},{"item":2,"count":316830},{"item":3,"count":263950},{"item":4,"count":211270},{"item":5,"count":158495}] |
| [{"item":1,"count":369996},{"item":2,"count":316718},{"item":3,"count":264179},{"item":4,"count":210911},{"item":5,"count":158657}] |
+-------------------------------------------------------------------------------------------------------------------------------------+
```

## キーワード

APPROX_TOP_K

