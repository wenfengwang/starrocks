---
displayed_sidebar: English
---

# StarRocksクラスターの計画

このトピックでは、ノード数、CPUコア数、メモリサイズ、およびストレージサイズの観点から、運用環境のStarRocksクラスターのリソースを計画する方法について説明します。

## ノード数

StarRocksは主にFEノードとBEノードの2種類のコンポーネントで構成されています。各ノードは物理マシンまたは仮想マシンに個別にデプロイする必要があります。

### FEノード数

FEノードはメタデータ管理、クライアント接続管理、クエリ計画、およびクエリスケジューリングを主に担当します。

本番環境では、単一障害点(SPOF)を防ぐために、StarRocksクラスターに少なくとも**THREE**のFollower FEノードをデプロイすることを推奨します。

StarRocksはBDB JEプロトコルを使用してFEノード間のメタデータを管理します。StarRocksはすべてのFollower FEノードからLeader FEノードを選出します。Leader FEノードのみがメタデータを書き込むことができます。他のFollower FEノードはLeader FEノードからのログに基づいてメタデータを更新するだけです。Leader FEノードが障害に遭遇するたびに、Follower FEノードの半数以上が稼働している限り、StarRocksは新しいLeader FEノードを再選出します。

アプリケーションが高い同時実行クエリリクエストを生成する場合、Observer FEノードをクラスターに追加することができます。Observer FEノードはクエリリクエストの処理のみを行い、Leader FEノードの選出には参加しません。

### BEノード数

BEノードはデータストレージとSQL実行を担当します。

本番環境では、データの信頼性とサービスの可用性を高めるために、StarRocksクラスターに少なくとも**THREE**のBEノードをデプロイすることを推奨します。少なくとも3つのBEノードがデプロイされてStarRocksクラスターに追加されると、BEの高可用性クラスターが自動的に形成されます。1つのBEノードの障害がBEサービス全体の可用性に影響を与えることはありません。

高い同時実行クエリを処理するために、BEノードの数を増やすことができます。

### CNノード数

CNノードはStarRocksのオプションコンポーネントであり、SQL実行のみを担当します。

StarRocksクラスター内のデータ分散を変更せずに計算リソースを弾力的にスケールするために、CNノードの数を増やすことができます。

## CPUとメモリ

通常、FEサービスはCPUとメモリリソースを多く消費しません。各FEノードに8つのCPUコアと16GBのRAMを割り当てることを推奨します。

FEサービスとは異なり、BEサービスはアプリケーションが大規模なデータセットで高い同時実行性のクエリや複雑なクエリを処理する場合、CPUとメモリを大量に消費する可能性があります。そのため、各BEノードに16のCPUコアと64GBのRAMを割り当てることを推奨します。

## ストレージ容量

### FEストレージ

FEノードはStarRocksのメタデータのみを保持するため、ほとんどのシナリオで各FEノードに100GBのHDDストレージで十分です。

### BEストレージ

#### BEの初期ストレージ容量の見積もり

StarRocksクラスタに必要な合計ストレージ容量は、生データのサイズ、データレプリカ数、および使用するデータ圧縮アルゴリズムの圧縮率によって同時に影響を受けます。

以下の式を使用して、すべてのBEノードに必要な合計ストレージ容量を見積もることができます。

```Plain
Total BE storage space = Raw data size * Replica count / Compression ratio

Raw data size = Sum of the space taken up by all fields in a row * Row count
```

StarRocksでは、テーブル内のデータは最初に複数のパーティションに分割され、次に複数のタブレットに分割されます。タブレットはStarRocksのデータ管理の基本的な論理単位です。データの信頼性を高めるために、各タブレットの複数のレプリカを保持し、異なるBEに格納することができます。デフォルトでは、StarRocksは3つのレプリカを維持します。

現在、StarRocksは圧縮率の高い順にzlib、Zstandard（またはzstd）、LZ4、Snappyの4つのデータ圧縮アルゴリズムをサポートしています。これらは3:1から5:1の圧縮率を提供できます。

合計ストレージ容量を決定した後、それをクラスター内のBEノードの数で割ることで、BEノードごとの平均ストレージ容量を見積もることができます。

#### ストレージを随時追加

生データの増加に伴いBEストレージ容量が不足する場合、クラスターを垂直または水平にスケーリングするか、クラウドストレージを拡張することで補うことができます。

- StarRocksクラスタに新しいBEノードを追加

  StarRocksクラスタに新しいBEノードを追加することで、データをより多くのノードに均等に再分配することができます。詳細な手順については、[StarRocksクラスタのスケーリング - BEのスケールアウト](../administration/Scale_up_down.md)を参照してください。

  新しいBEノードが追加されると、StarRocksは自動的にすべてのBEノード間でデータを再バランスします。この自動バランスは、すべてのテーブルタイプでサポートされています。

- BEノードに追加のストレージボリュームを追加

  既存のBEノードに追加のストレージボリュームを追加することもできます。詳細な手順については、[StarRocksクラスタのスケーリング - BEのスケールアップ](../administration/Scale_up_down.md)を参照してください。

  追加のストレージボリュームが追加されると、StarRocksは自動的にすべてのテーブルのデータを再バランスします。

- クラウドストレージを追加

  StarRocksクラスタがクラウドにデプロイされている場合、クラウドストレージをオンデマンドで拡張することができます。詳細な手順については、クラウドプロバイダーに問い合わせてください。
