---
displayed_sidebar: English
---

# ユーザー定義変数

このトピックでは、ユーザー定義変数を宣言し、使用する方法について説明します。

StarRocks 2.5 以降のバージョンでは、ユーザー定義変数がサポートされています。これらの変数は、後の SQL ステートメントで参照される特定の値を格納するために使用され、SQL ステートメントの記述を簡略化し、重複計算を避けることができます。

## 使用上の注意

- ユーザー定義変数はセッション内に存在し、ユーザーが作成する変数です。これは、他のユーザーが宣言したユーザー定義変数にアクセスできないことを意味し、セッションが終了するとこれらの変数は失効します。
- StarRocks は、SHOW ステートメントを使用して既存のユーザー定義変数を表示することはサポートしていません。
- ユーザー定義変数として宣言できない値のタイプには、BITMAP、HLL、PERCENTILE、ARRAY があります。JSON 型のユーザー定義変数は、保存のために STRING 型に変換されます。

## ユーザー定義変数の宣言

### 構文

```Plain
SET @var_name = expr [, ...];
```

> **注記**
>
> - すべての変数の前には、アットマーク (@) が1つ必要です。
> - 複数の変数を同じ SET ステートメントで宣言でき、コンマ (`,`) で区切る必要があります。
> - 同じ変数を複数回宣言することができます。新しく宣言された値は、元の値に上書きされます。
> - 宣言されていない変数が使用された場合、その変数の値はデフォルトで `NULL` となり、NULL の型は STRING です。

### パラメーター

| **パラメーター** | **必須** | **説明**                                              |
| ------------- | ------------ | ------------------------------------------------------------ |
| var_name      | はい          | ユーザー定義変数の名前。命名規則は以下の通りです：<ul><li>名前には文字、数字 (0-9)、アンダースコア (\_) を含めることができます。</li><li>名前は 64 文字を超えることはできません。</li></ul>文字列は、@'my-var'、@"my-var"、@\`my-var\` としてユーザー定義変数に宣言できます。STRING 型のユーザー定義変数は、ピリオド (.) など、文字、数字、アンダースコア (_) 以外の文字も含むことができます。|
| expr          | はい          | ユーザー定義変数の値。このパラメーターには、数値 (例: 43) や複雑な式 (SELECT ステートメントによって返される値など) を指定できます。変数のデータ型は、式によって返される結果のデータ型と同じです。 |

### 例

例 1: 数値をユーザー定義変数として宣言する。

```SQL
SET @var = 43;
```

例 2: SELECT クエリによって返された値をユーザー定義変数として宣言する。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

例 3: 同じ SET ステートメントで複数のユーザー定義変数を宣言する。

```SQL
SET @v1=1, @v2=2;
```

## SQL でのユーザー定義変数の使用

- SQL ステートメントの記述を簡略化します。たとえば、次の SELECT ステートメントを実行すると、StarRocks は `@var` を `1` として解析します。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 重複計算を避けます。たとえば、次の SELECT ステートメントを実行すると、StarRocks は `@var` を `select sum(c1) from tbl` コマンドによって返された結果として解析します。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```
