---
displayed_sidebar: English
---

# 機能

StarRocksは、大規模データに対する超高速なリアルタイム分析体験を提供する豊富な機能セットを備えています。

## MPPフレームワーク

StarRocksは、大規模並列処理（MPP）フレームワークを採用しています。一つのクエリリクエストは、複数の物理的な計算ユニットに分割され、複数のマシンで並列に実行されます。各マシンは専用のCPUとメモリリソースを持っています。MPPフレームワークは、すべてのCPUコアとマシンのリソースを完全に活用します。クラスターがスケールアウトするにつれて、単一クエリのパフォーマンスは継続的に向上します。

![MPP](../assets/1.1-3-mpp.png)

上記の図では、StarRocksはSQLステートメントをステートメントの意味に基づいて複数の論理実行ユニット（クエリフラグメント）に解析します。それぞれのフラグメントは、計算の複雑さに基づいて一つまたは複数の物理実行ユニット（フラグメントインスタンス）によって実装されます。物理実行ユニットはStarRocksの最小スケジューリング単位です。これらはバックエンド（BE）にスケジュールされて実行されます。図の右側に示されているように、一つの論理実行ユニットはScan、Project、Aggなどの一つ以上のオペレーターを含むことができます。各物理実行ユニットはデータの一部分のみを処理し、その結果は統合されて最終データを生成します。**論理実行ユニットの並列実行は、全てのCPUコアと物理マシンのリソースを完全に活用し、クエリ速度を加速します。**

![MPP](../assets/1.1-4-mpp.png)

多くの他のデータ分析システムで使用されるScatter-Gatherフレームワークとは異なり、MPPフレームワークはクエリリクエストを処理するためにより多くのリソースを利用できます。Scatter-Gatherフレームワークでは、Gatherノードだけが最終的なマージ操作を実行できます。MPPフレームワークでは、データは複数のノードにシャッフルされてマージ操作が行われます。高カーディナリティフィールドでのGroup Byや大規模なテーブル結合などの複雑なクエリにおいて、StarRocksのMPPフレームワークはScatter-Gatherフレームワークに比べて顕著なパフォーマンスの優位性を持っています。

## 完全ベクトル化実行エンジン

完全ベクトル化実行エンジンは、データを列単位で整理し処理することで、CPUの処理能力をより効率的に使用します。具体的には、StarRocksはデータを保存し、メモリ内でデータを列単位で整理し、SQLオペレーターを列単位で計算します。列単位の整理はCPUキャッシュを最大限に活用します。列単位の計算は、仮想関数呼び出しと分岐判断の数を減らし、結果としてより効率的なCPU命令フローを実現します。

ベクトル化実行エンジンはSIMD命令も最大限に活用します。このエンジンは、より少ない命令でより多くのデータ操作を完了することができます。標準データセットに対するテストでは、このエンジンがオペレーターの全体的なパフォーマンスを3倍から10倍向上させることが示されています。

オペレーターのベクトル化に加えて、StarRocksはクエリエンジンに対して他の最適化も実施しています。例えば、StarRocksはエンコードされたデータ上でのオペレーション技術を使用して、デコードすることなくエンコードされた文字列上で直接オペレーターを実行することができます。これによりSQLの複雑さが大幅に削減され、クエリ速度が2倍以上に向上します。

## ストレージとコンピュートの分離

[ストレージ-コンピュート分離アーキテクチャ](./Architecture.md)はバージョン3.0から導入されました。このアーキテクチャでは、コンピューティングとストレージが分離され、リソースの隔離、コンピュートノードの弾力的なスケーリング、および高性能なクエリが実現されます。ストレージ-コンピュート分離はStarRocksにより大きな柔軟性、高いパフォーマンスとデータ可用性、そして低コストをもたらします。

![共有データ](../assets/share_data_arch.png)

ストレージ-コンピュート分離モードでは、コンピューティングとストレージが分離され、独立してスケールできるため、ストレージ-コンピュート結合モードにおいてユーザーがコンピュートノードを追加するたびにストレージをスケールする必要があったコストを排除します。さらに、コンピューティングは数秒以内に動的にスケールでき、特にトラフィックのピークと谷が顕著な場合にリソース利用率を向上させます。

ストレージ層は、オブジェクトストレージのほぼ無限の容量と高い信頼性を活用して、大量のデータストレージとデータの永続性を実現します。StarRocksはAWS S3、Google Cloud Storage、Azure Blob Storage、HDFS、MinIOなどのS3互換ストレージを含む様々なオブジェクトストレージシステムと連携可能です。

ユーザーは、StarRocksをパブリッククラウド、プライベートクラウド、またはオンプレミスデータセンターにデプロイすることができます。StarRocksはKubernetesベースのデプロイメントをサポートし、ストレージ-コンピュート分離クラスターの自動デプロイメント用のOperatorを提供します。

ストレージ-コンピュート分離モードのStarRocksは、ストレージ-コンピュート結合モードと同様の機能を提供します。データの書き込みとホットデータクエリのパフォーマンスも同等です。ユーザーはストレージ-コンピュート結合モードで行うように、データの更新、データレイク分析、マテリアライズドビューの高速化を実行できます。

ストレージとコンピュートが分離されたStarRocksクラスターをデプロイする方法については、[共有データクラスターのデプロイ](../deployment/shared_data/s3.md)を参照してください。

## コストベースのオプティマイザー

![CBO](../assets/1.1-5-cbo.png)

複数テーブル結合クエリのパフォーマンス最適化は難しい課題です。実行エンジンだけでは、複数テーブル結合クエリシナリオにおける実行プランの複雑さが数桁にわたって変わるため、優れたパフォーマンスを提供することができません。関連するテーブルが多ければ多いほど、実行プランの数が増え、最適なプランを選択することはNP困難になります。優れたクエリオプティマイザーだけが、効率的な複数テーブル分析のために比較的最適なクエリプランを選択することができます。

StarRocksは、ゼロから全く新しい[CBO](../using_starrocks/Cost_based_optimizer.md)を設計しました。このCBOはカスケード風のフレームワークを採用し、ベクトル化実行エンジンに深くカスタマイズされており、多くの最適化と革新を含んでいます。これらの最適化には、共通テーブル式（CTE）の再利用、サブクエリの書き換え、Lateral Join、Join Reorder、分散結合実行の戦略選択、低カーディナリティ最適化が含まれます。CBOは合計99個のTPC-DS SQLステートメントをサポートしています。

CBOにより、StarRocksは競合他社よりも優れた複数テーブル結合クエリのパフォーマンスを提供でき、特に複雑な複数テーブル結合クエリにおいて顕著です。

## リアルタイムで更新可能なカラム型ストレージエンジン

StarRocksは、同じタイプのデータを連続して保存できるカラム型ストレージエンジンです。カラム型ストレージでは、データをより効率的にエンコードでき、圧縮率を向上させ、ストレージコストを削減します。また、カラム型ストレージは総データ読み取りI/Oを削減し、クエリパフォーマンスを向上させます。多くのOLAPシナリオでは、特定の列のみがクエリされるため、カラム型ストレージを使用すると、ユーザーは必要な列のみをクエリでき、ディスクI/Oを大幅に削減できます。

StarRocksは数秒以内にデータをロードし、ほぼリアルタイム分析を実現します。StarRocksのストレージエンジンは、各データ取り込み操作の原子性、一貫性、分離性、耐久性（ACID）を保証します。データロードトランザクションでは、トランザクション全体が成功するか失敗します。同時実行トランザクションは互いに影響しません、これによりトランザクションレベルの分離が実現されます。

![Realtime](../assets/1.1-6-realtime.png)

StarRocksのストレージエンジンはDelete-and-insertパターンを使用し、効率的なPartial UpdateおよびUpsert操作を可能にします。ストレージエンジンは主キーインデックスを利用してデータを迅速にフィルタリングでき、データ読み取り時のSortとMerge操作を不要にします。また、セカンダリインデックスを最大限に活用することもできます。これにより、大量のデータ更新があっても、高速かつ予測可能なクエリパフォーマンスを提供します。

## インテリジェントなマテリアライズドビュー

StarRocksはインテリジェントな[マテリアライズドビュー](../using_starrocks/Materialized_view.md)を使用してクエリの高速化とデータウェアハウスの階層化を実現します。他の類似製品のマテリアライズドビューがベーステーブルとの手動でのデータ同期を必要とするのとは異なり、StarRocksのマテリアライズドビューは、追加のメンテナンス操作を必要とせずにベーステーブルのデータ変更に応じて自動的にデータを更新します。また、マテリアライズドビューの選択も自動的です。StarRocksがクエリパフォーマンスを向上させるのに適したマテリアライズドビュー（MV）を特定した場合、自動的にクエリを書き換えてMVを利用します。このインテリジェントなプロセスは、手動介入を必要とせずにクエリ効率を大幅に向上させます。

StarRocksのMVは従来のETLデータモデリングプロセスに代わるものです。アップストリームアプリケーションでデータを変換する代わりに、StarRocks内でMVを使用してデータを変換するオプションがあり、データ処理パイプラインを簡素化します。

例えば、図に示すように、データレイク上の生データを使用して外部MVに基づく正規化テーブルを作成できます。非正規化テーブルは、正規化テーブルから非同期マテリアライズドビューを介して作成されます。また、正規化テーブルから別のMVを作成し、高い同時実行性のクエリをサポートし、クエリパフォーマンスを向上させることができます。

![MV](../assets/1.1-7-mv.png)

## データレイク分析

![DLA](../assets/1.1-8-dla.png)

StarRocksは、ローカルデータの効率的な分析だけでなく、Apache Hive、Apache Iceberg、Apache Hudi、Delta Lakeなどの[データレイク](../data_source/catalog/catalog_overview.md)に保存されたデータを分析するコンピュートエンジンとしても機能します。StarRocksの主要な特徴の一つは、外部で管理されているメタストアにリンクする外部カタログです。この機能により、ユーザーはデータ移行を行うことなく、外部データソースをシームレスにクエリできます。これにより、ユーザーはHDFSやAmazon S3などの異なるシステムからのデータを、Parquet、ORC、CSVなどのさまざまなファイル形式で分析することが可能になります。

上の図は、StarRocksがデータ計算と分析を担当し、データレイクがデータのストレージ、整理、およびメンテナンスを担当するデータレイク分析シナリオを示しています。データレイクを利用することで、ユーザーはオープンなストレージフォーマットでデータを保存し、柔軟なスキーマを用いて、様々なBI、AI、アドホック分析、およびレポーティングのユースケースにおける「信頼のおける唯一の情報源」に基づいたレポートを生成できます。StarRocksはそのベクトル化エンジンとCBOの利点を最大限に活用し、データレイク分析のパフォーマンスを顕著に向上させます。
