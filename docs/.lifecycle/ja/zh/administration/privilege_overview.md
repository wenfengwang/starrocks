---
displayed_sidebar: Chinese
---

# 権限システムの概要

このドキュメントでは、StarRocksの権限システムの基本的な概念について説明します。権限は、どのユーザーがどの特定のオブジェクトに対してどの特定の操作を実行できるかを決定し、データとリソースをより安全に管理するのに役立ちます。

> **バージョンの注意**：このドキュメントで説明されている権限管理システムは、バージョン3.0から提供されています。アップグレード後の権限フレームワークと構文は、古いシステムと互換性がありませんので、3.0バージョンの操作説明を参照してください。アップグレード後、一部の操作を除いて、既存のシステムでのほとんどの操作権限は引き続き保持されます。詳細な違いについては、権限項目ドキュメントの[アップグレードの注意事項](privilege_item.md#アップグレードの注意事項)を参照してください。

StarRocksでは、2つの権限モデルを採用しています：

- ロールベースのアクセス制御（RBAC: role-based access control）：権限はロールを介して管理され、権限をロールに割り当てることで、ユーザーにロールを通じて権限を伝達することができます。
- アイデンティティベースのアクセス制御（IBAC: identity-based access control）：権限を直接ユーザーに割り当てることができます。

したがって、各ユーザーの最大権限範囲は、そのユーザーが持つロールの権限と自身の権限の和集合です。

基本的な概念：

- オブジェクト（Object）は、アクセス権限が付与される実体です。許可がない限り、アクセスは拒否されます。例えば、CATALOG、DATABASE、TABLE、VIEWなどです。
- 権限項目（Privilege）は、オブジェクトのアクセスレベルを表します。異なる権限項目は、対象オブジェクトに対する異なる操作を表します。例えば、SELECT、ALTER、DROPなどです。StarRocksがサポートするオブジェクトと権限項目については、[権限項目](privilege_item.md)を参照してください。
- ユーザーID（User Identity）：ユーザーの一意の識別子であり、権限を付与できる実体でもあります。ユーザーIDは、指定されたユーザー名とユーザーのログインIPから構成される `username@'userhost'` の形式で表示されます。ユーザーIDは属性の設定を簡素化し、同じユーザー名のユーザーIDは同じ属性を共有します。属性をユーザー名に設定するだけで、そのユーザー名を含むすべてのユーザーIDに対してその属性が有効になります。
- ロール（Role）：権限の抽象的な集合であり、権限を付与できる実体でもあります。ロールをユーザーに割り当てることも、他のロールにロールを割り当てることもでき、その結果、権限が下位に伝播します。StarRocksでは、システムで予め定義されたロールが提供されており、ビジネス要件に応じてカスタムロールを作成することもできます。

以下の図は、RBACとIBACの2つの権限モデルに基づく権限管理の例を示しています。

![権限管理](../assets/privilege-manage.png)

## オブジェクトと権限

オブジェクトは論理的に階層構造を持ち、それらが表す概念に関連しています。例えば、DatabaseはCatalogに含まれ、Table、View、Materialized View、FunctionはDatabaseに含まれます。以下の図は、StarRocksシステム内のオブジェクトの階層関係を示しています。

![特権オブジェクト](../assets/privilege-object.png)

各オブジェクトには、許可される一連の権限項目があります。詳細については、[権限項目ドキュメント](privilege_item.md)を参照してください。[GRANT](../sql-reference/sql-statements/account-management/GRANT.md)コマンドと[REVOKE](../sql-reference/sql-statements/account-management/REVOKE.md)コマンドを使用して、ロールまたはユーザーに対して権限を付与または取り消すことができます。

## ユーザー

### ユーザーID

StarRocksでは、各ユーザーには一意のユーザーIDがあります。ユーザーのログインIP（userhost）とユーザー名（username）で構成され、`username@'userhost'`という形式で表されます。StarRocksは、同じユーザー名であっても、異なるIPからのユーザーを異なるユーザーIDとして識別します。つまり、`user1@'starrocks.com'`と`user1@'mirrorship.com'`は2つのユーザーIDです。

ユーザーIDは、`username@['domain']`という形式でも表すことができます。ここで、`domain`はドメイン名であり、DNSによって一連のIPに解決されます。最終的には、一連の`username@'userhost'`として表されます。`userhost`の部分は`%`を使用してワイルドカードマッチングすることができます。`userhost`を指定しない場合は、デフォルトで`'%'`になります。つまり、任意のホストからStarRocksに接続する同じ名前のユーザーを表します。

### ユーザーへの権限付与

ユーザーは権限とロールの両方を付与することができるエンティティです。ユーザーが持つ最大の権限の範囲は、自身の権限と所持しているロールの権限の和集合です。StarRocksは、ユーザーが付与された操作のみを実行できるように保証します。

StarRocksでは、ほとんどの場合には**ロール**を使用して権限を配布することをお勧めします。つまり、ビジネスシナリオに応じてロールを作成し、権限をロールに割り当てた後、ロールをユーザーに割り当てます。特定のユーザーが持つ一時的な特別な権限については、権限を直接ユーザーに割り当てる方法で管理します。これにより、権限管理プロセスが最小限に抑えられ、柔軟性が提供されます。

## ロール

ロールは、権限の集合として考えることができます。管理の簡潔さを実現するために、StarRocksでは、ほとんどの日常的な権限を**ロールを使用して管理する**ことをお勧めします。これにより、重複した操作を避け、一貫性を確保することができます。特別な権限や一時的な権限については、直接ユーザーに割り当てることができます。

管理のために、StarRocksにはいくつかの特定の権限を持つ事前定義されたロールが用意されています。これらのロールを使用して、日常の管理ニーズを満たすことができます。また、実際の要件に応じてカスタムロールを柔軟に構成することもできます。

ロールをアクティブにすると、ユーザーはそのロールに割り当てられた権限を実行することができます。各ユーザーには、ログイン時に自動的にアクティブになるデフォルトのロール（デフォルトロール）を設定することができます。ユーザーはまた、現在のセッションで手動でアクティブにするロール（アクティブロール）を選択することもできます。

### システムの事前定義ロール

StarRocksには、いくつかの事前定義されたロール（system-defined roles）が用意されています：

![ロール](../assets/privilege-role.png)

- `root`：グローバルな権限を持ちます。rootユーザーはデフォルトで`root`ロールを持っています。
  StarRocksクラスターが最初に作成されるとき、システムはrootユーザーを自動的に生成し、このユーザーにroot権限を付与します。rootユーザーやロールの権限範囲が広すぎるため、クラスターの使用とメンテナンスには新しいユーザーやロールを作成することをお勧めします。rootユーザーのパスワードは安全に保管してください。
- `cluster_admin`：クラスターの管理権限を持ちます。ノードの追加や削除などのノードの操作権限を含みます。
  `cluster_admin`ロールは、クラスターノードのオンラインおよびオフラインの権限を持っていますので、適切に権限を付与してください。`cluster_admin`またはこのロールを含むカスタムロールをユーザーのデフォルトロールに設定しないようにすることをお勧めします。誤った操作によるノードの変更を防ぐためです。
- `db_admin`：データベースの管理権限を持ちます。CATALOG、データベース、テーブル、ビュー、マテリアライズドビュー、関数、グローバル関数、リソースグループ、プラグインなどのオブジェクトのすべての操作権限を含みます。
- `user_admin`：ユーザーとロールの管理権限を持ちます。ユーザーの作成、ロールの作成、権限の付与などの権限を含みます。

上記のシステムの事前定義ロールは、複雑なデータベースの権限を高度にまとめており、日常の管理を容易にするために提供されています。**上記のロールの権限範囲は変更できません。**

また、すべてのユーザーに特定の権限を付与する必要がある場合は、StarRocksには`public`という事前定義のロールも用意されています。

- `public`：すべてのユーザーが持ち、すべてのセッションでデフォルトでアクティブになるロールで、新しいユーザーも含まれます。`public`ロールはデフォルトでは権限を持っていませんが、権限範囲を変更することができます。

### ユーザー定義のロール

ビジネスシナリオに応じてカスタムロールを作成し、その権限範囲を変更することができます。また、管理のために、ロールをロールに割り当てることで権限の継承を生成することもできます。

#### ロールの継承関係

以下の図は、権限の継承の例を示しています。

> 注意：ロールの最大継承レベルは16です。ロールの継承関係は双方向ではなく、例えばロールAをロールBに割り当てることはできますが、逆にロールBをロールAに割り当てることはできません。これにより、継承関係が明確でなくなる可能性があります。

![ロールの継承](../assets/privilege-role_inheri.png)

上記の図のように、ロールをユーザーに割り当てることで、ユーザーはロールの権限を持つことになります。

- `role_s`が`role_p`に割り当てられているため、`role_p`は`role_s`の`priv_1`を暗黙的に継承します。
- `role_p`が`role_g`に割り当てられているため、`role_g`は`role_p`の`priv_2`と`role_s`の`priv_1`を暗黙的に継承します。

### ロールのアクティブ化

ロールをアクティブにすることで、ユーザーはそのロールに割り当てられた権限を現在のセッションで使用することができます。現在のセッションでアクティブになっているロールは、[SELECT CURRENT_ROLE()](../sql-reference/sql-functions/utility-functions/current_role.md)コマンドで確認することができます。

#### デフォルトのアクティブロール

デフォルトロール（Default Role）は、ユーザーがクラスターにログインしたときに自動的にアクティブになるロールです。1つまたは複数のユーザーが持つことができます。管理者は、ユーザーを作成する際にCREATE USERの`DEFAULT ROLE`キーワードを使用してデフォルトロールを設定することも、後でALTER USERを使用して変更することもできます。

ユーザーはまた、[SET DEFAULT ROLE](../sql-reference/sql-statements/account-management/SET_DEFAULT_ROLE.md)コマンドを使用してデフォルトロールを変更することもできます。

デフォルトロールは、ユーザーに基本的な権限のバリアを提供します。例えば、ユーザーAがrole_queryとrole_deleteの2つのロールを持っており、それぞれクエリと削除の権限を持っている場合、StarRocksでは、デフォルトのロールとしてrole_queryのみを設定することをお勧めします。これにより、誤ってDELETEやTRUNCATEなどの高リスクな操作を実行してデータを失うことを防ぐことができます。これらの操作を実行する必要がある場合は、手動でアクティブロールを設定してから実行してください。

ユーザーにデフォルトロールが設定されていない場合、クラスターにログインした後、システムの事前定義ロールである`public`ロールが自動的にアクティブになります。

#### 手動でのアクティブ化

デフォルトロール以外にも、ユーザーはセッション内で手動で1つまたは複数の所有ロールをアクティブにすることができます。[SHOW GRANTS](../sql-reference/sql-statements/account-management/SHOW_GRANTS.md)コマンドを使用して、現在のユーザーが持つ権限とアクティブにできるロールを確認し、[SET ROLE](../sql-reference/sql-statements/account-management/SET_ROLE.md)コマンドを使用して現在のアクティブロールを設定することができます。これは、現在のセッションにのみ適用されます。

SET ROLEコマンドは上書きされます。例えば、ユーザーがデフォルトロールでログインしている場合、`SET ROLE role_s`を実行すると、ユーザーはrole_sの権限と自身の権限を持つことになります。

## 関連するドキュメント

[ユーザー権限の管理](./User_privilege.md)
