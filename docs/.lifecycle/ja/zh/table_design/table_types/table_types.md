---
displayed_sidebar: Chinese
---

# データモデル概要

テーブルを作成する際には、データモデル（Data Model）を指定する必要があります。これにより、データをデータモデルにインポートする際、StarRocksはソートキーに従ってデータをソート、処理、および保存します。本文書では、StarRocksがサポートするさまざまなデータモデルを紹介し、異なるビジネスシナリオにおけるニーズを満たします。

## 基本概念

### データモデル

StarRocksは、明細モデル（Duplicate Key Model）、集約モデル（Aggregate Key Model）、更新モデル（Unique Key Model）、および主キーモデル（Primary Key Model）の4種類のデータモデルをサポートしています。これらのデータモデルは、ログ分析、データ集約分析、リアルタイム分析など、多様なデータ分析シナリオをサポートできます。

### ソートキー

データを特定のデータモデルを使用するテーブルにインポートすると、テーブル作成時に指定された1つまたは複数の列に基づいてソートされた後に保存されます。このソートに使用される列をソートキーと呼びます。ソートキーは通常、クエリ時にフィルタ条件として頻繁に使用される1つまたは複数の列で、クエリを高速化するために使用されます。
明細モデルでは、データはソートキー `DUPLICATE KEY` に従ってソートされ、ソートキーは一意性制約を満たす必要はありません。
集約モデルでは、データはソートキー `AGGREGATE KEY` に従って集約された後にソートされ、ソートキーは一意性制約を満たす必要があります。
更新モデルでは、データはソートキー `UNIQUE KEY` に従って REPLACE された後にソートされ、ソートキーは一意性制約を満たす必要があります。
主キーモデルでは、主キーとソートキーを別々に定義することができ、主キー `PRIMARY KEY` は一意性と非null制約を満たす必要があります。主キーが同じデータは REPLACE されます。ソートキーはソート用で、 `ORDER BY` で指定されます。
> **説明**
>
> - バージョン3.0以前では、主キーモデルは主キーとソートキーを別々に定義することはできませんでした。
> - ソートキーの詳細については、[ソートキーとプレフィックスインデックス](../Sort_key.md)を参照してください。

## 注意事項

- テーブル作成文では、ソートキーは他の列の前に定義する必要があります。

- テーブルを作成する際には、1つまたは複数の列をソートキーとして定義できます。テーブル作成文中でのソートキーの出現順序は、データ保存時の複数のソート順序です。

- ソートキーとしてサポートされていないデータ型には BITMAP、HLL があります。

- プレフィックスインデックスの長さ制限は36バイトです。ソートキーに含まれるすべての列の値の長さの合計が36バイトを超える場合、プレフィックスインデックスは制限範囲内のソートキーのいくつかのプレフィックス列のみを保存します。

- インポートされたデータに重複する主キーが存在する場合、データはデータモデルにインポートされ、StarRocksに保存される際、以下の方法で処理されます：
  - 明細モデル：テーブルには主キーが重複するデータ行が存在し、インポートされたデータと完全に対応しています。インポートされたすべての履歴データを呼び戻すことができます。
  - 集約モデル：テーブルには主キーが重複するデータ行が存在せず、主キーは一意性制約を満たしています。インポートされたデータの中で主キーが重複するデータ行は1行に集約され、同じ主キーを持つ指標列は集約関数を通じて集約されます。インポートされたすべての履歴データの集約結果のみを呼び戻すことができ、履歴の詳細データは呼び戻すことができません。
  - 主キーモデルと更新モデル：テーブルには主キーが重複するデータ行が存在せず、主キーは一意性制約を満たしています。最新にインポートされたデータ行が、他の主キーが重複するデータ行を置き換えます。これら2つのモデルは集約モデルの特殊なケースと見なすことができ、集約モデルでテーブルの指標列に集約関数として REPLACE を指定した場合と同様です。REPLACE 関数は同じ主キーを持つデータグループの中で最新のデータを返します。
