---
displayed_sidebar: Chinese
---

# cosine_similarity_norm

## 機能

二つの正規化されたベクトルのコサイン類似度を計算して、ベクトル間の類似度を評価します。この関数はベクトルが既に正規化されていると仮定しています。ベクトルを計算前に正規化する必要がある場合は、[cosine_similarity](./cos_similarity.md) 関数を使用してください。

類似度は -1 から 1 の間の値を取ります。二つのベクトルの角度が 0°、つまり同じ方向を向いている場合、類似度は 1 です；角度が 180°、つまり反対方向を向いている場合、類似度は -1 です；角度が 90°、つまり直角をなしている場合、類似度は 0 です。

値が 1 に近づくほど、二つのベクトルの方向が近づくことを意味し；-1 に近づくほど、方向が反対であることを意味し；0 に近づくほど、二つのベクトルがほぼ直交していることを意味します。

コサイン類似度は、テキストやビデオなどの類似度を測定する際によく使用されます。

## 文法

```Haskell
cosine_similarity_norm(a, b)
```

## パラメータ説明

`a` と `b` は比較対象の二つのベクトルで、次元が同じでなければなりません。値は `Array<float>` 型でなければならず、つまり Array の要素は FLOAT 型のみをサポートします。注意：二つの配列の要素数が同じでなければ、エラーが返されます。

## 戻り値の説明

FLOAT 型の値を返し、取得範囲は [-1, 1] です。入力パラメータが NULL または無効な型の場合、エラーが返されます。

## 例

1. ベクトルを保存するためのテーブルを作成し、そのテーブルにデータを挿入します。

    ```SQL
      CREATE TABLE t1_similarity 
      (id int, data array<float>)
      DISTRIBUTED BY HASH(id);
      
      INSERT INTO t1_similarity VALUES
      (1, array<float>[0.1, 0.2, 0.3]), 
      (2, array<float>[0.2, 0.1, 0.3]), 
      (3, array<float>[0.3, 0.2, 0.1]);
    ```

2. `cosine_similarity_norm` 関数を使用して、`data` 列の各行の値が配列 `[0.1, 0.2, 0.3]` との類似度を計算し、結果を降順で並べ替えます。

    ```Plain
      SELECT id, data, cosine_similarity_norm([0.1, 0.2, 0.3], data) as dist
      FROM t1_similarity 
      ORDER BY dist DESC;
      
      +------+---------------+------------+
      | id   | data          | dist       |
      +------+---------------+------------+
      |    1 | [0.1,0.2,0.3] | 0.14000002 |
      |    2 | [0.2,0.1,0.3] | 0.13000001 |
      |    3 | [0.3,0.2,0.1] | 0.10000001 |
      +------+---------------+------------+
    ```
