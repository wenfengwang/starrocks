---
displayed_sidebar: Chinese
---

# cosine_similarity

## 機能

二つのベクトルのコサイン類似度を計算して、ベクトル間の類似度を評価します。

類似度の値は -1 から 1 の間です。二つのベクトルの角度が 0°、つまり二つのベクトルの方向が重なる時、類似度は 1 です；角度が 180°、つまり二つのベクトルの方向が反対の時、類似度は -1 です；角度が 90°、つまり二つのベクトルの方向が垂直の時、類似度は 0 です。

値が 1 に近づくほど、二つのベクトルの方向が近づきます；-1 に近づくほど、方向が反対になります；0 に近づくほど、二つのベクトルはほぼ直交していることを意味します。

コサイン類似度は、テキストの類似度やビデオの類似度などのシナリオでよく使用されます。

この関数はベクトルを正規化した後、コサイン類似度を計算します。入力されたベクトルが既に正規化されている場合は、[cosine_similarity_norm](./cos_similarity_norm.md) を使用できます。

## 文法

```Haskell
cosine_similarity(a, b)
```

## パラメータ説明

`a` と `b` は比較される二つのベクトルで、次元が同じでなければなりません。値は `Array<float>` 型でなければならず、つまり Array の要素は FLOAT 型のみをサポートします。注意：二つの配列の要素数は同じでなければならず、そうでない場合はエラーが返されます。

## 戻り値の説明

FLOAT 型の値を返し、値の範囲は [-1, 1] です。入力パラメータが NULL または無効な型の場合は、エラーを返します。

## 例

1. ベクトルを保存するためのテーブルを作成し、そのテーブルにデータを挿入します。

   ```SQL
      CREATE TABLE t1_similarity 
      (id int, data array<float>)
      DISTRIBUTED BY HASH(id);
      
      INSERT INTO t1_similarity VALUES
      (1, array<float>[0.1, 0.2, 0.3]), 
      (2, array<float>[0.2, 0.1, 0.3]), 
      (3, array<float>[0.3, 0.2, 0.1]);
    ```

2. `cosine_similarity` 関数を使用して、`data` 列の各行の値が配列 `[0.1, 0.2, 0.3]` との類似度を計算し、結果を降順で並べ替えます。

    ```Plain
      SELECT id, data, cosine_similarity(array<float>[0.1, 0.2, 0.3], data) as dist
      FROM t1_similarity 
      ORDER BY dist DESC;
      
      +------+---------------+-----------+
      | id   | data          | dist      |
      +------+---------------+-----------+
      |    1 | [0.1,0.2,0.3] | 0.9999999 |
      |    2 | [0.2,0.1,0.3] | 0.9285713 |
      |    3 | [0.3,0.2,0.1] | 0.7142856 |
      +------+---------------+-----------+
    ```
