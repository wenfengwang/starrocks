---
displayed_sidebar: Chinese
---

# array_map

## 機能

array_map() は Lambda 式をサポートする高階関数です。入力された `arr1`、`arr2` などの配列を `lambda_function` に従って変換し、新しい配列を出力します。Lambda 式の詳細については、[Lambda expression](../Lambda_expression.md) を参照してください。この関数はバージョン 2.5 からサポートされています。

この関数は多次元配列をサポートし、変数をキャプチャするためにネストされた Lambda 関数を使用できます。

array_map() の別名は transform() です。

## 文法

```Haskell
array_map(lambda_function, arr1, arr2...)
array_map(arr1, arr2..., lambda_function)
```

## 注意事項

- Lambda 関数は高階関数の最初または最後の引数としてのみ使用できます。最初の位置にあっても最後の位置にあっても、計算プロセスに影響はありません。
- 配列引数の数は Lambda 関数の引数の数と等しくなければなりません。そうでない場合はエラーが発生します。
- すべての入力配列の要素数は同じでなければなりません。そうでない場合はエラーが発生します。

## 例

例1：配列 [1,2,3] の各要素に 100 を加算します。

```SQL
select array_map(x -> x + 100, [1,2,3]);
+------------------------------------+
| array_map(x -> x + 100, [1, 2, 3]) |
+------------------------------------+
| [101,102,103]                      |
+------------------------------------+
```

例2：配列 array1 [1,2,3] と配列 array2 [11,12,13] の対応する位置の要素を加算します。

```SQL
select array_map((x,y) -> x + y, [1,2,3], [11,12,13]);
+-----------------------------------------------------+
| array_map((x, y) -> x + y, [1, 2, 3], [11, 12, 13]) |
+-----------------------------------------------------+
| [12,14,16]                                          |
+-----------------------------------------------------+
```

例3：条件判断を通じて、x の要素が 1.5 より大きい場合は対応する位置の要素として log(x) を返し、x の要素が 1.5 以下の場合は x + y を返します。

```SQL
select array_map((x,y) -> if(x > 1.5, log(x), x + y), [1,2,3], [11,12,13]);
+--------------------------------------------------------------------------+
| array_map((x, y) -> if(x > 1.5, log(x), x + y), [1, 2, 3], [11, 12, 13]) |
+--------------------------------------------------------------------------+
| [12,0.6931471805599453,1.0986122886681098]                               |
+--------------------------------------------------------------------------+
```

例4：array_map() を使用して変数をキャプチャします。1 と返される位置は条件を満たす位置です。

```SQL
-- 例の表：last_avg は各学生の前回の平均点を記録し、score は今回の3科目の成績を記録します。
+------+----------+------------+
| id   | last_avg | score      |
+------+----------+------------+
|    1 |       55 | [50,60,70] |
|    2 |       73 | [70,65,75] |
|    3 |       89 | [88,92,90] |
+------+----------+------------+

-- 前回の平均点より高い今回の試験の科目を見つけます。
select array_map(x -> x > last_avg, score) from test_tbl;
+--------------------------------------+
| array_map(x -> x > last_avg, score)  |
+--------------------------------------+
| [0,1,1]                              |
| [0,0,1]                              |
| [0,1,1]                              |
+--------------------------------------+
```

例5：Lambda 関数のネスト。

```SQL
select array_map(x -> array_map(x -> x + 100, x), [[1,2.3],[4,3,2]]);
+-------------------------------------------------------------------+
| array_map(x -> array_map(x -> x + 100, x), [[1, 2.3], [4, 3, 2]]) |
+-------------------------------------------------------------------+
| [[101,102.3],[104,103,102]]                                       |
+-------------------------------------------------------------------+
```

例6：Lambda 関数の引数の数と入力された配列の数が一致しない場合（関数は1つの配列を必要としますが、2つの配列が入力されました）、エラーが返されます。

```SQL
select array_map(x -> x, [1], [2,4]);
ERROR 1064 (HY000): Lambda arguments should equal to lambda input arrays.
```
