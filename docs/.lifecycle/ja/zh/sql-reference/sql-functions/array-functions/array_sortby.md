---
displayed_sidebar: Chinese
---

# array_sortby

## 機能

配列内の要素を別のキー値配列の要素、またはLambda関数によって生成されたキー値配列の要素に基づいて昇順に並べ替えます。Lambda式の詳細については、[Lambda expression](../Lambda_expression.md)を参照してください。この関数はバージョン2.5からサポートされています。

例えば、2つの配列 a = [3,1,4]、b = [7,5,6]があります。`b`をソートキーとして、`a`の要素を並べ替えます。

キー値の関係により、`b`の要素[7,5,6]は`a`の要素[3,1,4]にそれぞれ対応します。

変換前：

| 配列  | 第一要素  | 第二要素 | 第三要素 |
| ---- | ---------- | ---------- | ---------- |
| a    | 3          | 1          | 4          |
| b    | 7          | 5          | 6          |

変換後、bは昇順に[5,6,7]に並べ替えられ、対応するaの要素の位置もそれに応じて[1,4,3]に変更されます。

| 配列 | 第一要素 | 第二要素 | 第三要素 |
| ---- | ---------- | ---------- | ---------- |
| a    | 1          | 4          | 3          |
| b    | 5          | 6          | 7          |

## 文法

```Haskell
array_sortby(array0, array1)
array_sortby(<lambda_function>, array0 [, array1...])
```

- `array_sortby(array0, array1)`

  `array1`のキー値配列の要素に基づいて`array0`を昇順に並べ替えます。

- `array_sortby(<lambda_function>, array0 [, array1...])`

  `lambda_function`によって生成されたキー値配列の要素に基づいて`array0`を昇順に並べ替えます。

## パラメータ説明

- `array0`：並べ替える必要がある配列。サポートされるデータ型はARRAY、または`null`です。配列内の要素は並べ替え可能でなければなりません。
- `array1`：並べ替えに使用するキー値配列。サポートされるデータ型はARRAY、または`null`です。
- `lambda_function`：Lambda関数。キー値配列を生成するために使用されます。

## 戻り値の説明

戻り値のデータ型はARRAYです。

## 注意事項

- 昇順の並べ替えのみをサポートしています。
- 降順に並べ替える必要がある場合は、並べ替えた結果に[reverse()](../string-functions/reverse.md)関数を呼び出すことができます。
- `null`値は最前面に配置されます。
- 戻り値の配列内の要素の型と入力配列内の要素の型は一致し、`null`属性も一致します。
- 並べ替えに使用するキー値配列または式が`null`の場合、データは変更されません。
- 並べ替えに関わる2つの配列の要素数は一致していなければならず、そうでない場合はエラーが返されます。

## 例

以下の例では、次のデータテーブルを使用します。

```SQL
CREATE TABLE `test_array` (
  `c1` int(11) NULL COMMENT "",
  `c2` ARRAY<int(11)> NULL COMMENT "",
  `c3` ARRAY<int(11)> NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`c1`)
COMMENT "OLAP"
DISTRIBUTED BY HASH(`c1`)
PROPERTIES (
"replication_num" = "3",
"storage_format" = "DEFAULT",
"enable_persistent_index" = "false",
"compression" = "LZ4"
);

insert into test_array values
(1,[4,3,5],[82,1,4]),
(2,null,[23]),
(3,[4,2],[6,5]),
(4,null,null),
(5,[],[]),
(6,NULL,[]),
(7,[],null),
(8,[null,null],[3,6]),
(9,[432,21,23],[5,4,null]);

select * from test_array order by c1;
+------+-------------+------------+
| c1   | c2          | c3         |
+------+-------------+------------+
|    1 | [4,3,5]     | [82,1,4]   |
|    2 | NULL        | [23]       |
|    3 | [4,2]       | [6,5]      |
|    4 | NULL        | NULL       |
|    5 | []          | []         |
|    6 | NULL        | []         |
|    7 | []          | NULL       |
|    8 | [null,null] | [3,6]      |
|    9 | [432,21,23] | [5,4,null] |
+------+-------------+------------+
9 rows in set (0.00 sec)
```

例1：配列`c3`を`c2`の値に基づいて昇順に並べ替えます。

```Plaintext
select c1, c3, c2, array_sort(c2), array_sortby(c3,c2)
from test_array order by c1;
+------+------------+-------------+----------------+----------------------+
| c1   | c3         | c2          | array_sort(c2) | array_sortby(c3, c2) |
+------+------------+-------------+----------------+----------------------+
|    1 | [82,1,4]   | [4,3,5]     | [3,4,5]        | [1,82,4]             |
|    2 | [23]       | NULL        | NULL           | [23]                 |
|    3 | [6,5]      | [4,2]       | [2,4]          | [5,6]                |
|    4 | NULL       | NULL        | NULL           | NULL                 |
|    5 | []         | []          | []             | []                   |
|    6 | []         | NULL        | NULL           | []                   |
|    7 | NULL       | []          | []             | NULL                 |
|    8 | [3,6]      | [null,null] | [null,null]    | [3,6]                |
|    9 | [5,4,null] | [432,21,23] | [21,23,432]    | [4,null,5]           |
+------+------------+-------------+----------------+----------------------+
```

例2：Lambda式によって生成されたキー値配列に基づいて配列`c3`を昇順に並べ替えます。この関数は前の例と同等の機能を持っています。

```Plaintext
select 
    c1,
    c3,
    c2,
    array_sort(c2) as sorted_c2_asc,
    array_sortby((x,y) -> y, c3, c2) as sorted_c3_by_c2
from test_array order by c1;
+------+------------+-------------+---------------+-----------------+
| c1   | c3         | c2          | sorted_c2_asc | sorted_c3_by_c2 |
+------+------------+-------------+---------------+-----------------+
|    1 | [82,1,4]   | [4,3,5]     | [3,4,5]       | [1,82,4]        |
|    2 | [23]       | NULL        | NULL          | [23]            |
|    3 | [6,5]      | [4,2]       | [2,4]         | [5,6]           |
|    4 | NULL       | NULL        | NULL          | NULL            |
|    5 | []         | []          | []            | []              |
|    6 | []         | NULL        | NULL          | []              |
|    7 | NULL       | []          | []            | NULL            |
|    8 | [3,6]      | [null,null] | [null,null]   | [3,6]           |
|    9 | [5,4,null] | [432,21,23] | [21,23,432]   | [4,null,5]      |
+------+------------+-------------+---------------+-----------------+
```

例3：配列`c3`を`c2`と`c3`の合計に基づいて昇順に並べ替えます。

```SQL
select
    c3,
    c2,
    array_map((x,y)-> x+y,c3,c2) as sum,
    array_sort(array_map((x,y)-> x+y,c3,c2)) as sorted_sum,
    array_sortby((x,y) -> x+y , c3,c2) as sorted_c3_by_sum
from test_array where c1=1;
+----------+---------+----------+------------+------------------+
| c3       | c2      | sum      | sorted_sum | sorted_c3_by_sum |
+----------+---------+----------+------------+------------------+
| [82,1,4] | [4,3,5] | [86,4,9] | [4,9,86]   | [1,4,82]         |
+----------+---------+----------+------------+------------------+
```

## 関連文書

[array_sort](./array_sort.md)
