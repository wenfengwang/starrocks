---
displayed_sidebar: Chinese
---

# 产品特性

## MPP 分布式执行框架

StarRocksは、MPP（Massively Parallel Processing）分散実行フレームワークを採用しています。MPP実行フレームワークでは、クエリリクエストは複数の物理計算ユニットに分割され、複数のマシンで並列実行されます。各実行ノードは専有のリソース（CPU、メモリ）を持っています。MPP実行フレームワークにより、単一のクエリリクエストはすべての実行ノードのリソースを最大限に活用できるため、クラスタのスケーラビリティが向上し、単一のクエリのパフォーマンスが向上します。

![MPP1](../assets/1.1-3-mpp.png)

上図のように、StarRocksはクエリを論理的に複数のクエリフラグメントに分割します。各論理的な実行単位は、処理する計算量に応じて1つまたは複数の物理実行単位で具体的に実装されます。物理実行単位は最小のスケジューリング単位です。物理実行単位はクラスタの特定のBEにスケジュールされて実行されます。1つの論理実行単位には、スキャン、プロジェクト、集計などの実行演算子が含まれる場合があります。各物理実行単位は一部のデータのみを処理します。各論理実行単位の処理の複雑さが異なるため、各論理実行単位の並列度も異なります。つまり、**異なる論理実行単位は、異なる数の物理実行単位によって具体的に実行され、リソースの使用効率を向上させ、クエリの速度を向上させることができます。**

![MPP1](../assets/1.1-4-mpp.png)

多くのデータ分析システムが使用するScatter-Gather分散実行フレームワークとは異なり、MPP分散実行フレームワークはより多くのリソースを使用してクエリリクエストを処理できます**。**Scatter-Gatherフレームワークでは、ギャザーノードのみが最終段階の集計計算を処理できます**。**しかし、MPPフレームワークでは、データが複数のノードにシャッフルされ、複数のノードで最終的な集計計算が行われます**。**複雑な計算（高基数のGroup By、大規模なJoinなど）の場合、StarRocksのMPPフレームワークはScatter-Gatherモードの製品に比べて明らかなパフォーマンスの利点があります。

## 全面的なベクトル化実行エンジン

StarRocksは、CPUの処理能力を最大限に活用するために、全面的なベクトル化エンジンを実装しています。ベクトル化エンジンは、列指向の方法でデータを組織化および処理します。StarRocksのデータストレージ、メモリ内のデータの組織方法、およびSQL演算子の計算方法はすべて列指向で実装されています。列指向のデータ組織は、CPUのキャッシュをより効果的に利用し、列ごとの計算では、より少ない仮想関数呼び出しと分岐判定が行われ、より効果的なCPU命令パイプラインを実現します。

一方、StarRocksの全面的なベクトル化エンジンは、CPUが提供するSIMD（Single Instruction Multiple Data）命令を最大限に活用します。これにより、StarRocksはより少ない命令数でより多くのデータ操作を実行できます。標準的なテストセットによる検証では、StarRocksの全面的なベクトル化エンジンにより、演算子のパフォーマンスが3〜10倍向上します。

すべての演算子をベクトル化技術で実装するだけでなく、StarRocksは実行エンジンに他の最適化も実装しています。例えば、StarRocksはエンコードされたデータの操作を実現する技術を実装しています。文字列フィールドの操作では、StarRocksはデコードせずにエンコードされたフィールドを直接使用して演算子を実行できます。これにより、関連するクエリの計算の複雑さを大幅に低減できます。この最適化手法により、関連するクエリの速度を2倍以上向上させることができます。

## ストレージと計算の分離

StarRocks 3.0では、新しい[ストレージと計算の分離モード](./Architecture.md)がサポートされ、計算とストレージの完全なデカップリング、計算ノードの弾力的なスケーリング、ホットデータの高性能キャッシュが実現されています。ストレージと計算が分離されたモードでは、StarRocksは柔軟なスケーラビリティ、高性能、高信頼性、低コストなどの特徴を備えています。

![共有データ（shared-data）](../assets/share_data_arch.png)

ストレージと計算が分離されたモードでは、ストレージと計算が別々のサービスとして独立しており、独自のスケーリングと拡張が可能です。これにより、ストレージと計算が比例してスケーリングする統合モードにおけるリソースの浪費問題が解決されます。計算ノードはダイナミックなスケーリングを秒単位で実現し、計算リソースの利用率を向上させることができます。

ストレージ層は、オブジェクトストレージのほぼ無制限の容量とデータの高可用性の特徴を活用して、大量のデータのストレージと永続化を実現します。AWS S3、Azure Blob Storage、Google Cloud Storage、阿里云 OSS、腾讯云 COS、火山引擎 TOS、华为云 OBSなどのS3プロトコル互換のオブジェクトストレージをサポートし、HDFSストレージもサポートしています。

デプロイメントモードでは、ユーザーはパブリッククラウド、プライベートクラウド、オンプレミスデータセンターに基づいて選択できます。StarRocksのストレージと計算の分離モードは、Kubernetesに基づいたデプロイメントもサポートし、自動化されたデプロイメントを容易にするための適切なオペレータも提供しています。

StarRocksのストレージと計算の分離モードは、統合モードと同等の機能を提供し、書き込みおよびホットデータのクエリパフォーマンスも統合モードとほぼ同等です。ストレージの分離モードでは、データの更新、データレイク分析、物理ビューアクセラレーションなど、さまざまなシナリオを実現できます。

[ストレージと計算の分離モード](../deployment/shared_data/s3.md)

## CBO最適化エンジン

![CBO](../assets/1.1-5-cbo.png)

複数のテーブルの関連クエリの場合、優れた実行エンジンだけでは最高の実行性能を得ることはできません。なぜなら、このようなシナリオでは、異なる実行計画の複雑さが数桁も異なる可能性があるからです。クエリ内の関連テーブルの数が増えるほど、可能な実行計画の数も増え、最適な計画を選択することはNP-Hardな問題です。最適なクエリオプティマイザを持つことで、相対的に最適なクエリプランを選択し、最高の多テーブル分析パフォーマンスを実現できます。

StarRocksは、ゼロから設計されたコストベースの最適化エンジンCBO（Cost Based Optimizer）を実装しています。この最適化エンジンはCascades Likeであり、StarRocksの全面的なベクトル化エンジンに合わせて深くカスタマイズされ、さまざまな最適化とイノベーションが行われています。この最適化エンジンは、共通の式の再利用、関連するサブクエリの書き換え、Lateral Join、Join Reorder、Joinの分散実行戦略の選択、低基数辞書の最適化など、重要な機能と最適化を内部で実装しています。現在、この最適化エンジンはTPC-DSの99のSQLステートメントを完全にサポートしています。

新しいCBOのサポートにより、StarRocksは他の同様の製品よりも優れた多テーブルの関連クエリをサポートできます。特に複雑な多テーブルの関連クエリにおいて、全面的なベクトル化エンジンのパフォーマンスを最大限に引き出すことができます。

## リアルタイム更新可能な列指向ストレージエンジン

StarRocksは、列指向のストレージエンジンを実装しており、データは列単位でストレージされます。この方法により、同じタイプのデータが連続して格納されます。一方、データはより効率的なエンコーディング方式を使用することができ、より高い圧縮率を得ることができ、ストレージコストを削減することができます。また、システムが読み取るデータのI/O量を減らし、クエリのパフォーマンスを向上させることもできます。さらに、ほとんどのOLAPシナリオでは、クエリは一部の列のみを対象とします。行指向と比較して、列指向では一部の列のデータのみを読み取るため、ディスクI/Oスループットを大幅に削減することができます。

StarRocksは、秒単位のインポート遅延をサポートし、リアルタイムのサービス能力を提供することができます。StarRocksのストレージエンジンは、データのインポート時にACIDの各操作を保証することができます。バッチのデータインポートはアトミックに有効になります。つまり、すべてのデータが正常にインポートされるか、すべて失敗するかのいずれかです。並行して実行されるトランザクションは互いに影響を与えず、トランザクションのスナップショット分離レベルを提供します。

![columnar_storage_engine](../assets/1.1-6-realtime.png)

StarRocksのストレージエンジンは、高効率な部分更新操作だけでなく、効率的なUpsert操作も提供することができます。主キーインデックスを使用してデータを高速にフィルタリングし、読み取り時のソートとマージ操作を回避するため、他のセカンダリインデックスを十分に活用することができます。大量の更新が行われるシナリオでも、クエリの高速パフォーマンスを保証することができます。

## スマートなマテリアライズドビュー

![materialized_view](../assets/1.2-7-mv.png)

StarRocksは、マテリアライズドビュー（物理ビュー）を使用してクエリの高速化とデータウェアハウスの階層化をサポートしています。他の一部の類似製品とは異なり、マテリアライズドビューは元のテーブルとのデータ同期を手動で行う必要はありません。StarRocksのマテリアライズドビューは、元のテーブルの更新に応じて自動的にデータを更新します。元のテーブルのデータが変更されると、マテリアライズドビューも同期され、追加のメンテナンス操作なしでマテリアライズドビューが元のテーブルと同じ状態を維持できます。さらに、マテリアライズドビューの選択も自動的に行われます。StarRocksは、クエリプランニング時に適切なマテリアライズドビューがクエリの高速化に役立つ場合、クエリのリライト（クエリの自動的な変更）を自動的に行い、クエリを最適なマテリアライズドビューに自動的にマッピングします。

StarRocksのマテリアライズドビューは、必要に応じて柔軟に作成および削除することができます。ユーザーは、実際の使用状況に基づいてマテリアライズドビューの作成や削除の必要性を判断することができます。StarRocksは、バックグラウンドでマテリアライズドビューの関連調整を自動的に行います。

StarRocksのマテリアライズドビューは、従来のETLモデリングプロセスを置き換えることができ、上流のアプリケーションでのデータ変換は不要で、マテリアライズドビューの使用時にデータ変換を行うことができます。これにより、データ処理プロセスが簡素化されます。

例えば、図のように、最下層のODSの湖上データは、External Catalog MVを使用してDWDレイヤーの正規化テーブルを構築することができます。また、複数のテーブルの関連するマテリアライズドビューを使用して、DWSレイヤーのデノーマライズテーブルを構築することもできます。最上層では、高並行クエリをサポートするためにリアルタイムのマテリアライズドビューをさらに構築することができます。

## データレイク分析

![datalake_analytics](../assets/1.2-8.png)

StarRocksは、ローカルストレージのデータを効率的に分析するだけでなく、計算エンジンとしてデータレイクのデータを直接分析することもできます。ユーザーは、StarRocksが提供するExternal Catalogを使用して、Apache Hive、Apache Iceberg、Apache Hudi、Delta Lakeなどのデータレイク上に格納されているデータを簡単にクエリできます。サポートされるストレージシステムには、HDFS、S3、OSSがあり、サポートされるファイル形式には、Parquet、ORC、CSVがあります。

上図のように、データレイク分析シナリオでは、StarRocksはデータの計算分析を担当し、データレイクはデータのストレージ、組織、およびメンテナンスを主に担当します。データレイクを使用する利点は、オープンなストレージ形式と柔軟で多様なスキーマ定義方法を使用できるため、BI/AI/Adhoc/レポートなどのビジネスに統一されたシングルソースオブトゥルースを提供できることです。データレイクの計算エンジンとしてのStarRocksは、ベクトル化エンジンとCBOの利点を最大限に活用し、データレイク分析のパフォーマンスを大幅に向上させます。
