---
displayed_sidebar: Chinese
---

# ユーザー定義変数

この文書では、ユーザー定義変数の宣言と使用方法について説明します。

バージョン 2.5 以降、StarRocks はユーザー定義変数（user-defined variables）の宣言をサポートしています。ユーザー定義変数は特定の値を格納し、後で SQL ステートメントで参照するために使用され、SQL ステートメントの記述を簡素化し、繰り返し計算を避けることができます。

## 使用説明

- 現在はセッションレベルのユーザー定義変数の宣言のみをサポートしており、ユーザーは自分が宣言したユーザー定義変数のみを使用でき、クライアントが切断された場合、そのセッション内のすべてのユーザー定義変数は無効になります。
- StarRocks は現在、SHOW ステートメントを使用して既存のユーザー定義変数を表示することはサポートしていません。
- BITMAP、HLL、PERCENTILE、ARRAY 型のユーザー定義変数の宣言はサポートされておらず、JSON 型のユーザー定義変数は STRING 型として格納されます。

## ユーザー定義変数の宣言

### 文法

```Plain
SET @var_name = expr [, ...];
```

> **説明**
>
> - ユーザー定義変数を宣言する際は、プレフィックス `@` を付ける必要があります。
> - 複数のユーザー定義変数を同時に宣言することができ、変数間はコンマ (,) で区切ります。
> - 同じユーザー定義変数を複数回宣言することができ、新しく宣言された値で元の値が上書きされます。
> - SQL ステートメント内で宣言されていない変数を参照した場合、その変数の値はデフォルトで `NULL` であり、STRING 型になります。

### パラメータ説明

| **パラメータ** | **必須** | **説明**                                                     |
| -------------- | -------- | ------------------------------------------------------------ |
| var_name       | はい     | ユーザー定義変数の名前。命名規則は以下の通りです：<ul><li>アルファベット (a-z または A-Z)、数字 (0-9)、アンダースコア (\_) で構成される必要があります。</li><li>全長は 64 文字を超えることはできません。</li></ul>例えば、@'my-var'、@"my-var"、@\`my-var\` などです。文字列型の変数名には、アルファベット、数字、アンダースコア (_) 以外の文字も含めることができます。例えばピリオド (.) などです。|
| expr           | はい     | ユーザー定義変数に格納される値。`43` のような単純な値もサポートされているほか、SELECT クエリの戻り値のような複雑な式もサポートされています。式の計算結果のデータ型が変数のデータ型になります。|

### 例

例 1：数値をユーザー定義変数として宣言します。

```SQL
SET @var = 43;
```

例 2：SELECT ステートメントの戻り値をユーザー定義変数として宣言します。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

例 3：複数の変数を一度に宣言します。

```SQL
SET @v1=1, @v2=2;
```

## **使用シナリオ**

- SQL ステートメントの記述を簡素化します。以下の例では、SELECT ステートメントを実行するときに、`@var` が `1` に置き換えられます。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 繰り返し計算を避けます。以下の例では、SELECT ステートメントを実行するときに、`@var` が `select sum(c1) from tbl` コマンドの計算結果に置き換えられます。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```
