---
displayed_sidebar: Chinese
---

# StarRocks クラスターの計画

この文書では、StarRocks のプロダクションクラスターをデプロイするためのリソース計画について説明します。ノード数、CPU コア数、メモリサイズ、ストレージサイズの観点から StarRocks クラスターを計画する必要があります。

## ノード数

StarRocks は主に二つのタイプのコンポーネントで構成されています：FE ノードと BE ノード。各ノードは物理マシンまたは仮想マシンに個別にデプロイする必要があります。

### FE ノード数

FE ノードは主にメタデータ管理、クライアント接続管理、クエリプランニング、クエリスケジューリングを担当します。

StarRocks のプロダクションクラスターには、シングルポイント障害を防ぐために、少なくとも**3つ**の Follower FE ノードをデプロイすることをお勧めします。

StarRocks は BDB JE プロトコルを使用して FE ノード間でメタデータを管理します。StarRocks はすべての Follower FE ノードの中から Leader FE ノードを選出します。Leader FE ノードのみがメタデータを書き込むことができ、他の Follower FE ノードは Leader FE ノードのログに基づいてメタデータを更新することしかできません。Leader FE ノードがオフラインになった場合、半数以上の Follower FE ノードが生存していれば、StarRocks は新しい Leader FE ノードを再選出します。

アプリケーションが高い並行クエリリクエストを生成する場合、Observer FE ノードをクラスターに追加することができます。Observer FE ノードはクエリリクエストの処理のみを担当し、Leader FE ノードの選出には参加しません。

### BE ノード数

BE ノードはデータストレージと SQL 実行を担当します。

StarRocks のプロダクションクラスターには、少なくとも3つの BE ノードをデプロイすることをお勧めします。これらのノードは自動的に BE 高可用性クラスターを形成し、シングルポイント障害が発生した場合のデータの信頼性とサービスの可用性に影響を与えることを避けます。

クエリの高い並行性を実現するために、BE ノードの数を増やすことができます。

### CN ノード数

CN ノードは StarRocks のオプションコンポーネントで、SQL 実行のみを担当します。

クラスター内のデータ分布を変更することなく、計算リソースを弾力的に拡張するために、CN ノードの数を増やすことができます。

## CPU とメモリ

通常、FE サービスは多くの CPU とメモリリソースを消費しません。各 FE ノードには 8 つの CPU コアと 16 GB の RAM を割り当てることを推奨します。

FE サービスとは異なり、アプリケーションが大規模なデータセットで高度に並行したり複雑なクエリを処理する必要がある場合、BE サービスは多くの CPU とメモリリソースを使用する可能性があります。そのため、各 BE ノードには 16 つの CPU コアと 64 GB の RAM を割り当てることを推奨します。

## ストレージスペース

### FE ストレージ

FE ノードはそのストレージに StarRocks のメタデータのみを保持しているため、ほとんどのシナリオでは、各 FE ノードには 100 GB の HDD ストレージが必要です。

### BE ストレージ

#### BE 初期ストレージスペースの見積もり

StarRocks クラスターに必要な総ストレージスペースは、原始データのサイズ、データレプリカの数、および使用されるデータ圧縮アルゴリズムの圧縮率によって影響を受けます。

以下の式を使用して、すべての BE ノードに必要な総ストレージスペースを見積もることができます：

```Plain
BE ノードに必要な総ストレージスペース = 原始データサイズ * データレプリカ数 / データ圧縮アルゴリズムの圧縮率

原始データサイズ = 1 行あたりのデータサイズ * 総データ行数
```

StarRocks では、テーブル内のデータは最初に複数のパーティション（Partition）に分割され、さらに複数のタブレット（Tablet）に分割されます。タブレットは StarRocks の基本的なデータ管理の論理単位です。データの高い信頼性を保証するために、各タブレットに複数のレプリカを保持し、異なる BE ノードに保存することができます。StarRocks はデフォルトで3つのレプリカを維持します。

現在、StarRocks は四つのデータ圧縮アルゴリズムをサポートしています：zlib、Zstandard（または zstd）、LZ4、Snappy（圧縮率が高い順に並べています）。これらのデータ圧縮アルゴリズムは 3:1 から 5:1 の圧縮率を提供することができます。

総ストレージスペースを計算した後、クラスター内の BE ノード数で割って、各 BE ノードに必要な平均ストレージスペースを見積もることができます。

#### 必要に応じて追加のストレージスペースを追加

BE ストレージスペースが原始データの増加によって枯渇した場合、クラスターを垂直または水平に拡張するか、クラウドストレージを拡張してストレージスペースを補充することができます。

- StarRocks クラスターに新しい BE ノードを追加する

  StarRocks クラスターに新しい BE ノードを追加することで、データをより多くのノードに再分配することができます。詳細については、[StarRocks の拡張 - BE クラスターの拡張](../administration/Scale_up_down.md)を参照してください。

  新しい BE ノードを追加した後、StarRocks は自動的にすべての BE ノード間でデータの分布を再バランスします。すべてのデータモデルはこの自動バランスをサポートしています。

- BE ノードに追加のストレージボリュームを追加する

  既存の BE ノードに追加のストレージボリュームを追加することもできます。詳細については、[StarRocks の拡張 - BE クラスターの拡張](../administration/Scale_up_down.md)を参照してください。

  追加のストレージボリュームを追加した後、StarRocks は自動的にすべてのテーブルのデータを再バランスします。

- クラウドストレージスペースを追加する

  StarRocks クラスターがクラウド上にデプロイされている場合、必要に応じてクラウドストレージを拡張することができます。詳細はクラウドプロバイダーにお問い合わせください。
