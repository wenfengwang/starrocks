---
displayed_sidebar: "Japanese"
---

# StarRocksクラスタの計画

このトピックでは、ノード数、CPUコア数、メモリサイズ、およびストレージサイズの観点から、StarRocksクラスタのリソースをプロダクション環境で計画する方法について説明します。

## ノード数

StarRocksは主に2種類のコンポーネント、FEノードとBEノードで構成されています。各ノードは物理マシンまたは仮想マシンに個別にデプロイする必要があります。

### FEノード数

FEノードは、メタデータ管理、クライアント接続管理、クエリプランニング、クエリスケジューリングを主に担当しています。

プロダクション環境では、StarRocksクラスタには少なくとも**3つ**のFollower FEノードをデプロイすることを推奨します。これにより、単一障害点（SPOF）を防ぐことができます。

StarRocksはBDB JEプロトコルを使用してFEノード間のメタデータを管理します。StarRocksはすべてのFollower FEノードからLeader FEノードを選出します。Leader FEノードのみがメタデータを書き込むことができます。他のFollower FEノードは、Leader FEノードのログに基づいてメタデータを更新します。Leader FEノードが障害を起こした場合、StarRocksはFollower FEノードの半数以上が稼働している限り、新しいLeader FEノードを選出します。

アプリケーションが高並行のクエリリクエストを生成する場合、クラスタにObserver FEノードを追加することができます。Observer FEノードはクエリリクエストの処理のみを行い、Leader FEノードの選出には参加しません。

### BEノード数

BEノードはデータのストレージとSQLの実行を担当しています。

プロダクション環境では、StarRocksクラスタには少なくとも**3つ**のBEノードをデプロイすることを推奨します。これにより、データの信頼性とサービスの可用性を高めることができます。少なくとも3つのBEノードがデプロイされ、StarRocksクラスタに追加されると、BEの高可用性クラスタが自動的に形成されます。1つのBEノードの障害は、BEサービス全体の可用性に影響を与えません。

BEノードの数を増やすことで、StarRocksクラスタが高並行のクエリを処理できるようにすることができます。

### CNノード数

CNノードはStarRocksのオプションのコンポーネントであり、SQLの実行のみを担当しています。

CNノードの数を増やすことで、StarRocksクラスタのデータ分散を変更せずにコンピュートリソースを弾力的にスケールアップすることができます。

## CPUとメモリ

通常、FEサービスは多くのCPUとメモリリソースを消費しません。各FEノードには8つのCPUコアと16GBのRAMを割り当てることを推奨します。

FEサービスとは異なり、BEサービスは、アプリケーションが高並行または複雑なクエリを大規模なデータセットで処理する場合、著しくCPUおよびメモリを消費する場合があります。そのため、各BEノードには16のCPUコアと64GBのRAMを割り当てることを推奨します。

## ストレージ容量

### FEストレージ

FEノードはStarRocksのメタデータのみをストレージに保持するため、ほとんどのシナリオでは1つのFEノードに対して100GBのHDDストレージが十分です。

### BEストレージ

#### BEの初期ストレージスペースを推定する

StarRocksクラスタが必要とする総ストレージスペースは、生データのサイズ、データのレプリカ数、および使用するデータ圧縮アルゴリズムの圧縮比によって同時に影響を受けます。

次の式を使用して、すべてのBEノードに必要な総ストレージスペースを推定することができます。

```Plain
総BEストレージスペース = 生データサイズ * レプリカ数 / 圧縮比

生データサイズ = 行内のすべてのフィールドが占めるスペースの合計 * 行数
```

StarRocksでは、テーブルのデータはまず複数のパーティションに分割され、その後複数のタブレットに分割されます。タブレットはStarRocksのデータ管理の基本的な論理単位です。高いデータ信頼性を確保するために、各タブレットの複数のレプリカを維持し、それらを異なるBEに格納することができます。デフォルトでは、StarRocksは3つのレプリカを維持します。

現在、StarRocksは4つのデータ圧縮アルゴリズム（圧縮比の高い順に並べられています）をサポートしています。それらはzlib、Zstandard（またはzstd）、LZ4、およびSnappyです。これらは3:1から5:1の圧縮比を提供することができます。

総ストレージスペースを決定した後、クラスタ内のBEノードの数でそれを単純に分割することで、1つのBEノードあたりの平均ストレージスペースを推定することができます。

#### 必要に応じて追加のストレージを追加する

生データが増えるにつれてBEストレージスペースが不足する場合、クラスタを垂直または水平にスケールアップするか、単にクラウドストレージをスケールアップすることで補充することができます。

- StarRocksクラスタに新しいBEノードを追加する

  StarRocksクラスタに新しいBEノードを追加することで、データをより多くのノードに均等に再分散することができます。詳細な手順については、[StarRocksクラスタのスケールアップ/ダウン - BEのスケールアウト](../administration/Scale_up_down.md)を参照してください。

  新しいBEノードが追加されると、StarRocksは自動的にすべてのBEノード間でデータを再バランスします。このような自動バランシングは、すべてのテーブルタイプでサポートされています。

- 既存のBEノードに追加のストレージボリュームを追加する

  既存のBEノードに追加のストレージボリュームを追加することもできます。詳細な手順については、[StarRocksクラスタのスケールアップ/ダウン - BEのスケールアップ](../administration/Scale_up_down.md)を参照してください。

  追加のストレージボリュームが追加されると、StarRocksはすべてのテーブルのデータを自動的に再バランスします。

- クラウドストレージを追加する

  StarRocksクラスタがクラウド上に展開されている場合、クラウドストレージを必要に応じてスケールアップすることができます。詳細な手順については、クラウドプロバイダにお問い合わせください。
