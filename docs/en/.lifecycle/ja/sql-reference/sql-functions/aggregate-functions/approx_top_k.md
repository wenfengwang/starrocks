---
displayed_sidebar: "Japanese"
---

# APPROX_TOP_K

## 説明

`expr`内で最も頻繁に発生する上位`k`個のアイテム値とその近似カウントを返します。

## 構文

```Haskell
APPROX_TOP_K(<expr> [ , <k> [ , <counter_num> ] ] )
```

## 引数

* `expr`：STRING、BOOLEAN、DATE、DATETIME、または数値型の式です。
* `k`：オプションの整数リテラルで、0より大きい値です。指定しない場合、デフォルト値は`5`です。
    * 最大値は`100000`です。
* `counter_num`：オプションの整数リテラルで、`k`以上の値です。`counter_num`が大きいほど、結果はより正確になりますが、CPUとメモリの使用量も増加します。
    * 最大値は`100000`です。
    * `counter_num`が指定されていない場合、デフォルト値は`max(min(2 * k, 100), 100000)`です。

## 戻り値

結果は、各STRUCTに`item`フィールド（元の入力タイプを持つ値）と`count`フィールド（BIGINT型）を含む、STRUCTのARRAYとして返されます。配列は`count`の降順でソートされます。

この集約関数は、式`expr`内で最も頻繁に発生する上位`k`個のアイテム値とその近似カウントを返します。各カウントの誤差は、`2.0 * numRows / counter_num`までになる場合があります。ここで、`numRows`は総行数です。`counter_num`の値が大きいほど、より正確な結果が得られますが、メモリ使用量も増加します。`counter_num`よりも少ない異なるアイテムを持つ式は、正確なアイテムのカウントを返します。結果には、NULL値も結果のアイテムとして含まれます。

## 例

```plain text
MySQL > SELECT APPROX_TOP_K(L_LINESTATUS) FROM lineitem;
+-------------------------------------------------------------+
| approx_top_k(L_LINESTATUS)                                  |
+-------------------------------------------------------------+
| [{"item":"O","count":3004998},{"item":"F","count":2996217}] |
+-------------------------------------------------------------+

MySQL > SELECT APPROX_TOP_K(L_LINENUMBER) FROM lineitem GROUP BY L_RETURNFLAG
+-------------------------------------------------------------------------------------------------------------------------------------+
| approx_top_k(L_LINENUMBER)                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------+
| [{"item":1,"count":761151},{"item":2,"count":652280},{"item":3,"count":543265},{"item":4,"count":434834},{"item":5,"count":326135}] |
| [{"item":1,"count":368853},{"item":2,"count":316830},{"item":3,"count":263950},{"item":4,"count":211270},{"item":5,"count":158495}] |
| [{"item":1,"count":369996},{"item":2,"count":316718},{"item":3,"count":264179},{"item":4,"count":210911},{"item":5,"count":158657}] |
+-------------------------------------------------------------------------------------------------------------------------------------+
```

## キーワード

APPROX_TOP_K
