---
displayed_sidebar: "Japanese"
---

# 特権の概要

このトピックでは、StarRocksの特権システムの基本的な概念について説明します。特権は、どのユーザーがどのオブジェクト上でどの操作を実行できるかを決定するため、データとリソースを細かく管理することができます。

> 注意: このトピックで説明されている特権は、v3.0以降でのみ利用可能です。v3.0の特権フレームワークと構文は、以前のバージョンと互換性がありません。v3.0にアップグレードした後、元の特権のほとんどは保持されますが、特定の操作に関する特権は保持されません。詳細な違いについては、[特権のアップグレードノート](privilege_item.md)を参照してください。

StarRocksは、2つの特権モデルを採用しています。

- ロールベースのアクセス制御（RBAC）: 特権はロールに割り当てられ、それらのロールはユーザーに割り当てられます。この場合、特権はロールを通じてユーザーに渡されます。
- アイデンティティベースのアクセス制御（IBAC）: 特権は直接ユーザーアイデンティティに割り当てられます。

したがって、各ユーザーアイデンティティの最大特権範囲は、そのユーザーアイデンティティ自体の特権と、このユーザーアイデンティティに割り当てられたロールの特権の結合です。

StarRocksの特権システムを理解するための**基本的な概念**:

- **オブジェクト**: アクセスが許可されるエンティティ。グラントによって許可されない限り、アクセスは拒否されます。オブジェクトの例には、CATALOG、DATABASE、TABLE、VIEWなどがあります。詳細については、[StarRocksでサポートされている特権](privilege_item.md)を参照してください。
- **特権**: オブジェクトへのアクセスレベルを定義します。複数の特権を使用して、オブジェクトに対して許可されるアクセスの粒度を制御することができます。特権はオブジェクト固有です。異なるオブジェクトには異なる特権がある場合があります。特権の例には、SELECT、ALTER、DROPなどがあります。
- **ユーザーアイデンティティ**: 特権を割り当てることができるユーザーの一意のアイデンティティであり、また特権を割り当てることができるエンティティでもあります。ユーザーアイデンティティは`username@'userhost'`として表され、ユーザー名とユーザーがログインするIPから構成されます。アイデンティティの使用は属性の設定を簡素化します。同じユーザー名を共有するユーザーアイデンティティは同じ属性を共有します。ユーザー名に属性を設定すると、この属性はこのユーザー名を共有するすべてのユーザーアイデンティティに対して有効になります。
- **ロール**: 特権を割り当てることができるエンティティ。ロールは特権の抽象的なコレクションです。ロールはユーザーに割り当てることもできます。ロールは他のロールにも割り当てることができ、ロールの階層を作成することができます。データ管理を容易にするために、StarRocksはシステム定義のロールを提供します。柔軟性を高めるために、ビジネス要件に応じてカスタムロールを作成することもできます。

以下の図は、RBACおよびIBAC特権モデルの下での特権管理の例を示しています。

これらのモデルでは、オブジェクトへのアクセスは、ロールとユーザーに割り当てられた特権を通じて許可されます。ロールは他のロールまたはユーザーに割り当てることもできます。

![特権管理](../assets/privilege-manage.png)

## オブジェクトと特権

オブジェクトは、関連する概念に関連する論理的な階層を持っています。たとえば、データベースはカタログに含まれ、テーブル、ビュー、マテリアライズドビュー、および関数はデータベースに含まれます。以下の図は、StarRocksシステムのオブジェクト階層を示しています。

![特権オブジェクト](../assets/privilege-object.png)

各オブジェクトには、付与できる特権アイテムのセットがあります。これらの特権は、これらのオブジェクト上で実行できる操作を定義します。[GRANT](../sql-reference/sql-statements/account-management/GRANT.md)および[REVOKE](../sql-reference/sql-statements/account-management/REVOKE.md)コマンドを使用して、特権をロールまたはユーザーから付与および取り消すことができます。

## ユーザー

### ユーザーアイデンティティ

StarRocksでは、各ユーザーは一意のユーザーIDで識別されます。ユーザーIDは、IPアドレス（ユーザーホスト）とユーザー名から構成され、`username @'userhost'`の形式です。StarRocksは、異なるIPアドレスからの同じユーザー名を持つユーザーを異なるユーザーアイデンティティとして識別します。たとえば、`user1@'``starrocks.com``'`と`user1@'``mirrorship.com``'`は2つのユーザーアイデンティティです。

ユーザーアイデンティティの別の表現方法は、`username @['domain']`です。ここで、`domain`はDNSによって一連のIPアドレスとして解決できるドメイン名です。`username @['domain']`は最終的に`username@'userhost'`のセットとして表されます。`userhost`の部分には`%`を使用して曖昧な一致を行うことができます。`userhost`が指定されていない場合、デフォルトで`'%'`になります。これは、同じ名前のユーザーが任意のホストからログインした場合を意味します。

### ユーザーに特権を付与する

ユーザーは、特権とロールの両方を割り当てることができるエンティティです。各ユーザーアイデンティティの最大特権範囲は、そのユーザーアイデンティティ自体の特権と、このユーザーアイデンティティに割り当てられたロールの特権の結合です。StarRocksは、各ユーザーが許可された操作のみを実行できるようにします。

ほとんどの場合、特権を渡すためには**ロールを使用することをお勧め**します。たとえば、ロールを作成した後、そのロールに特権を付与し、そのロールをユーザーに割り当てることができます。一時的な特権や特別な特権を付与する場合は、直接ユーザーに特権を付与することもできます。これにより、特権の管理が簡素化され、柔軟性が向上します。

## ロール

ロールは、特権を割り当てたり取り消したりすることができるエンティティです。ロールは、必要なアクションを実行するためにユーザーに割り当てることができる特権のコレクションと見なすことができます。ユーザーは複数のロールを割り当てられるため、異なる特権のセットを使用して異なるアクションを実行することができます。管理を簡素化するために、StarRocksでは、**ロールを介して特権を管理することをお勧め**します。特別な特権や一時的な特権は、直接ユーザーに付与することができます。

管理を容易にするために、StarRocksはいくつかの**システム定義のロール**を提供しています。これらのロールには特定の特権があり、日常の管理とメンテナンスの要件を満たすのに役立ちます。また、ビジネスの要件とセキュリティの要件に応じて、カスタムロールを作成することも柔軟に行うことができます。なお、システム定義のロールの特権範囲は変更できません。

ロールがアクティブになると、ユーザーはそのロールによって許可された操作を実行することができます。ユーザーがログインするときに自動的にアクティブ化される**デフォルトロール**を設定することができます。ユーザーは現在のセッションで所有するロールを手動でアクティブ化することもできます。

### システム定義のロール

StarRocksでは、いくつかのタイプのシステム定義のロールを提供しています。

![ロール](../assets/privilege-role.png)

- `root`: グローバル特権を持っています。デフォルトでは、`root`ユーザーは`root`ロールを持っています。
   StarRocksクラスタが作成されると、システムは自動的にroot特権を持つrootユーザーを生成します。rootユーザーとロールはシステムのすべての特権を持っているため、リスクのある操作を防ぐために、その後の操作には新しいユーザーとロールを作成することをお勧めします。rootユーザーのパスワードを適切に保管してください。
- `cluster_admin`: クラスタ管理特権を持ち、ノード関連の操作（ノードの追加や削除など）を実行できます。
  `cluster_admin`は、クラスタノードの追加、削除、および退役を行う特権を持っています。`cluster_admin`またはこのロールをデフォルトロールとして含むカスタムロールをユーザーに割り当てないようにすることで、予期しないノードの変更を防止してください。
- `db_admin`: カタログ、データベース、テーブル、ビュー、マテリアライズドビュー、関数、グローバル関数、リソースグループ、およびプラグインに対してすべての操作を実行する特権を持ちます。
- `user_admin`: ユーザーとロールに対する管理特権を持ち、ユーザー、ロール、および特権を作成する特権を持ちます。

  上記のシステム定義のロールは、複雑なデータベースの特権を集約して日常の管理を容易にするために設計されています。**上記のロールの特権範囲は変更できません。**

  また、すべてのユーザーに特定の特権を付与する必要がある場合、StarRocksはシステム定義のロール`public`も提供しています。

- `public`: このロールは任意のユーザーに所有され、任意のセッションでデフォルトでアクティブ化されます。`public`ロールはデフォルトでは特権を持っていません。このロールの特権範囲を変更することができます。

### カスタムロール

特定のビジネス要件を満たすためにカスタムロールを作成し、その特権範囲を変更することができます。同時に、管理の便宜のために、ロールを他のロールに割り当てて特権の階層と継承を作成することができます。その後、ロールに関連付けられた特権は別のロールによって継承されます。

#### ロールの階層と特権の継承

以下の図は、特権の継承の例を示しています。

> 注意: ロールの最大継承レベルは16です。継承関係は双方向にはできません。

![ロールの継承](../assets/privilege-role_inheri.png)

図に示されているように:

- `role_s`は`role_p`に割り当てられています。`role_p`は`role_s`の`priv_1`を暗黙的に継承します。
- `role_p`は`role_g`に割り当てられています。`role_g`は`role_p`の`priv_2`と`role_s`の`priv_1`を暗黙的に継承します。
- ロールがユーザーに割り当てられた後、ユーザーはこのロールの特権も持ちます。

### アクティブなロール

アクティブなロールを使用すると、ユーザーは現在のセッションでロールの特権を適用することができます。`SELECT CURRENT_ROLE();`を使用して、現在のセッションでアクティブなロールを表示することができます。詳細については、[current_role](../sql-reference/sql-functions/utility-functions/current_role.md)を参照してください。

#### デフォルトロール

デフォルトロールは、ユーザーがクラスタにログインしたときに自動的にアクティブ化されるロールです。1つ以上のユーザーが所有するロールであることができます。管理者は、[CREATE USER](../sql-reference/sql-statements/account-management/CREATE_USER.md)の`DEFAULT ROLE`キーワードを使用してデフォルトロールを設定し、[ALTER USER](../sql-reference/sql-statements/account-management/ALTER_USER.md)を使用してデフォルトロールを変更することができます。

ユーザーは[SET DEFAULT ROLE](../sql-reference/sql-statements/account-management/SET_DEFAULT_ROLE.md)を使用してデフォルトロールを変更することもできます。

デフォルトロールは、ユーザーに基本的な特権保護を提供します。たとえば、ユーザーAは`role_query`と`role_delete`を持っており、それぞれクエリと削除の特権を持っています。データの損失を防ぐために、`role_query`のみをデフォルトロールとして使用することをお勧めします。これにより、`DELETE`や`TRUNCATE`などの高リスクな操作によるデータの損失が防止されます。これらの操作を実行する必要がある場合は、手動でアクティブなロールを設定した後に実行できます。

デフォルトロールを持たないユーザーは、自動的に`public`ロールを持っており、クラスタにログインした後に自動的にアクティブ化されます。

#### 手動でロールをアクティブ化する

デフォルトロール以外にも、ユーザーはセッション内で既存の1つ以上のロールを手動でアクティブ化することもできます。[SHOW GRANTS](../sql-reference/sql-statements/account-management/SHOW_GRANTS.md)を使用してアクティブ化できる特権とロールを表示し、[SET ROLE](../sql-reference/sql-statements/account-management/SET_ROLE.md)を使用して現在のセッションで有効なアクティブなロールを設定することができます。

SET ROLEコマンドは互いに上書きされます。たとえば、ユーザーがログインした後、`default_role`がデフォルトでアクティブ化されます。その後、ユーザーが`SET ROLE role_s`を実行します。この時点で、ユーザーは`role_s`と自身の特権のみを持ちます。`default_role`は上書きされます。

## 参考

- [StarRocksでサポートされている特権](privilege_item.md)
- [ユーザー特権の管理](User_privilege.md)
