---
displayed_sidebar: "Japanese"
---

# 重複キーのテーブル

重複キーのテーブルは、StarRocksのデフォルトモデルです。テーブルを作成する際にモデルを指定しない場合、デフォルトで重複キーのテーブルが作成されます。

重複キーのテーブルを作成する際には、そのテーブルにソートキーを定義することができます。フィルタ条件にソートキーの列が含まれている場合、StarRocksはテーブルからデータを高速にフィルタリングしてクエリを加速することができます。重複キーのテーブルでは、テーブルに新しいデータを追加することができますが、既存のデータを変更することはできません。

## シナリオ

重複キーのテーブルは、以下のシナリオに適しています：

- 生のログや生の操作レコードなどの生データを分析する場合。
- プリ集計方法に制限されずに、さまざまな方法でデータをクエリする場合。
- ログデータや時系列データをロードする場合。新しいデータは追加モードで書き込まれ、既存のデータは更新されません。

## テーブルの作成

特定の時間範囲でイベントデータを分析したいとします。この例では、`detail`という名前のテーブルを作成し、`event_time`と`event_type`をソートキーの列として定義します。

テーブルを作成するためのステートメント：

```SQL
CREATE TABLE IF NOT EXISTS detail (
    event_time DATETIME NOT NULL COMMENT "イベントの日時",
    event_type INT NOT NULL COMMENT "イベントの種類",
    user_id INT COMMENT "ユーザーのID",
    device_code INT COMMENT "デバイスコード",
    channel INT COMMENT ""
)
DUPLICATE KEY(event_time, event_type)
DISTRIBUTED BY HASH(user_id);
```

> **注意**
>
> - テーブルを作成する際には、`DISTRIBUTED BY HASH`句を使用してバケット化する列を指定する必要があります。詳細については、[バケット化](../Data_distribution.md#design-partitioning-and-bucketing-rules)を参照してください。
> - v2.5.7以降、StarRocksはテーブルを作成するかパーティションを追加する際に、バケットの数（BUCKETS）を自動的に設定することができます。バケットの数を手動で設定する必要はもはやありません。詳細については、[バケットの数を決定する](../Data_distribution.md#determine-the-number-of-buckets)を参照してください。

## 使用上の注意

- テーブルのソートキーに関しては、以下の点に注意してください：
  - `DUPLICATE KEY`キーワードを使用して、ソートキーに使用する列を明示的に定義することができます。

    > 注意：デフォルトでは、ソートキーの列が指定されていない場合、StarRocksは最初の3つの列をソートキーの列として使用します。

  - 重複キーのテーブルでは、ソートキーはいくつかまたはすべての次元列で構成することができます。

- テーブル作成時に、ビットマップインデックスやブルームフィルタインデックスなどのインデックスを作成することができます。

- 同じレコードが2つロードされた場合、重複キーのテーブルではそれらを1つではなく2つのレコードとして保持します。

## 次の手順

テーブルが作成されたら、さまざまなデータ取り込み方法を使用してデータをStarRocksにロードすることができます。StarRocksでサポートされているデータ取り込み方法の詳細については、[データロードの概要](../../loading/Loading_intro.md)を参照してください。
> 注意：重複キーのテーブルを使用するテーブルにデータをロードする場合、テーブルにデータを追加することしかできません。テーブル内の既存のデータを変更することはできません。
