---
displayed_sidebar: "Japanese"
---

# ユーザー定義変数

このトピックでは、ユーザー定義変数の宣言と使用方法について説明します。

StarRocks 2.5以降のバージョンでは、ユーザー定義変数がサポートされています。これらの変数は、後のSQL文で参照される特定の値を格納するために使用され、SQL文の記述を簡素化し、重複した計算を回避します。

## 使用上の注意

- ユーザー定義変数は、ユーザーによって作成され、セッション内に存在する変数です。これは、他のユーザーが宣言したユーザー定義変数にアクセスできないことを意味し、セッションが終了するとこれらの変数は失効します。
- StarRocksは、既存のユーザー定義変数を表示するためにSHOW文を使用することはサポートしていません。
- 次の種類の値はユーザー定義変数として宣言することはできません：BITMAP、HLL、PERCENTILE、およびARRAY。JSON型のユーザー定義変数は、ストレージのためにSTRING型に変換されます。

## ユーザー定義変数の宣言

### 構文

```Plain
SET @var_name = expr [, ...];
```

> **注意**
>
> - すべての変数は、単一のアットマーク（@）で始める必要があります。
> - 複数の変数を同じSET文で宣言することができ、コンマ（`,`）で区切る必要があります。
> - 同じ変数を複数回宣言することができます。新しく宣言された値は元の値を上書きします。
> - 宣言されていない変数が使用される場合、変数の値はデフォルトで`NULL`となり、NULLの型はSTRINGです。

### パラメータ

| **パラメータ** | **必須** | **説明**                                                     |
| -------------- | -------- | ------------------------------------------------------------ |
| var_name       | Yes      | ユーザー定義変数の名前です。命名規則は以下のとおりです：<ul><li>名前には、文字、数字（0-9）、アンダースコア（\_）を含めることができます。</li><li>名前の長さは64文字を超えることはできません。</li></ul>ユーザー定義変数として文字列を宣言することもできます。例えば、@'my-var'、@"my-var"、および@\`my-var\`のようなものです。STRING型のユーザー定義変数には、文字、数字、アンダースコア（_）以外の文字（ピリオドなど）も含めることができます。 |
| expr           | Yes      | ユーザー定義変数の値です。このパラメータには、数値（例：43）または複雑な式（SELECT文によって返される値など）を指定することができます。変数のデータ型は、式によって返される結果のデータ型と同じです。 |

### 例

例1：数値をユーザー定義変数として宣言する。

```SQL
SET @var = 43;
```

例2：SELECTクエリの結果をユーザー定義変数として宣言する。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

例3：同じSET文で複数のユーザー定義変数を宣言する。

```SQL
SET @v1=1, @v2=2;
```

## SQLでユーザー定義変数を使用する

- SQL文の記述を簡素化します。たとえば、次のSELECT文を実行すると、StarRocksは`@var`を`1`と解析します。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 重複した計算を回避します。たとえば、次のSELECT文を実行すると、StarRocksは`@var`を`select sum(c1) from tbl`コマンドの結果と解析します。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```
