---
displayed_sidebar: "Japanese"
---

# 機能

StarRocksは、大規模なデータに対して高速かつリアルタイムな分析体験を提供するための豊富な機能を提供しています。

## MPPフレームワーク

StarRocksは、大規模並列処理（MPP）フレームワークを採用しています。クエリリクエストは複数の物理的な計算ユニットに分割され、複数のマシンで並列に実行することができます。各マシンには専用のCPUとメモリリソースがあります。MPPフレームワークは、すべてのCPUコアとマシンのリソースを最大限に活用します。クラスタがスケールアウトされるにつれて、単一のクエリのパフォーマンスは継続的に向上します。

![MPP](../assets/1.1-3-mpp.png)

前の図では、StarRocksはSQLステートメントをセマンティクスに基づいて複数の論理実行ユニット（クエリフラグメント）にパースします。それぞれのフラグメントは、計算の複雑さに基づいて1つまたは複数の物理的な実行ユニット（フラグメントインスタンス）によって実装されます。物理的な実行ユニットは、StarRocksの最小のスケジューリングユニットです。それらはバックエンド（BE）にスケジュールされて実行されます。1つの論理実行ユニットには、スキャン、プロジェクト、集計などのオペレータが含まれる場合があります。図の右側に示されています。各物理実行ユニットは、データの一部のみを処理し、その結果はマージされて最終的なデータを生成します。**論理実行ユニットの並列実行は、すべてのCPUコアと物理マシンのリソースを最大限に活用し、クエリのスピードを加速します。**

![MPP](../assets/1.1-4-mpp.png)

多くの他のデータ分析システムで使用されるScatter-Gatherフレームワークとは異なり、MPPフレームワークはより多くのリソースを使用してクエリリクエストを処理することができます。Scatter-Gatherフレームワークでは、最終的なマージ操作を実行できるのはGatherノードだけです。MPPフレームワークでは、データはマージ操作のために複数のノードにシャッフルされます。高基数フィールドや大規模なテーブルの結合などの複雑なクエリでは、StarRocksのMPPフレームワークはScatter-Gatherフレームワークに比べて顕著なパフォーマンスの利点があります。

## 完全ベクトル化実行エンジン

完全ベクトル化実行エンジンは、データを列指向で組織化し処理することで、CPUの処理能力をより効率的に活用します。具体的には、StarRocksはデータを列指向で保存し、メモリ内でデータを組織化し、SQLオペレータを列指向で計算します。列指向の組織化はCPUキャッシュを最大限に活用します。列指向の計算は仮想関数呼び出しと分岐判断の数を減らし、より効率的なCPU命令フローを実現します。

ベクトル化実行エンジンは、SIMD命令も最大限に活用します。このエンジンは、より少ない命令でより多くのデータ操作を完了することができます。標準データセットに対するテストでは、このエンジンによってオペレータの全体的なパフォーマンスが3倍から10倍向上しました。

オペレータのベクトル化に加えて、StarRocksはクエリエンジンの他の最適化も実装しています。たとえば、StarRocksはエンコードされたデータ上でオペレータを直接実行するための「エンコードデータ上の操作」技術を使用しています。これにより、デコードの必要性なしにエンコードされた文字列上でオペレータを実行することができます。これにより、SQLの複雑さが著しく低減し、クエリのスピードが2倍以上向上します。

## ストレージと計算の分離

[ストレージと計算の分離アーキテクチャ](./Architecture.md)は、3.0から導入されました。このアーキテクチャでは、計算とストレージを分離してリソースの分離、計算ノードの弾力的なスケーリング、高性能なクエリを実現しています。ストレージと計算の分離により、StarRocksはより柔軟性の高い、より高性能でデータ利用可能な、より低コストのソリューションを提供します。

![shared-data](../assets/share_data_arch.png)

ストレージと計算の分離モードでは、計算とストレージを分離して独立してスケーリングすることができます。これにより、ストレージと計算が結合されたモードでは、計算ノードを追加するたびにストレージをスケーリングする必要があるというコストがなくなります。さらに、計算は数秒以内に動的にスケーリングすることができ、特にトラフィックのピークと谷が顕著な場合にリソースの利用効率を向上させます。

ストレージ層は、オブジェクトストレージのほぼ無制限の容量と高い信頼性を活用して、大量のデータの保存と永続化を実現します。StarRocksは、AWS S3、Google Cloud Storage、Azure Blob Storage、HDFS、MinIOなどのさまざまなオブジェクトストレージシステムと連携することができます。

ユーザーは、StarRocksをパブリッククラウド、プライベートクラウド、またはオンプレミスのデータセンターに展開することができます。StarRocksはKubernetesベースの展開をサポートし、ストレージと計算が分離されたクラスタの自動デプロイメントのためのオペレータを提供します。

ストレージと計算の分離モードのStarRocksは、ストレージと計算が結合されたモードと同じ機能を提供します。データの書き込みとホットデータのクエリパフォーマンスも同じです。ユーザーは、ストレージと計算が結合されたモードと同様にデータの更新、データレイクの分析、マテリアライズドビューの高速化を実行することができます。

ストレージと計算を分離したStarRocksクラスタを展開する方法についての情報は、[共有データクラスタの展開](../deployment/shared_data/s3.md)を参照してください。

## コストベースの最適化

![CBO](../assets/1.1-5-cbo.png)

複数のテーブルの結合クエリのパフォーマンスを最適化することは困難です。実行エンジンだけでは優れたパフォーマンスを提供することはできません。なぜなら、複数のテーブルの結合クエリの場合、実行計画の複雑さは数桁にわたって異なる場合があるからです。関連するテーブルが多ければ多いほど、実行計画も多くなり、最適な計画を選択することはNP困難になります。効率的なマルチテーブル分析のためには、優れたクエリ最適化プランナーが必要です。

StarRocksは、ゼロから全く新しい[CBO](../using_starrocks/Cost_based_optimizer.md)を設計しています。このCBOは、カスケードのようなフレームワークを採用しており、ベクトル化実行エンジンに特化した最適化と革新を数多く備えています。これらの最適化には、共通テーブル式（CTE）の再利用、サブクエリの書き換え、Lateral Join、Join Reorder、分散Join実行のための戦略選択、低基数最適化などが含まれます。CBOは、合計99のTPC-DS SQLステートメントをサポートしています。

CBOにより、StarRocksは競合他社よりも優れたマルチテーブル結合クエリのパフォーマンスを提供することができます、特に複雑なマルチテーブル結合クエリの場合です。

## リアルタイムで更新可能な列指向ストレージエンジン

StarRocksは、同じタイプのデータを連続して保存できる列指向ストレージエンジンです。列指向ストレージでは、データをより効率的な方法でエンコードすることができ、圧縮率を高め、ストレージコストを低下させることができます。列指向ストレージはまた、合計データの読み取りI/O数を減らし、クエリのパフォーマンスを向上させます。さらに、ほとんどのOLAPシナリオでは、特定の列のみがクエリ対象となります。列指向ストレージにより、ユーザーは一部の列のみをクエリでき、ディスクI/Oを大幅に削減することができます。

StarRocksは、数秒でデータをロードしてほぼリアルタイムの分析を実行することができます。StarRocksのストレージエンジンは、各データの挿入操作の原子性、一貫性、分離性、耐久性（ACID）を保証します。データのロードトランザクションでは、トランザクション全体が成功するか失敗します。並行トランザクションは互いに影響を与えず、トランザクションレベルの分離を提供します。

![Realtime](../assets/1.1-6-realtime.png)

StarRocksのストレージエンジンは、Delete-and-insertパターンを使用して効率的な部分更新とUpsert操作を実行することができます。ストレージエンジンは、主キーインデックスを使用してデータを迅速にフィルタリングすることができ、データの読み取り時にソートやマージ操作が必要なくなります。エンジンはまた、セカンダリインデックスを最大限に活用することができます。これにより、巨大なデータの更新でも高速かつ予測可能なクエリパフォーマンスを提供します。

## インテリジェントなマテリアライズドビュー

StarRocksは、インテリジェントな[マテリアライズドビュー](../using_starrocks/Materialized_view.md)を使用してクエリとデータウェアハウスのレイヤーを高速化します。他の類似製品のマテリアライズドビューとは異なり、StarRocksのマテリアライズドビューは、ベーステーブルのデータ変更に応じてデータを自動的に更新し、追加のメンテナンス操作を必要としません。さらに、マテリアライズドビューの選択も自動的です。StarRocksがクエリのパフォーマンスを向上させるために適切なマテリアライズドビュー（MV）を特定した場合、クエリを自動的にMVを利用するように書き換えます。このインテリジェントなプロセスにより、手動の介入なしでクエリの効率が大幅に向上します。

StarRocksのMVは、従来のETLデータモデリングプロセスを置き換えることができます。上流のアプリケーションでデータを変換する代わりに、StarRocks内でMVを使用してデータを変換することができます。これにより、データ処理パイプラインが簡素化されます。

例えば、図に示すように、データレイク上の生データを外部MVに基づいて正規化されたテーブルを作成することができます。正規化されたテーブルから非同期マテリアライズドビューを介して非正規化テーブルを作成することができます。正規化されたテーブルから別のMVを作成して、高並行クエリとより良いクエリパフォーマンスをサポートすることもできます。

![MV](../assets/1.1-7-mv.png)

## データレイク分析

![DLA](../assets/1.1-8-dla.png)

ローカルデータの効率的な分析に加えて、StarRocksはApache Hive、Apache Iceberg、Apache Hudi、Delta Lakeなどのデータレイクに格納されたデータを分析するためのコンピューティングエンジンとしても機能します。StarRocksのキー機能の1つは、外部カタログであり、外部で管理されるメタストアへのリンクとして機能します。この機能により、データの移行が不要で、シームレスに外部データソースをクエリすることができます。そのため、HDFSやAmazon S3などのさまざまなシステム、Parquet、ORC、CSVなどのさまざまなファイル形式など、さまざまなシステムやファイル形式のデータを分析することができます。

前の図は、データレイク分析のシナリオを示しており、StarRocksがデータの計算と分析を担当し、データレイクがデータの保存、組織化、メンテナンスを担当しています。データレイクでは、柔軟なスキーマを使用してデータをオープンなストレージ形式で保存し、「真実の単一ソース」に基づいてさまざまなBI、AI、アドホック、レポートなどのユースケースに対するレポートを生成することができます。StarRocksは、ベクトル化エンジンとCBOの利点を最大限に活用し、データレイク分析のパフォーマンスを大幅に向上させます。
