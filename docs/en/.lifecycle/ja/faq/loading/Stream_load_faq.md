---
displayed_sidebar: "Japanese"
---

# ストリームロード

## 1. ストリームロードは、CSV形式のファイルの最初の数行に含まれる列名を識別したり、データ読み取り時に最初の数行をスキップしたりすることはサポートしていますか？

ストリームロードは、CSV形式のファイルの最初の数行に含まれる列名を識別することはサポートしていません。ストリームロードは、最初の数行を他の行と同様の通常のデータとして扱います。

v2.5以前のバージョンでは、ストリームロードはCSVファイルの最初の数行を読み取り時にスキップすることはサポートしていません。読み込みたいCSVファイルの最初の数行に列名が含まれている場合は、次のいずれかの方法を取る必要があります：

- データをエクスポートするツールの設定を変更し、最初の数行に列名が含まれないCSVファイルとしてデータを再エクスポートします。
- `sed -i '1d' ファイル名` のようなコマンドを使用して、CSVファイルの最初の数行を削除します。
- ロードコマンドまたはステートメントで、`-H "where: <column_name> != '<column_name>'"` のように指定して、CSVファイルの最初の数行をフィルタリングします。`<column_name>` は最初の数行に含まれる列名のいずれかです。なお、StarRocksはまずデータを変換し、その後にフィルタリングします。したがって、最初の数行の列名が対応する宛先のデータ型に変換できない場合、`NULL` 値が返されます。これは、宛先のStarRocksテーブルには `NOT NULL` に設定された列を含めることができないことを意味します。
- ロードコマンドまたはステートメントで、`-H "max_filter_ratio:0.01"` を追加して、1%以下の最大エラートレランスを設定し、一部のエラーレコードを許容できるようにします。これにより、StarRocksは最初の数行のデータ変換の失敗を無視することができます。この場合、Stream Loadジョブは `ErrorURL` が返されてエラーレコードが示されていても成功します。`max_filter_ratio` を大きな値に設定しないでください。大きな値に設定すると、重要なデータ品質の問題が見落とされる可能性があります。

v3.0以降、Stream LoadはCSVファイルの最初の数行をスキップするための `skip_header` パラメータをサポートしています。詳細については、[CSVパラメータ](../../sql-reference/sql-statements/data-manipulation/STREAM_LOAD.md#csv-parameters) を参照してください。

## 2. パーティション列にロードするデータが標準のDATEまたはINT型ではありません。たとえば、データが202106.00のような形式である場合、Stream Loadを使用してロードする場合はどのようにデータを変換しますか？

StarRocksは、ロード時にデータの変換をサポートしています。詳細については、[ロード時のデータ変換](../../loading/Etl_in_loading.md) を参照してください。

例えば、`TEST` という名前のCSV形式のファイルをロードしたい場合、ファイルは `NO`、`DATE`、`VERSION`、`PRICE` の4つの列で構成されており、`DATE` 列のデータが202106.00のような非標準の形式であるとします。StarRocksで `DATE` をパーティション列として使用する場合、まず次のような4つの列からなるStarRocksテーブルを作成する必要があります：`NO`、`VERSION`、`PRICE`、`DATE`。次に、StarRocksテーブルの `DATE` 列のデータ型をDATE、DATETIME、またはINTに指定する必要があります。最後に、Stream Loadジョブを作成する際に、次の設定をロードコマンドまたはステートメントで指定して、ソースの `DATE` 列のデータ型を宛先の列のデータ型に変換します：

```Plain
-H "columns: NO,DATE_1, VERSION, PRICE, DATE=LEFT(DATE_1,6)"
```

上記の例では、`DATE_1` は一時的な列として考えることができ、宛先の `DATE` 列にマッピングされます。そして、`left()` 関数によって宛先の `DATE` 列にロードされる最終結果が計算されます。ソースの列の一時的な名前を最初にリストし、その後に関数を使用してデータを変換する必要があります。サポートされる関数はスカラー関数であり、非集計関数とウィンドウ関数を含みます。

## 3. Stream Loadジョブが「body exceed max size: 10737418240, limit: 10737418240」というエラーを報告した場合、どうすればよいですか？

ソースデータファイルのサイズが10GBを超えており、これはStream Loadがサポートする最大ファイルサイズです。次のいずれかの方法を取る必要があります：

- `seq -w 0 n` を使用して、ソースデータファイルをより小さいファイルに分割します。
- `curl -XPOST http:///be_host:http_port/api/update_config?streaming_load_max_mb=<file_size>` を使用して、[BEの設定項目](../../administration/Configuration.md#configure-be-dynamic-parameters) `streaming_load_max_mb` の値を調整して、最大ファイルサイズを増やします。
