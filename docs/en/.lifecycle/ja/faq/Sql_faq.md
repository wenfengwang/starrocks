---
displayed_sidebar: "Japanese"
---

# SQL

このトピックでは、SQLに関するよくある質問に対する回答を提供します。

## マテリアライズドビューをビルドする際に「メモリの割り当てに失敗しました。」というエラーが発生する場合

この問題を解決するには、**be.conf**ファイルで`memory_limitation_per_thread_for_schema_change`パラメータの値を増やします。このパラメータは、スキーマ変更のために割り当てることができる単一のタスクの最大ストレージを指します。最大ストレージのデフォルト値は2GBです。

## StarRocksはクエリ結果のキャッシュをサポートしていますか？

StarRocksは直接的にクエリ結果をキャッシュしません。v2.5以降、StarRocksはクエリキャッシュ機能を使用して、最初の段階の集計の中間結果をキャッシュに保存します。以前のクエリと意味的に等価な新しいクエリは、キャッシュされた計算結果を再利用して計算を高速化することができます。クエリキャッシュはBEメモリを使用します。詳細については、[クエリキャッシュ](../using_starrocks/query_cache.md)を参照してください。

## 計算に`Null`が含まれる場合、ISNULL()関数以外の関数の計算結果は偽になりますか？

標準のSQLでは、`NULL`値を含むオペランドを含むすべての計算は`NULL`を返します。

## BIGINTデータ型の値を等価クエリの値に引用符で囲むと、クエリ結果が正しくありません。なぜですか？

### 問題の説明

次の例を参照してください：

```plaintext
select cust_id,idno 

from llyt_dev.dwd_mbr_custinfo_dd 

where Pt= ‘2021-06-30’ 

and cust_id = ‘20210129005809043707’ 

limit 10 offset 0;
+---------------------+-----------------------------------------+

|   cust_id           |      idno                               |

+---------------------+-----------------------------------------+

|  20210129005809436  | yjdgjwsnfmdhjw294F93kmHCNMX39dw=        |

|  20210129005809436  | sdhnswjwijeifme3kmHCNMX39gfgrdw=        |

|  20210129005809436  | Tjoedk3js82nswndrf43X39hbggggbw=        |

|  20210129005809436  | denuwjaxh73e39592jwshbnjdi22ogw=        |

|  20210129005809436  | ckxwmsd2mei3nrunjrihj93dm3ijin2=        |

|  20210129005809436  | djm2emdi3mfi3mfu4jro2ji2ndimi3n=        |

+---------------------+-----------------------------------------+
select cust_id,idno 

from llyt_dev.dwd_mbr_custinfo_dd 

where Pt= ‘2021-06-30’ 

and cust_id = 20210129005809043707 

limit 10 offset 0;
+---------------------+-----------------------------------------+

|   cust_id           |      idno                               |

+---------------------+-----------------------------------------+

|  20210189979989976  | xuywehuhfuhruehfurhghcfCNMX39dw=        |

+---------------------+-----------------------------------------+
```

### 解決策

STRINGデータ型とINTEGERデータ型を比較する場合、これら2つのタイプのフィールドはDOUBLEデータ型にキャストされます。したがって、引用符を追加することはできません。そうしないと、WHERE句で定義された条件をインデックス化することができません。

## StarRocksはDECODE関数をサポートしていますか？

StarRocksはOracleデータベースのDECODE関数をサポートしていません。StarRocksはMySQLと互換性がありますので、CASE WHEN文を使用することができます。

## StarRocksのプライマリキーテーブルにデータをロードした後、すぐに最新のデータをクエリできますか？

はい。StarRocksはGoogle Mesaを参照する方法でデータをマージします。StarRocksでは、BEがデータマージをトリガーし、2つの種類のコンパクションでデータをマージします。データマージが完了していない場合、クエリ中に完了します。したがって、データロード後に最新のデータを読み取ることができます。

## StarRocksに格納されたutf8mb4文字は切り捨てられるか、文字化けしますか？

いいえ。

## `alter table`コマンドを実行すると「テーブルの状態が正常ではありません。」というエラーが発生します

このエラーは、前の変更が完了していないため発生します。次のコードを実行して、前の変更の状態を確認できます：

```SQL
show tablet from lineitem where State="ALTER"; 
```

変更操作にかかる時間はデータのボリュームに関連しています。一般的には、変更は数分で完了します。テーブルの変更中にデータをStarRocksにロードしないようにすることをお勧めします。データのロードは変更の速度を低下させるためです。

## Apache Hiveの外部テーブルをクエリする際に「get partition detail failed: org.apache.doris.common.DdlException: get hive partition meta data failed: java.net.UnknownHostException:hadooptest」というエラーが発生します

このエラーは、Apache Hiveのパーティションのメタデータを取得できない場合に発生します。この問題を解決するには、**core-sit.xml**と**hdfs-site.xml**を**fe.conf**ファイルと**be.conf**ファイルにコピーします。

## データをクエリする際に「planner use long time 3000 remaining task num 1」というエラーが発生します

このエラーは、通常フルガベージコレクション（full GC）によるものであり、バックエンドのモニタリングと**fe.gc**ログを使用して確認できます。この問題を解決するには、次のいずれかの操作を実行します：

- SQLのクライアントが複数のフロントエンド（FE）に同時にアクセスできるようにすることで、負荷を分散させます。
- **fe.conf**ファイルでJava仮想マシン（JVM）のヒープサイズを8GBから16GBに変更し、メモリを増やしてフルGCの影響を軽減します。

## 列Aの基数が小さい場合、`select B from tbl order by A limit 10`のクエリ結果は毎回異なります

SQLは列Aが順序付けられていることを保証することができますが、列Bの順序が各クエリごとに同じであることを保証することはできません。MySQLはスタンドアロンのデータベースであるため、列Aと列Bの順序を保証することができます。

StarRocksは分散データベースであり、基礎となるテーブルに格納されているデータはシャーディングパターンで分散しています。列Aのデータは複数のマシンに分散されているため、複数のマシンが返す列Bの順序は各クエリごとに異なる場合があります。この問題を解決するには、`select B from tbl order by A,B limit 10`を`select B from tbl order by A,B limit 10`に変更します。

## SELECT *とSELECTの列効率の間に大きな差がありますが、なぜですか？

この問題を解決するには、プロファイルを確認し、MERGEの詳細を確認します：

- ストレージ層での集計にかかる時間が過剰ではないか確認します。

- インジケータ列が多すぎる場合は、数百の列を数百万行の集計にします。

```plaintext
MERGE:

    - aggr: 26s270ms

    - sort: 15s551ms
```

## DELETEはネストされた関数をサポートしていますか？

ネストされた関数はサポートされていません。たとえば、`DELETE from test_new WHERE to_days(now())-to_days(publish_time) >7;`のような`to_days(now())`のようなネストされた関数はサポートされていません。

## データベースに数百のテーブルがある場合、データベースの使用効率を向上させるにはどうすればよいですか？

効率を向上させるためには、MySQLのクライアントサーバに接続する際に`-A`パラメータを追加します：`mysql -uroot -h127.0.0.1 -P8867 -A`。MySQLのクライアントサーバはデータベース情報を事前に読み込みません。

## BEログとFEログが占有するディスクスペースを減らすにはどうすればよいですか？

ログレベルと対応するパラメータを調整します。詳細については、[パラメータの設定](../administration/Configuration.md)を参照してください。

## レプリケーション数を変更すると「table *** is colocate table, cannot change replicationNum」というエラーが発生します

共有テーブルを作成する場合、`group`プロパティを設定する必要があります。したがって、単一のテーブルのレプリケーション数を変更することはできません。次の手順で、グループ内のすべてのテーブルのレプリケーション数を変更できます：

1. グループ内のすべてのテーブルの`group_with`を`empty`に設定します。
2. グループ内のすべてのテーブルに適切な`replication_num`を設定します。
3. `group_with`を元の値に戻します。

## VARCHARを最大値に設定するとストレージに影響がありますか？

VARCHARは可変長のデータ型であり、実際のデータの長さに基づいて変更できる指定された長さを持っています。テーブルを作成する際に異なるvarcharの長さを指定しても、同じデータに対するクエリのパフォーマンスにはほとんど影響がありません。

## テーブルを切り捨てる際に「create partititon timeout」というエラーが発生します

テーブルを切り捨てるには、対応するパーティションを作成し、それらをスワップする必要があります。作成する必要のあるパーティションが多い場合、このエラーが発生します。また、多くのデータロードタスクがある場合、コンパクションプロセス中にロックが長時間保持されます。したがって、テーブルの作成時にロックを取得できません。データロードタスクが多すぎる場合は、**be.conf**ファイルで`tablet_map_shard_size`を`512`に設定して、ロックの競合を減らすことをお勧めします。

## Apache Hiveの外部テーブルにアクセスする際に「Failed to specify server's Kerberos principal name」というエラーが発生します

次の情報を**fe.conf**ファイルと**be.conf**ファイルの**hdfs-site.xml**に追加します：

```HTML
<property>

<name>dfs.namenode.kerberos.principal.pattern</name>

<value>*</value>

</property>
```

## "2021-10"はStarRocksの日付形式ですか？

いいえ。

## "2021-10"をパーティションフィールドとして使用できますか？

いいえ、関数を使用して"2021-10"を"2021-10-01"に変更し、"2021-10-01"をパーティションフィールドとして使用します。

## StarRocksのデータベースやテーブルのサイズはどこでクエリできますか？

[SHOW DATA](../sql-reference/sql-statements/data-manipulation/SHOW_DATA.md)コマンドを使用できます。

`SHOW DATA;`は現在のデータベースのすべてのテーブルのデータサイズとレプリカ数を表示します。

`SHOW DATA FROM <db_name>.<table_name>;`は指定したデータベースの指定したテーブルのデータサイズ、レプリカ数、行数を表示します。
