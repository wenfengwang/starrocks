---
displayed_sidebar: English
---

# 功能特性

StarRocks 提供了一系列丰富的功能，以实现对大规模数据的超快速、实时分析体验。

## MPP 框架

StarRocks 采用大规模并行处理（MPP）框架。一个查询请求被分解为多个物理计算单元，这些单元可以在多台机器上并行执行。每台机器都配备专用的 CPU 和内存资源。MPP 框架充分利用了所有 CPU 核心和机器的资源。随着集群的扩展，单个查询的性能可以持续提升。

![MPP](../assets/1.1-3-mpp.png)

如上图所示，StarRocks 根据 SQL 语句的语义将其解析为多个逻辑执行单元（查询片段）。然后，根据计算复杂性，每个片段由一个或多个物理执行单元（片段实例）实现。物理执行单元是 StarRocks 中最小的调度单元。它们将被调度到后端（BEs）执行。一个逻辑执行单元可以包含一个或多个操作符，例如 Scan、Project 和 Agg 操作符，如图右侧所示。每个物理执行单元仅处理部分数据，结果将合并以生成最终数据。**逻辑执行单元的并行执行充分利用了所有 CPU 核心和物理机器的资源，加速了查询速度。**

![MPP](../assets/1.1-4-mpp.png)

与许多其他数据分析系统使用的 Scatter-Gather 框架不同，MPP 框架能够利用更多资源来处理查询请求。在 Scatter-Gather 框架中，只有 Gather 节点能够执行最终的合并操作。在 MPP 框架中，数据被分发到多个节点进行合并操作。对于复杂查询，如在高基数字段上的 Group By 和大型表连接，StarRocks 的 MPP 框架相较于 Scatter-Gather 框架有明显的性能优势。

## 全矢量化执行引擎

全矢量化执行引擎能够更高效地利用 CPU 处理能力，因为它以列式方式组织和处理数据。具体来说，StarRocks 存储数据、在内存中组织数据以及计算 SQL 操作符均以列式方式进行。列式组织充分利用了 CPU 缓存。列式计算减少了虚拟函数调用和分支判断的次数，从而提高了 CPU 指令流的效率。

矢量化执行引擎还充分利用 SIMD 指令。这个引擎可以用更少的指令完成更多的数据操作。针对标准数据集的测试显示，这个引擎可以将操作符的整体性能提高 3 到 10 倍。

除了操作符矢量化之外，StarRocks 对查询引擎进行了其他优化。例如，StarRocks 使用编码数据操作（Operation on Encoded Data）技术，可以直接在编码的字符串上执行操作符，无需解码。这显著降低了 SQL 的复杂性，并将查询速度提高了两倍以上。

## 存储与计算分离

从 3.0 版本开始引入了[存储与计算分离架构](./Architecture.md)。在这种架构中，计算与存储被解耦，实现了资源隔离、计算节点的弹性扩展和高性能查询。存储与计算分离为 StarRocks 提供了更好的灵活性、更高的性能和数据可用性，以及更低的成本。

![shared-data](../assets/share_data_arch.png)

在存储与计算分离模式下，计算和存储被解耦并可以独立扩展，这消除了在存储与计算耦合模式中存在的问题，即每当用户想要增加计算节点时就必须扩展存储的成本。此外，计算可以在几秒钟内动态扩展，提高了资源利用率，尤其是在流量高峰和低谷时。

存储层利用对象存储的几乎无限容量和高可靠性实现了大规模数据存储和数据持久化。StarRocks 可以与多种对象存储系统协同工作，如 AWS S3、Google Cloud Storage、Azure Blob Storage、HDFS 和其他兼容 S3 的存储，例如 MinIO。

用户可以选择在公有云、私有云或本地数据中心部署 StarRocks。StarRocks 支持基于 Kubernetes 的部署，并提供 Operator 以自动部署存储与计算分离集群。

在存储与计算分离模式下，StarRocks 提供与存储与计算耦合模式相同的功能。数据写入和热数据查询性能也相同。用户可以像在存储与计算耦合模式下一样进行数据更新、数据湖分析和物化视图加速。

有关如何部署存储与计算分离的 StarRocks 集群的信息，请参见[部署共享数据集群](../deployment/shared_data/s3.md)。

## 基于成本的优化器（CBO）

![CBO](../assets/1.1-5-cbo.png)

多表连接查询的性能优化是一项挑战。仅依靠执行引擎无法提供最佳性能，因为在多表连接查询场景中，执行计划的复杂度可能相差数个数量级。关联的表越多，可选的执行计划就越多，选择最优计划变得 NP 难题。只有出色的查询优化器才能为高效的多表分析选择一个相对最优的查询计划。

StarRocks 从零开始设计了一个全新的 [CBO](../using_starrocks/Cost_based_optimizer.md)。这个 CBO 采用类似级联的框架，并为矢量化执行引擎深度定制，包含了许多优化和创新。这些优化包括公共表达式（CTEs）的重用、子查询重写、Lateral Join、Join Reorder、分布式 Join 执行的策略选择以及低基数优化。CBO 支持共 99 条 TPC-DS SQL 语句。

CBO 使 StarRocks 在执行复杂的多表连接查询时，能够提供比竞争对手更优的性能。

## 实时可更新的列式存储引擎

StarRocks 是一个列式存储引擎，它允许将同类型的数据连续存储。在列式存储中，数据可以更高效地编码，提高压缩比率并降低存储成本。列式存储还减少了总体数据读取 I/O，提升了查询性能。此外，在大多数 OLAP 场景中，只查询特定列。列式存储使用户只需查询部分列，显著减少了磁盘 I/O。

StarRocks 能够在几秒内加载数据，实现近乎实时的分析。StarRocks 的存储引擎保证了每次数据摄入操作的原子性、一致性、隔离性和持久性（ACID）。对于数据加载事务，整个事务要么全部成功，要么全部失败。并发事务互不干扰，实现了事务级别的隔离。

![Realtime](../assets/1.1-6-realtime.png)

StarRocks 的存储引擎采用删除-插入模式，支持高效的部分更新和 Upsert 操作。存储引擎可以通过主键索引快速过滤数据，消除了在数据读取时进行排序和合并的需要。引擎还可以充分利用二级索引，即使在大量数据更新的情况下，也能提供快速且可预测的查询性能。

## 智能物化视图

StarRocks 利用智能[物化视图](../using_starrocks/Materialized_view.md)来加速查询和数据仓库分层。与其他产品的物化视图不同，StarRocks 的物化视图不需要手动与基表同步数据，而是会根据基表中的数据变化自动更新数据，无需额外的维护操作。此外，物化视图的选择也是自动的。如果 StarRocks 发现一个合适的物化视图（MV）可以提高查询性能，它会自动重写查询以使用该 MV。这个智能过程显著提高了查询效率，无需人工干预。

StarRocks 的 MV 可以替代传统的 ETL 数据建模过程：您可以选择在 StarRocks 内部使用 MV 转换数据，而不是在上游应用中转换数据，简化了数据处理流程。

例如，如图所示，可以使用数据湖上的原始数据基于外部 MV 创建规范化表。可以通过异步物化视图从规范化表创建非规范化表。还可以从规范化表创建另一个 MV，以支持高并发查询和更好的查询性能。

![MV](../assets/1.1-7-mv.png)

## 数据湖分析

![DLA](../assets/1.1-8-dla.png)

除了对本地数据进行高效分析，StarRocks 还可以作为计算引擎分析存储在如 Apache Hive、Apache Iceberg、Apache Hudi 和 Delta Lake 等数据湖中的数据。StarRocks 的一个关键特性是其外部目录，它作为与外部维护的元存储的链接。这一功能为用户提供了无缝查询外部数据源的能力，无需进行数据迁移。因此，用户可以分析来自 HDFS 和 Amazon S3 等不同系统的数据，支持 Parquet、ORC 和 CSV 等多种文件格式。

上图展示了一个数据湖分析场景，其中 StarRocks 负责数据的计算和分析，而数据湖负责数据的存储、组织和维护。数据湖允许用户以开放的存储格式存储数据，并使用灵活的模式为各种 BI、AI、即席查询和报告用例生成“单一真相来源”的报告。StarRocks 充分发挥其矢量化引擎和 CBO 的优势，显著提升了数据湖分析的性能。