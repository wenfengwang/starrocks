---
displayed_sidebar: English
---

# 特性

StarRocks提供了丰富的功能，可在大规模数据上实现快速、实时的分析体验。

## MPP框架

StarRocks采用了大规模并行处理（MPP）框架。一个查询请求被拆分为多个物理计算单元，这些计算单元可以在多台机器上并行执行。每台机器都有专用的CPU和内存资源。MPP框架充分利用了所有CPU内核和机器的资源。随着集群的横向扩展，单个查询的性能可以不断提高。

![MPP](../assets/1.1-3-mpp.png)

在上图中，StarRocks根据语句的语义将SQL语句解析为多个逻辑执行单元（查询片段）。然后，每个片段根据计算复杂度由一个或多个物理执行单元（片段实例）实现。物理执行单元是StarRocks中最小的调度单元。它们将被安排到后端（BE）执行。一个逻辑执行单元可以包含一个或多个运算符，例如Scan、Project和Agg运算符，如图右侧所示。每个物理执行单元只处理部分数据，结果将被合并以生成最终数据。**逻辑执行单元的并行执行充分利用了所有CPU内核和物理机的资源，加快了查询速度。**

![MPP](../assets/1.1-4-mpp.png)

与许多其他数据分析系统使用的Scatter-Gather框架不同，MPP框架可以利用更多资源来处理查询请求。在Scatter-Gather框架中，只有Gather节点可以执行最终的合并操作。在MPP框架中，数据被洗牌到多个节点进行合并操作。对于高基数字段的Group By和大表联接等复杂查询，StarRocks的MPP框架相比Scatter-Gather框架具有明显的性能优势。

## 完全矢量化的执行引擎

完全矢量化的执行引擎可以更有效地利用CPU处理能力，因为该引擎以列式方式组织和处理数据。具体来说，StarRocks以列式方式存储数据、整理内存数据、计算SQL算子。列式组织充分利用CPU缓存。列式计算减少了虚拟函数调用和分支判断的次数，从而使CPU指令流更充足。

矢量化执行引擎还充分利用了SIMD指令。该引擎可以用更少的指令完成更多的数据操作。对标准数据集的测试表明，该引擎将操作员的整体性能提高了3到10倍。

除了算子矢量化，StarRocks还对查询引擎进行了其他优化。例如，StarRocks使用编码数据操作技术，直接对编码字符串执行运算符，无需解码。这显著降低了SQL复杂性，并将查询速度提高了2倍以上。

## 存储和计算分离

从3.0开始引入[存算分离架构](./Architecture.md)。在这种架构中，计算和存储解耦，实现资源隔离、计算节点弹性伸缩和高性能查询。存算分离使StarRocks具有更好的灵活性、更高的性能和数据可用性以及更低的成本。

![共享数据](../assets/share_data_arch.png)

在存算分离模式下，计算和存储是解耦的，可以独立扩展，这消除了长期存在的存储-计算耦合模式下长期存在的成本，即用户需要随时扩展存储，需要添加计算节点。此外，计算可以动态扩展秒数，提高资源利用率，尤其是在有明显的流量高峰和低谷时。

存储层利用对象存储近乎无限的容量和高可靠性，实现海量数据存储和数据持久化。StarRocks支持多种对象存储系统，如AWS S3、Google Cloud Storage、Azure Blob Storage、HDFS和其他兼容S3的存储，如MinIO。

用户可以选择将StarRocks部署在公有云、私有云或本地数据中心。StarRocks支持基于Kubernetes的部署，并提供Operator用于存储计算解耦集群的自动化部署。

StarRocks在存算分离模式下提供与存算耦合模式相同的功能。数据写入和热数据查询性能也是一样的。用户可以像在存储-计算耦合模式下一样执行数据更新、数据湖分析和物化视图加速。

关于如何部署存储和计算分离的StarRocks集群，请参见[部署共享数据集群](../deployment/shared_data/s3.md)。

## 基于成本的优化器

![CBO](../assets/1.1-5-cbo.png)

多表联接查询的性能很难优化。单靠执行引擎无法提供卓越的性能，因为在多表联接查询方案中，执行计划的复杂性可能会相差几个数量级。关联的表越多，执行计划就越多，这使得选择最优计划变得困难。只有足够优秀的查询优化器才能选择相对最佳的查询计划，以实现高效的多表分析。

StarRocks设计了全新的[CBO](../using_starrocks/Cost_based_optimizer.md)。该CBO采用类级联框架，并针对矢量化执行引擎进行了深度定制，并进行了多项优化和创新。这些优化包括重用公用表表达式（CTEs）、重写子查询、横向联接、联接重新排序、分布式联接执行的策略选择以及低基数优化。CBO总共支持99个TPC-DS SQL语句。

CBO使StarRocks能够提供比竞争对手更好的多表连接查询性能，尤其是在复杂的多表连接查询中。

## 实时、可更新的列式存储引擎

StarRocks是一个列式存储引擎，支持连续存储相同类型的数据。在列式存储中，可以以更高效的方式对数据进行编码，从而提高压缩率并降低存储成本。列式存储还减少了总数据读取I/O，从而提高了查询性能。此外，在大多数OLAP方案中，仅查询特定列。列式存储使用户能够仅查询部分列，从而大大减少磁盘I/O。

StarRocks可以在几秒钟内加载数据，进行近乎实时的分析。StarRocks的存储引擎保证了每个数据采集操作的原子性、一致性、隔离性和持久性（ACID）。对于数据加载事务，整个事务要么成功，要么失败。并发事务互不影响，提供事务级隔离。

![实时](../assets/1.1-6-realtime.png)

StarRocks的存储引擎采用Delete-and-insert模式，可实现高效的Partial Update和Upsert操作。存储引擎可以使用主键索引快速过滤数据，无需在读取数据时进行Sort和Merge操作。该引擎还可以充分利用二级索引。即使在大量数据更新的情况下，它也能提供快速且可预测的查询性能。

## 智能物化视图

StarRocks使用智能[物化视图](../using_starrocks/Materialized_view.md)来加速查询和数据仓库分层。有别于其他同类产品需要手动与基表同步数据的物化视图，StarRocks的物化视图会根据基表中的数据变化自动更新数据，无需额外的维护操作。此外，物化视图的选择也是自动的。如果StarRocks识别出合适的物化视图（MV）来提升查询性能，它会自动重写查询以利用该MV。这种智能流程显著提高了查询效率，无需人工干预。

StarRocks的MV可以取代传统的ETL数据建模流程：您现在可以选择在StarRocks中使用MV转换数据，而不是在上游应用程序中转换数据，从而简化数据处理流程。

例如，在图中，数据湖上的原始数据可用于创建基于外部MV的规范化表。可以通过异步实例化视图从规范化表创建非规范化表。可以从规范化表创建另一个MV，以支持高并发查询和更好的查询性能。

![MV](../assets/1.1-7-mv.png)

## 数据湖分析

![DLA](../assets/1.1-8-dla.png)

除了对本地数据进行高效分析外，StarRocks还可以作为计算引擎，对[data lakes](../data_source/catalog/catalog_overview.md)中的数据进行分析，如Apache Hive、Apache Iceberg、Apache Hudi、Delta Lake等。StarRocks的主要功能之一是它的外部目录，它充当与外部维护的元存储的链接。此功能使用户能够无缝查询外部数据源，无需进行数据迁移。因此，用户可以分析来自不同系统（如HDFS和Amazon S3）的数据，采用各种文件格式，如Parquet、ORC和CSV等。

上图为一个数据湖分析场景，StarRocks负责数据计算和分析，数据湖负责数据存储、组织和维护。数据湖允许用户以开放存储格式存储数据，并使用灵活的架构为各种BI、AI、临时和报告用例生成有关“单一事实来源”的报告。StarRocks充分利用矢量化引擎和CBO的优势，显著提升了数据湖分析的性能。
