---
displayed_sidebar: English
---

# 用户自定义变量

本主题描述了如何声明和使用用户自定义变量。

StarRocks 2.5 及更高版本支持用户自定义变量。这些变量用于存储后续 SQL 语句中引用的特定值，从而简化 SQL 语句的编写并避免重复计算。

## 使用说明

- 用户自定义变量是会话中由用户创建的变量。这意味着其他用户无法访问已由另一用户声明的用户自定义变量，并且当会话关闭时，这些变量将会过期。
- StarRocks 不支持使用 SHOW 语句来显示已有的用户自定义变量。
- 以下类型的值不能声明为用户自定义变量：BITMAP、HLL、PERCENTILE 和 ARRAY。JSON 类型的用户自定义变量将转换为 STRING 类型进行存储。

## 声明用户自定义变量

### 语法

```Plain
SET @var_name = expr [, ...];
```

> **注意**
>
> - 所有变量必须以单个 at 符号 (@) 开头。
> - 可以在同一 SET 语句中声明多个变量，需要用逗号 (,) 分隔。
> - 可以多次声明同一个变量，新声明的值将覆盖原始值。
> - 如果使用未声明的变量，则该变量的值默认为 `NULL`，NULL 类型为 STRING。

### 参数

| **参数** | **必填** | **描述**                                              |
| ------------- | ------------ | ------------------------------------------------------------ |
| var_name      | 是          | 用户自定义变量的名称。命名约定如下：<ul><li>名称可以包含字母、数字 (0-9) 和下划线 (\_)。 </li><li>名称长度不能超过 64 个字符。</li></ul>可以将字符串声明为用户自定义变量，例如 @'my-var'、@"my-var" 和 @\`my-var\`。STRING 类型的用户自定义变量可以包含字母、数字和下划线 (_) 以外的字符，例如句点 (.)。 |
| expr          | 是          | 用户自定义变量的值。可以为此参数指定一个数字（例如 43）或一个复杂表达式（例如 SELECT 语句返回的值）。变量的数据类型与表达式返回的结果的数据类型相同。 |

### 例子

示例 1：将数字声明为用户自定义变量。

```SQL
SET @var = 43;
```

示例 2：将 SELECT 查询返回的值声明为用户自定义变量。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

示例 3：在同一 SET 语句中声明多个用户自定义变量。

```SQL
SET @v1=1, @v2=2;
```

## 在 SQL 中使用用户自定义变量

- 简化 SQL 语句的编写。例如，当您执行以下 SELECT 语句时，StarRocks 将 `@var` 解析为 `1`。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 避免重复计算。例如，当您执行以下 SELECT 语句时，StarRocks 将 `@var` 解析为命令 `select sum(c1) from tbl` 返回的结果。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```
