---
displayed_sidebar: English
---

# 用户定义变量

本主题介绍如何声明和使用用户定义变量。

StarRocks 2.5及以上版本支持用户定义变量。这些变量用于存储后续SQL语句中引用的特定值，从而简化SQL语句的编写，并避免重复计算。

## 使用说明

- 用户定义变量是用户可以创建并存在于会话中的变量。这意味着其他用户无法访问由某个用户声明的用户定义变量，并且当会话关闭时这些变量将失效。
- StarRocks 不支持使用 SHOW 语句来显示现有的用户定义变量。
- 以下类型的值不能声明为用户定义变量：BITMAP、HLL、PERCENTILE 和 ARRAY。JSON 类型的用户定义变量会被转换为 STRING 类型进行存储。

## 声明用户定义变量

### 语法

```Plain
SET @var_name = expr [, ...];
```

> **注意**
- 所有变量前面都必须有一个 at 符号 (@)。
- 同一个 SET 语句中可以声明多个变量，变量之间需要用逗号（,）分隔。
- 可以多次声明同一个变量。新声明的值会覆盖原有值。
- 如果使用未声明的变量，则该变量的默认值为 `NULL`，并且 NULL 类型为 STRING。

### 参数

|**参数**|**是否必填**|**描述**|
|---|---|---|
|var_name|是|用户定义变量的名称。命名规则如下：<ul><li>名称可以包含字母、数字（0-9）和下划线（\_）。</li><li>名称长度不能超过 64 个字符。</li></ul>您可以将字符串声明为用户定义变量，例如 @'my-var'、@"my-var" 和 @\`my-var\`。STRING 类型的用户定义变量可以包含除字母、数字和下划线（_）之外的其他字符，例如句点（.）。|
|expr|是|用户定义变量的值。您可以为此参数指定一个数字（例如 43）或一个复杂的表达式（例如 SELECT 语句返回的值）。变量的数据类型与表达式返回结果的数据类型相同。|

### 示例

示例 1：将一个数字声明为用户定义变量。

```SQL
SET @var = 43;
```

示例 2：将 SELECT 查询返回的值声明为用户定义变量。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

示例 3：在同一个 SET 语句中声明多个用户定义变量。

```SQL
SET @v1=1, @v2=2;
```

## 在 SQL 中使用用户定义变量

- 简化 SQL 语句的编写。例如，当您执行以下 SELECT 语句时，StarRocks 会将 @var 解析为 1。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 FROM test;
  ```

- 避免重复计算。例如，当您执行以下 SELECT 语句时，StarRocks 会将 @var 解析为 `select sum(c1) from tbl` 命令返回的结果。

  ```Plain
  SET @var = (SELECT SUM(c1) FROM tbl);
  SELECT @var, v1 FROM test;
  ```