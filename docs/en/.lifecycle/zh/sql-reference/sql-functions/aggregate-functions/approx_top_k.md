---
displayed_sidebar: English
---

# approx_top_k

## 描述

返回在一个表达式 `expr` 中出现频率最高的前 `k` 个项目值及其近似计数。

## 语法

```Haskell
APPROX_TOP_K(<expr> [ , <k> [ , <counter_num> ] ] )
```

## 参数

* `expr`：STRING、BOOLEAN、DATE、DATETIME 或数值类型的表达式。
* `k`：一个可选的、大于 0 的 INTEGER 字面量。如果没有指定 `k`，则默认值为 `5`。
  *   最大值为 `100000`
* `counter_num`：一个可选的、大于或等于 `k` 的 INTEGER 字面量。`counter_num` 越大，结果越精确。但是，这也会导致 CPU 和内存成本的增加。
  *   最大值为 `100000`
  *   如果没有指定 `counter_num`，其默认值为 `max(min(2 * k, 100), 100000)`。

## 返回值

结果以 STRUCT 类型的 ARRAY 形式返回，每个 STRUCT 包含一个 `item` 字段表示值（保持其原始输入类型）和一个 `count` 字段（BIGINT 类型）表示大致的出现次数。数组按 `count` 降序排序。

该聚合函数返回在表达式 `expr` 中出现频率最高的前 `k` 个项目值及其近似计数。每个计数的误差可能高达 `2.0 * numRows / counter_num`，其中 `numRows` 是总行数。`counter_num` 的值越高，精度越好，但会导致内存使用量增加。如果表达式中的不同项目少于 `counter_num`，将得到精确的项目计数。结果中包括将 `NULL` 值作为单独的项目。

## 示例

```plain
MySQL > SELECT APPROX_TOP_K(L_LINESTATUS) FROM lineitem;
+-------------------------------------------------------------+
| approx_top_k(L_LINESTATUS)                                  |
+-------------------------------------------------------------+
| [{"item":"O","count":3004998},{"item":"F","count":2996217}] |
+-------------------------------------------------------------+

MySQL > SELECT APPROX_TOP_K(L_LINENUMBER) FROM lineitem GROUP BY L_RETURNFLAG;
+-------------------------------------------------------------------------------------------------------------------------------------+
| approx_top_k(L_LINENUMBER)                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------+
| [{"item":1,"count":761151},{"item":2,"count":652280},{"item":3,"count":543265},{"item":4,"count":434834},{"item":5,"count":326135}] |
| [{"item":1,"count":368853},{"item":2,"count":316830},{"item":3,"count":263950},{"item":4,"count":211270},{"item":5,"count":158495}] |
| [{"item":1,"count":369996},{"item":2,"count":316718},{"item":3,"count":264179},{"item":4,"count":210911},{"item":5,"count":158657}] |
+-------------------------------------------------------------------------------------------------------------------------------------+
```

## 关键词

APPROX_TOP_K