---
displayed_sidebar: English
---

# approx_top_k

## 描述

返回 `expr` 中出现频率最高的前 `k` 个项值，以及它们的近似计数。

## 语法

```Haskell
APPROX_TOP_K(<expr> [ , <k> [ , <counter_num> ] ] )
```

## 参数

* `expr`：STRING、BOOLEAN、DATE、DATETIME 或数值类型的表达式。
* `k`：一个可选的大于 0 的整数文字。如果未指定 `k`，则默认为 `5`。
    * 最大值为 `100000`
* `counter_num`：一个可选的大于或等于 `k` 的整数文字，`counter_num` 越大，结果越准确。但是，这也伴随着 CPU 和内存成本的增加。
    * 最大值为 `100000`
    * 如果未指定 `counter_num`，则默认为 `max(min(2 * k, 100), 100000)`。

## 返回

结果以 STRUCT 类型的 ARRAY 形式返回，其中每个 STRUCT 包含一个 `item` 字段（具有其原始输入类型）和一个 `count` 字段（类型为 BIGINT），表示该项的近似出现次数。数组按 `count` 降序排序。

该聚合函数返回表达式 `expr` 中出现频率最高的前 `k` 个项值，以及它们的近似计数。每个计数的误差可能高达 `2.0 * numRows / counter_num`，其中 `numRows` 是总行数。较大的 `counter_num` 值提供更高的准确性，但会增加内存使用量。具有少于 `counter_num` 个不同项的表达式将产生准确的项计数。结果中包括 `NULL` 值作为独立的项。

## 例子

```plain text
MySQL > SELECT APPROX_TOP_K(L_LINESTATUS) FROM lineitem;
+-------------------------------------------------------------+
| approx_top_k(L_LINESTATUS)                                  |
+-------------------------------------------------------------+
| [{"item":"O","count":3004998},{"item":"F","count":2996217}] |
+-------------------------------------------------------------+

MySQL > SELECT APPROX_TOP_K(L_LINENUMBER) FROM lineitem GROUP BY L_RETURNFLAG
+-------------------------------------------------------------------------------------------------------------------------------------+
| approx_top_k(L_LINENUMBER)                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------+
| [{"item":1,"count":761151},{"item":2,"count":652280},{"item":3,"count":543265},{"item":4,"count":434834},{"item":5,"count":326135}] |
| [{"item":1,"count":368853},{"item":2,"count":316830},{"item":3,"count":263950},{"item":4,"count":211270},{"item":5,"count":158495}] |
| [{"item":1,"count":369996},{"item":2,"count":316718},{"item":3,"count":264179},{"item":4,"count":210911},{"item":5,"count":158657}] |
+-------------------------------------------------------------------------------------------------------------------------------------+
```

## 关键词

APPROX_TOP_K

