---
displayed_sidebar: English
---

# 权限概述

本主题描述了 StarRocks 权限系统的基本概念。权限决定了哪些用户可以对哪些对象执行哪些操作，以便您可以更安全地以细粒度的方式管理数据和资源。

> 注意：本主题中描述的权限仅在 v3.0 中可用。v3.0 中的权限框架和语法与早期版本中的权限框架和语法不向后兼容。升级到 v3.0 后，除特定操作外，大部分原有权限仍保留。具体差异请参见 [特权支持的升级说明] [StarRocks 支持的权限](privilege_item.md)。

StarRocks 采用两种特权模式：

- 基于角色的访问控制（RBAC）：将权限分配给角色，然后将角色分配给用户。在这种情况下，权限通过角色传递给用户。
- 基于身份的访问控制（IBAC）：权限直接分配给用户身份。

因此，每个用户标识的最大权限范围是其自身权限与分配给此用户标识的角色的权限的并集。

**了解 StarRocks 权限系统**的基本概念：

- **对象**：可以向其授予访问权限的实体。除非授权允许，否则访问将被拒绝。对象的示例包括 CATALOG、DATABASE、TABLE 和 VIEW。更多信息，请参见 [StarRocks 支持的权限](privilege_item.md)。
- **权限**：对对象的定义访问级别。可以使用多个权限来控制对对象授予的访问粒度。权限是特定于对象的。不同的对象可能具有不同的权限。权限的示例包括 SELECT、ALTER 和 DROP。
- **用户身份**：用户的唯一身份，以及可以授予权限的实体。用户身份表示为 `username@'userhost'`，由用户名和用户登录的 IP 组成。使用标识可简化属性配置。共享相同用户名的用户标识共享相同的属性。如果为用户名配置属性，则此属性将对共享此用户名的所有用户身份生效。
- **角色**：可以向其授予权限的实体。角色是权限的抽象集合。角色可以依次分配给用户。还可以将角色分配给其他角色，从而创建角色层次结构。为了方便数据管理，StarRocks 提供了系统定义的角色。为了提高灵活性，您还可以根据业务需求创建自定义角色。

下图显示了 RBAC 和 IBAC 权限模型下的权限管理示例。

在模型中，允许通过分配给角色和用户的权限访问对象。角色又分配给其他角色或用户。

![权限管理](../assets/privilege-manage.png)

## 对象和权限

对象具有逻辑层次结构，这与它们所表示的概念相关。例如，“数据库”包含在“目录”中，“表”、“视图”、“物化视图”和“函数”包含在“数据库”中。StarRocks 系统中的对象层次结构如下图所示。

![特权对象](../assets/privilege-object.png)

每个对象都有一组可以授予的权限项。这些权限定义可以对这些对象执行哪些操作。您可以通过 [GRANT](../sql-reference/sql-statements/account-management/GRANT.md) 和 [REVOKE](../sql-reference/sql-statements/account-management/REVOKE.md) 命令授予和撤消角色或用户的权限。

## 用户

### 用户身份

在 StarRocks 中，每个用户都由一个唯一的用户 ID 标识。它由 IP 地址（用户主机）和用户名组成，格式为 `username@'userhost'`。StarRocks 将用户名相同但 IP 地址不同的用户识别为不同的用户身份。例如， `user1@'starrocks.com'` 和 `user1@'mirrorship.com'` 是两个用户标识。

用户身份的另一种表示形式是 `username@['domain']`，其中 `domain` 是可由 DNS 解析为一组 IP 地址的域名。 `username@['domain']` 最后表示为一组 `username@'userhost'`。您可以使用 `%` 用于 `userhost` 模糊匹配的部分。如果未指定 `userhost`，则默认为 `'%'`，这意味着从任何主机登录的同名用户。

### 向用户授予权限

用户是可以向其授予权限的实体。权限和角色都可以分配给用户。每个用户标识的最大权限范围是其自身权限与分配给此用户标识的角色权限的并集。StarRocks 确保每个用户只能进行授权操作。

在大多数情况下，我们建议您**使用角色来传递权限**。例如，创建角色后，您可以向该角色授予权限，然后将该角色分配给用户。如果要授予临时权限或特殊权限，可以直接授予用户。这简化了权限管理并提供了灵活性。

## 角色

角色是可以授予和撤消权限的实体。角色可以看作是可以分配给用户的权限集合，以允许他们执行所需的操作。可以为用户分配多个角色，以便他们可以使用单独的权限集执行不同的操作。为了简化管理，StarRocks 建议您**通过角色管理权限**。可以直接向用户授予特殊和临时权限。

为了方便管理，StarRocks 提供了多个**系统自定义角色**，具有特定的权限，帮助您满足日常管理和维护需求。您还可以灵活**地自定义角色**，以满足特定的业务需求和安全需求。请注意，系统定义角色的权限范围无法修改。

角色开通后，用户可以执行该角色授权的操作。您可以设置**默认**角色，这些角色在用户登录时自动激活。用户还可以手动激活当前会话中使用的此角色所拥有的角色。

### 系统定义的角色

StarRocks 提供了多种类型的系统自定义角色。

![角色](../assets/privilege-role.png)

- `root`：具有全局权限。默认情况下，`root` 用户具有 `root` 该角色。
   StarRocks 集群创建成功后，系统会自动生成一个具有 root 权限的 root 用户。由于 root 用户和角色拥有系统的所有权限，建议您为后续操作创建新的用户和角色，以防止出现任何风险操作。妥善保管 root 用户的密码。
- `cluster_admin`：具有集群管理权限，可以执行节点相关操作，例如添加或删除节点。
  `cluster_admin` 具有添加、删除和停用群集节点的权限。我们建议您不要将`cluster_admin`包含此角色的任何自定义角色作为默认角色分配给任何用户，以防止意外的节点更改。
- `db_admin`：具有数据库管理权限，包括对目录、数据库、表、视图、物化视图、函数、全局函数、资源组、插件等所有操作的权限。
- `user_admin`：对用户和角色具有管理权限，包括创建用户、角色和权限。

  以上系统定义的角色旨在聚合复杂的数据库权限，以方便您的日常管理。**上述角色的权限范围不可修改。**

  此外，如果您需要为所有用户授予特定权限，StarRocks 还提供了系统定义的角色 `public`。

- `public`：此角色由任何用户拥有，并在任何会话（包括添加新用户）中默认激活。默认情况下，该 `public` 角色没有任何权限。您可以修改此角色的权限范围。

### 自定义角色

您可以创建自定义角色以满足特定的业务需求，并修改其权限范围。同时，为了方便管理，您可以将角色分配给其他角色，以创建权限层次结构和继承。然后，与一个角色关联的权限将由另一个角色继承。

#### 角色层次结构和特权继承

下图显示了权限继承的示例。

> 注意：角色的最大继承级别数为 16。继承关系不能是双向的。

![角色继承](../assets/privilege-role_inheri.png)

如图所示：

- `role_s` 分配给 `role_p`。`role_p` 隐式继承 `role_s`的 `priv_1`。
- `role_p` 被赋值给 `role_g`，`role_g` 隐式继承 `role_p`的 `priv_2` 和 `role_s`的 `priv_1`。
- 将角色分配给用户后，该用户也具有此角色的权限。

### 活动角色

活动角色允许用户在当前会话下应用角色的权限。可用于使用 `SELECT CURRENT_ROLE();` 查看当前会话中的活动角色。有关详细信息，请参阅 [current_role](../sql-reference/sql-functions/utility-functions/current_role.md)。

#### 默认角色

默认角色会在用户登录集群时自动激活。它可以是一个或多个用户拥有的角色。管理员可以使用 `DEFAULT ROLE` 在 [CREATE USER](../sql-reference/sql-statements/account-management/CREATE_USER.md) 中的关键字设置默认角色，并可以使用 [ALTER USER](../sql-reference/sql-statements/account-management/ALTER_USER.md) 更改默认角色。

用户还可以使用 [SET DEFAULT ROLE](../sql-reference/sql-statements/account-management/SET_DEFAULT_ROLE.md) 更改其默认角色。

默认角色为用户提供基本的权限保护。例如，用户 A 具有 `role_query` 和 `role_delete`，分别具有查询和删除权限。建议仅作为默认角色使用，以防止因高风险操作，如 `DELETE` 或 `TRUNCATE`，导致数据丢失。如果需要执行这些操作，可以在手动设置活动角色后进行。

没有默认角色的用户仍具有 `public` 角色，该角色在用户登录集群后自动激活。

#### 手动激活角色

除了默认角色外，用户还可以在会话中手动激活一个或多个现有角色。您可以使用 [SHOW GRANTS](../sql-reference/sql-statements/account-management/SHOW_GRANTS.md) 查看可以激活的权限和角色，并使用 [SET ROLE](../sql-reference/sql-statements/account-management/SET_ROLE.md) 配置在当前会话中有效的活动角色。

请注意，SET ROLE 命令会相互覆盖。例如，用户登录后，默认情况下会激活 `default_role`。然后用户运行 `SET ROLE role_s`。此时，用户只有 `role_s` 的权限和自己的权限。`default_role` 被覆盖。

## 引用

- [StarRocks 支持的特权](privilege_item.md)
- [管理用户权限](User_privilege.md)
