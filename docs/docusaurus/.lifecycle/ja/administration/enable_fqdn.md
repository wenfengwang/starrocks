---
displayed_sidebar: "Japanese"
---

# FQDNアクセスを有効にする

このトピックでは、完全修飾ドメイン名（FQDN）を使用してクラスタアクセスを有効にする方法について説明します。 FQDNは、インターネット経由でアクセスできる特定のエンティティの**完全なドメイン名**です。 FQDNは、ホスト名とドメイン名の2つの部分で構成されています。

2.4より前のバージョンでは、StarRocksはFEおよびBEへのアクセスをIPアドレスのみでサポートしていました。クラスタにノードを追加する際にFQDNを使用しても、最終的にはIPアドレスに変換されます。これにより、StarRocksクラスタの特定のノードのIPアドレスを変更すると、ノードへのアクセスの失敗が発生し、DBAにとって大きな不便が生じます。 バージョン2.4では、StarRocksは各ノードをそのIPアドレスから切り離します。これにより、StarRocksでノードをFQDNのみで管理できるようになりました。

## 前提条件

StarRocksクラスタでFQDNアクセスを有効にするには、次の要件を満たしていることを確認してください：

- クラスタ内の各マシンにホスト名があること。

- 各マシンの**/etc/hosts**ファイルで、クラスタ内の他のマシンの対応するIPアドレスとFQDNを指定する必要があります。

- **/etc/hosts**ファイル内のIPアドレスは一意である必要があります。

## FQDNアクセスを使用して新しいクラスタをセットアップする

デフォルトでは、新しいクラスタのFEノードはIPアドレスアクセスを使用して起動されます。 FQDNアクセスを使用して新しいクラスタを開始するには、次のコマンドを実行してFEノードを開始する必要があります**クラスタを初めて開始するとき**：

```Shell
./bin/start_fe.sh --host_type FQDN --daemon
```

プロパティ`--host_type`は、ノードを開始するために使用するアクセスメソッドを指定します。有効な値には、`FQDN`および`IP`が含まれます。ノードを初めて開始するときにこのプロパティを1回だけ指定する必要があります。

StarRocksのインストールの詳細な手順については、[StarRocksをデプロイ](../deployment/deploy_manually.md)を参照してください。

各BEノードは、FEメタデータで定義された`BE Address`で自身を識別します。したがって、BEノードを開始するときに`--host_type`を指定する必要はありません。 `BE Address`がFQDNを持つBEノードを定義する場合は、BEノードはこのFQDNで自身を識別します。

## 既存のクラスタでFQDNアクセスを有効にする

以前にIPアドレスを使用して開始された既存のクラスタでFQDNアクセスを有効にするには、ますますStarRocksをバージョン2.4.0以降に**アップグレード**する必要があります。

### FEノードのFQDNアクセスを有効にする

FQDNアクセスをリーダーフォロワーFEノードではないすべてのFEノードに有効にするには、次の手順に従います。

> **注意**
>
> FEノードにFQDNアクセスを有効にする前に、クラスタに少なくとも3つのFollower FEノードがあることを確認してください。

#### リーダーフォロワーFEノード以外のFEノードのFQDNアクセスを有効にする

1. FEノードのデプロイディレクトリに移動し、次のコマンドを実行してFEノードを停止します：

    ```Shell
    ./bin/stop_fe.sh --daemon
    ```

2. MySQLクライアントを使用して次のステートメントを実行し、停止したFEノードの`Alive`ステータスを確認します。`Alive`ステータスが`false`になるまで待ちます。

    ```SQL
    SHOW PROC '/frontends'\G
    ```

3. 次のステートメントを実行して、IPアドレスをFQDNに置き換えます。

    ```SQL
    ALTER SYSTEM MODIFY FRONTEND HOST "<fe_ip>" TO "<fe_hostname>";
    ```

4. FQDNアクセスを使用してFEノードを開始するために、次のコマンドを実行します。

    ```Shell
    ./bin/start_fe.sh --host_type FQDN --daemon
    ```

    プロパティ`--host_type`は、ノードを再起動した後に1回だけ指定する必要があります。有効な値には、`FQDN`および`IP`が含まれます。

5. FEノードの`Alive`ステータスを確認します。`Alive`ステータスが`true`になるまで待ちます。

    ```SQL
    SHOW PROC '/frontends'\G
    ```

6. 現在のFEノードの`Alive`ステータスが`true`になった後に、他のリーダーフォロワーFEノードに順番にFQDNアクセスを有効にします。

#### リーダーフォロワーFEノードのFQDNアクセスを有効にする

すべてのリーダーフォロワーFEノードが正常に変更および再起動された後に、リーダーフォロワーFEノードにFQDNアクセスを有効にできます。

> **注意**
>
> リーダーフォロワーFEノードにFQDNアクセスを有効にする前に、クラスタにFQDNを使用してノードを追加すると、引き続きFQDNが対応するIPアドレスに変換されます。 FQDNアクセスが有効になっているリーダーフォロワーFEノードがクラスタに選出されると、FQDNはIPアドレスに変換されなくなります。

1. リーダーフォロワーFEノードのデプロイディレクトリに移動し、次のコマンドを実行してリーダーフォロワーFEノードを停止します。

    ```Shell
    ./bin/stop_fe.sh --daemon
    ```

2. MySQLクライアントを使用して次のステートメントを実行し、クラスタに新しいリーダーフォロワーFEノードが選出されているかどうかを確認します。

    ```SQL
    SHOW PROC '/frontends'\G
    ```

    `Alive`および`isMaster`ステータスが`true`であるFEノードは、実行中のリーダーフォロワーFEノードです。

3. 次のステートメントを実行して、IPアドレスをFQDNに置き換えます。

    ```SQL
    ALTER SYSTEM MODIFY FRONTEND HOST "<fe_ip>" TO "<fe_hostname>";
    ```

4. FQDNアクセスを使用してFEノードを開始するために、次のコマンドを実行します。

    ```Shell
    ./bin/start_fe.sh --host_type FQDN --daemon
    ```

    プロパティ`--host_type`は、ノードを再起動した後に1回だけ指定する必要があります。有効な値には、`FQDN`および`IP`が含まれます。

5. FEノードの`Alive`ステータスを確認します。

    ```Plain
    SHOW PROC '/frontends'\G
    ```

  `Alive`ステータスが`true`になった場合、FEノードは正常に変更され、リーダーフォロワーFEノードとしてクラスタに追加されています。

### BEノードのFQDNアクセスを有効にする

BEノードのFQDNアクセスを有効にするには、次のステートメントをMySQLクライアントを使用して実行して、IPアドレスをFQDNに置き換えます。

```SQL
ALTER SYSTEM MODIFY BACKEND HOST "<be_ip>" TO "<be_hostname>";
```

> **注意**
>
> FQDNアクセスを有効にした後にBEノードを再起動する必要はありません。

## ロールバック

FQDNアクセスが有効化されたStarRocksクラスタをFQDNアクセスをサポートしない以前のバージョンにロールバックするには、クラスタ内のすべてのノードでIPアドレスアクセスを有効にする必要があります。 SQLコマンドを次のように変更する必要がありますが、一般的な手順については[既存のクラスタでFQDNアクセスを有効にする](#enable-fqdn-access-in-an-existing-cluster)を参照してください。

- FEノードのIPアドレスアクセスを有効にする：

```SQL
ALTER SYSTEM MODIFY FRONTEND HOST "<fe_hostname>" TO "<fe_ip>";
```

- BEノードのIPアドレスアクセスを有効にする：

```SQL
ALTER SYSTEM MODIFY BACKEND HOST "<be_hostname>" TO "<be_ip>";
```

変更内容は、クラスタが正常に再起動した後に反映されます。

## よくある質問

**Q：FEノードのFQDNアクセスを有効にするときにエラーが発生します："required 1 replica. But none were active with this master"。どうすればよいですか？**

A：FEノードのFQDNアクセスを有効にする前に、クラスタに少なくとも3つのFollower FEノードがあることを確認してください。

**Q：FQDNアクセスが有効になっているクラスタにIPアドレスを使用して新しいノードを追加できますか？**

A：はい。