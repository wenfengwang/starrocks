---
displayed_sidebar: "Japanese"
---

# 特権の概要

このトピックでは、StarRocksの特権システムの基本的な概念について説明します。特権は、ユーザーがどのオブジェクトでどの操作を実行できるかを決定するため、データとリソースを細かく管理するためのセキュリティを向上させることができます。

> 注意：このトピックで説明されている特権は、v3.0からのみ使用可能です。v3.0の特権フレームワークと構文は、以前のバージョンと互換性がありません。v3.0にアップグレードすると、特定の操作に関する特権を除く、ほとんどの元の特権が保持されます。詳細な違いについては、[StarRocksでサポートされている特権](privilege_item.md)の[アップグレードノート]を参照してください。

StarRocksは、2つの特権モデルを採用しています。

- ロールベースのアクセス制御（RBAC）：特権はロールに割り当てられ、ロールはユーザーに割り当てられます。この場合、特権はロールを介してユーザーに渡されます。
- アイデンティティベースのアクセス制御（IBAC）：特権は直接ユーザーアイデンティティに割り当てられます。

したがって、各ユーザーアイデンティティの最大特権範囲は、そのユーザーアイデンティティ自体の特権とそのユーザーアイデンティティに割り当てられたロールの特権の統合です。

StarRocksの特権システムを理解するための**基本的な概念**は以下の通りです：

- **オブジェクト**：アクセスを許可できる実体。許可されていない限り、アクセスは拒否されます。オブジェクトの例には、CATALOG、DATABASE、TABLE、VIEWなどがあります。詳細については、[StarRocksでサポートされている特権](privilege_item.md)を参照してください。
- **特権**：特定のオブジェクトへのアクセスレベルを定義するもの。複数の特権を使用して、オブジェクトへのアクセスの細かさを制御することができます。特権はオブジェクト固有です。異なるオブジェクトには異なる特権がある場合があります。特権の例には、SELECT、ALTER、DROPなどがあります。
- **ユーザーアイデンティティ**：特権を割り当てることができるユーザーの固有のアイデンティティであり、同時に特権を割り当てることができるエンティティでもあります。ユーザーアイデンティティは`username@'userhost'`として表され、ユーザー名とユーザーがログインするIPから構成されます。ユーザーアイデンティティを使用すると、属性の設定がシンプルになります。同じユーザー名を共有するユーザーアイデンティティは、同じ属性を共有します。ユーザー名に属性を設定すると、このユーザー名を共有するすべてのユーザーアイデンティティに対してこの属性が適用されます。
- **ロール**：特権を割り当てることができるエンティティ。ロールは特権の抽象的な集合です。ロールはユーザーに割り当てることもできます。また、ロールを他のロールに割り当てることもでき、ロールの階層を作成することができます。StarRocksでは、システムで定義されたロールを提供してデータ管理をサポートしています。より柔軟性を持たせるために、ビジネスの要件に応じてカスタムロールを作成することもできます。

次の図は、RBACおよびIBACの特権モデルの下での特権管理の例を示しています。

これらのモデルでは、特権はロールとユーザーに割り当てられることによりオブジェクトへのアクセスが許可されます。ロールは他のロールまたはユーザーに割り当てることもできます。

![特権管理](../assets/privilege-manage.png)

## オブジェクトと特権

オブジェクトには論理的な階層があり、それはそれらが表す概念に関連しています。たとえば、DatabaseはCatalogに含まれ、Table、View、Materialized View、およびFunctionはDatabaseに含まれます。次の図は、StarRocksシステムのオブジェクト階層を示しています。

![特権オブジェクト](../assets/privilege-object.png)

各オブジェクトには、付与できる特権項目のセットがあります。これらの特権は、これらのオブジェクト上で実行できる操作を定義します。[GRANT](../sql-reference/sql-statements/account-management/GRANT.md)および[REVOKE](../sql-reference/sql-statements/account-management/REVOKE.md)コマンドを使用して、特権をロールまたはユーザーに付与および取り消すことができます。

## ユーザー

### ユーザーアイデンティティ

StarRocksでは、各ユーザーは一意のユーザーIDで識別されます。ユーザーIDは、IPアドレス（ユーザーホスト）とユーザー名から構成され、`username @'userhost'`の形式になります。同じユーザー名を持つが異なるIPアドレスからログインするユーザーは、異なるユーザーアイデンティティとしてStarRocksによって識別されます。たとえば、`user1@'starrocks.com'`および`user1@'mirrorship.com'`は2つのユーザーアイデンティティです。

ユーザーアイデンティティの別の表現方法は、`username @['domain']`です。`domain`はDNSによって一連のIPアドレスとして解決されることができるドメイン名です。`username @['domain']`は最終的に`username@'userhost'`のセットとして表されます。`username@'userhost'`部分には、パターンマッチングのために`%`を使用できます。`userhost`が指定されていない場合、デフォルトで`'%'`になります。これは、同じ名前のユーザーが任意のホストからログインした場合を意味します。

### ユーザーに特権を付与する

ユーザーは特権が付与できるエンティティです。特権とロールの両方をユーザーに割り当てることができます。各ユーザーアイデンティティの最大特権範囲は、そのユーザーアイデンティティ自体の特権とこのユーザーアイデンティティに割り当てられたロールの特権の統合です。StarRocksは、各ユーザーが承認された操作のみを実行できるようにします。

ほとんどの場合、特権を渡すために**ロールを使用することをお勧め**します。たとえば、ロールを作成した後、そのロールに特権を付与し、それからユーザーにロールを割り当てることができます。一時または特別な特権を付与する場合は、直接ユーザーに特権を付与することができます。これにより、特権の管理が簡素化され、柔軟性が向上します。

## ロール

ロールは特権が付与および取り消しができるエンティティです。ロールは必要なアクションを実行するためにユーザーに割り当てることができる特権の集合と見なすことができます。ユーザーは複数のロールを割り当てられるため、異なる特権のセットを使用して異なるアクションを実行することができます。管理を簡素化するために、StarRocksは**ロールを介して特権を管理する**ことをお勧めします。特別なおよび一時的な特権は直接ユーザーに付与することができます。

管理を容易にするために、StarRocksはいくつかの**システムで定義されたロール**を提供しており、特定の特権を持っています。これにより、日常の管理とメンテナンスの要件を満たすことができます。また、ビジネスの要件とセキュリティの要件に応じて、柔軟に**カスタムロール**を作成することもできます。なお、システムで定義されたロールの特権範囲は変更できません。

ロールがアクティベートされると、ユーザーはそのロールによって承認された操作を実行することができます。ユーザーがログインするときに自動的にアクティブ化される**デフォルトロール**を設定することもできます。ユーザーは現在のセッションで所有するロールを手動でアクティブ化することもできます。

### システムで定義されたロール

StarRocksは、いくつかの種類のシステムで定義されたロールを提供しています。

![ロール](../assets/privilege-role.png)

- `root`: グローバル特権を持っています。デフォルトでは、`root`ユーザーは`root`ロールを持っています。
   StarRocksクラスタが作成されると、システムは自動的にroot特権を持つrootユーザーを生成します。rootユーザーやロールにはシステムのすべての特権があるため、リスクのある操作を防ぐために、後続の操作のために新しいユーザーやロールを作成することをお勧めします。rootユーザーのパスワードを適切に保持してください。
- `cluster_admin`: ノードに関連する操作（ノードの追加や削除など）を実行するクラスタ管理の特権を持ちます。
  `cluster_admin`は、クラスタノードの追加、削除、および退役を行うための特権を持っています。`cluster_admin`またはこのロールをデフォルトロールとして含むカスタムロールをユーザーに割り当てないようにすることで、予期しないノードの変更を防ぐことをお勧めします。
- `db_admin`: カタログ、データベース、テーブル、ビュー、マテリアライズドビュー、関数、グローバル関数、リソースグループ、プラグインなどに関するすべての操作を実行するデータベース管理の特権を持ちます。
- `user_admin`: ユーザーとロールに対する管理特権を持ちます。ユーザー、ロール、および特権の作成などの特権も持っています。

  上記のシステムで定義されたロールは、日常の管理を容易にするために複雑なデータベース特権を集約しています。**上記のロールの特権範囲は変更できません**。

  また、すべてのユーザーに特定の特権を付与する必要がある場合、StarRocksは`public`というシステムで定義されたロールも提供しています。

- `public`: このロールは任意のユーザーが所有し、任意のセッションでデフォルトでアクティブ化されます。`public`ロールはデフォルトで特権を持っていません。このロールの特権範囲を変更することができます。

### カスタムロール

特定のビジネス要件を満たすためにカスタムロールを作成し、その特権範囲を変更することができます。同時に、管理のためにロールを他のロールに割り当てることで、特権の階層と継承を作成することができます。その後、ロールに関連する特権は別のロールによって継承されます。

#### ロールの階層と特権の継承

下図は、特権の継承の例を示しています。

> 注意：ロールの最大継承レベルは16です。継承関係は双方向ではなくなります。

![ロールの継承](../assets/privilege-role_inheri.png)

図に示されているように：

- `role_s`は`role_p`に割り当てられています。`role_p`は`role_s`の`priv_1`を暗黙的に継承します。
- `role_p`は`role_g`に割り当てられています。`role_g`は`role_p`の`priv_2`および`role_s`の`priv_1`を暗黙的に継承します。
- ロールがユーザーに割り当てられた後、ユーザーもこのロールの特権を持ちます。

### アクティブロール

アクティブロールは、ユーザーが現在のセッションでロールの特権を適用できるようにするものです。アクティブなロールは、`SELECT CURRENT_ROLE();`を使用して現在のセッションで表示することができます。詳細については、[current_role](../sql-reference/sql-functions/utility-functions/current_role.md)を参照してください。

#### デフォルトロール

デフォルトロールは、ユーザーがクラスタにログインしたときに自動的にアクティブ化されるようになっています。それは1つまたは複数のユーザーが所有するロールであることができます。管理者は、[CREATE USER](../sql-reference/sql-statements/account-management/CREATE_USER.md)における`DEFAULT ROLE`キーワードを使用してデフォルトロールを設定することができ、[ALTER USER](../sql-reference/sql-statements/account-management/ALTER_USER.md)を使用してデフォルトロールを変更することができます。

ユーザーは、[SET DEFAULT ROLE](../sql-reference/sql-statements/account-management/SET_DEFAULT_ROLE.md)を使用してデフォルトロールを変更することもできます。
デフォルトロールはユーザーの基本的な特権保護を提供します。たとえば、ユーザーAは`role_query`と`role_delete`を持っており、それぞれクエリと削除の権限を持っています。私たちは、`DELETE`や`TRUNCATE`などの高リスクな操作によるデータ損失を防ぐために、デフォルトロールとして`role_query`のみを使用することを推奨しています。これらの操作を実行する必要がある場合は、アクティブロールを手動で設定した後に行うことができます。

デフォルトロールを持たないユーザーは、ログイン後に自動的にアクティブになる`public`ロールを持っています。

#### ロールの手動アクティブ化

デフォルトロールに加えて、ユーザーはセッション内で既存の1つ以上のロールを手動でアクティブにすることもできます。[SHOW GRANTS](../sql-reference/sql-statements/account-management/SHOW_GRANTS.md) を使用してアクティブにできる権限とロールを表示し、[SET ROLE](../sql-reference/sql-statements/account-management/SET_ROLE.md) を使用して現在のセッションで有効なアクティブロールを構成することができます。

SET ROLE コマンドはお互いに上書きしますので、注意してください。たとえば、ユーザーがログインすると、`default_role` がデフォルトでアクティブになります。その後、ユーザーが `SET ROLE role_s` を実行します。この時点で、ユーザーは`role_s`の特権と自分自身の特権だけを持っています。`default_role` は上書きされます。

## 参考文献

- [StarRocksでサポートされる特権](privilege_item.md)
- [ユーザー特権の管理](User_privilege.md)