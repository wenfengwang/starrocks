---
displayed_sidebar: "Japanese"
---

# StarRocks クラスタの計画

このトピックでは、ノード数、CPU コア数、メモリサイズ、およびストレージサイズの観点から、本番環境での StarRocks クラスタのリソース計画方法について説明します。

## ノード数

StarRocks は主に FE ノードと BE ノードの2種類のコンポーネントで構成されます。各ノードは、物理的または仮想マシン上で個別に展開する必要があります。

### FE ノード数

FE ノードは、メタデータ管理、クライアント接続管理、クエリの計画、およびクエリのスケジューリングを主に担当します。

本番環境では、StarRocks クラスタに少なくとも**3つ**の Follower FE ノードを展開し、単一障害点（SPOF）を防ぐことを推奨します。

StarRocks は、FE ノード間のメタデータを管理するために BDB JE プロトコルを使用します。StarRocks は、すべての Follower FE ノードから Leader FE ノードを選出します。Leader FE ノードはメタデータを書き込むことができます。他の Follower FE ノードは、Leader FE ノードのログに基づいてメタデータを更新します。Leader FE ノードが障害を起こすたびに、StarRocks は Follower FE ノードが半数以上生きている限り、新しい Leader FE ノードを再選出します。

アプリケーションが非常に同時にクエリリクエストを生成する場合は、クラスタに Observer FE ノードを追加することができます。Observer FE ノードはクエリリクエストのみ処理し、Leader FE ノードの選出には参加しません。

### BE ノード数

BE ノードはデータの保存と SQL の実行を担当します。

本番環境では、StarRocks クラスタに少なくとも**3つ**の BE ノードを展開し、高いデータ信頼性とサービスの可用性を確保することを推奨します。少なくとも3つの BE ノードが展開され、StarRocks クラスタに追加されると、BE の高可用性クラスタが自動的に形成されます。1つの BE ノードの障害は、BE サービスの全体的な可用性に影響を与えません。

StarRocks クラスタが非常に同時にクエリを処理できるようにするには、BE ノードの数を増やすことができます。

### CN ノード数

CN ノードは StarRocks のオプションのコンポーネントであり、SQL の実行のみを担当します。

CN ノードの数を増やすことで、StarRocks クラスタのデータ分布を変更せずに、計算リソースを弾力的にスケーリングすることができます。

## CPU とメモリ

通常、FE サービスは多くの CPU およびメモリリソースを消費しません。各 FE ノードには 8 CPU コアと 16 GB RAM を割り当てることを推奨します。

FE サービスとは異なり、BE サービスは、アプリケーションが大規模なデータセットで非常に同時または複雑なクエリを処理する場合、かなりの CPU およびメモリを消費する可能性があります。そのため、各 BE ノードには 16 CPU コアと 64 GB RAM を割り当てることを推奨します。

## ストレージ容量

### FE ストレージ

FE ノードは、StarRocks のメタデータのみをそのストレージに保持するため、ほとんどのシナリオでは各 FE ノードには 100 GB の HDD ストレージが十分です。

### BE ストレージ

#### BE の初期ストレージスペースの見積もり

StarRocks クラスタが必要とする総ストレージスペースは、原データサイズ、データのレプリカ数、および使用するデータ圧縮アルゴリズムの圧縮率の影響を同時に受けます。

以下の式を使用して、すべての BE ノードに必要な総ストレージスペースを見積もることができます:

```Plain
総 BE ストレージスペース = 原データサイズ * レプリカ数/圧縮率

原データサイズ = 1行のすべてのフィールドが占めるスペースの合計 * 行数
```

StarRocks では、テーブルのデータはまず複数のパーティションに分割され、それから複数のタブレットに分割されます。タブレットは、StarRocks におけるデータ管理の基本的な論理単位です。高いデータ信頼性を確保するために、各タブレットの複数のレプリカを維持し、それらを異なる BE に格納することができます。デフォルトでは、StarRocks は3つのレプリカを保持します。

現在、StarRocks は4種類のデータ圧縮アルゴリズムをサポートしており、それらは圧縮率が高い順に、zlib、Zstandard（または zstd）、LZ4、および Snappy です。これらは3:1 から 5:1 の圧縮率を提供することができます。

総ストレージスペースを決定した後は、クラスタの BE ノード数でそれを単純に分割することで、1つの BE ノード当たりの平均ストレージスペースを見積もることができます。

#### 進行中の増加に追加ストレージを追加

原データが増加するにつれて BE ストレージスペースが不足した場合は、クラスタを垂直または水平にスケーリングしたり、単純にクラウドストレージをスケーリングアップすることで補充することができます。

- StarRocks クラスタに新しい BE ノードを追加

  新しい BE ノードを StarRocks クラスタに追加して、データを均等に再分散することができます。詳細な手順については、[StarRocks クラスタのスケーリング - BE をスケールアウト](../administration/Scale_up_down.md)を参照してください。

  新しい BE ノードを追加した後、StarRocks はすべての BE ノード間でデータを自動的に再バランスします。この自動バランシングはすべてのテーブルタイプでサポートされています。

- BE ノードに追加のストレージボリュームを追加

  既存の BE ノードに追加のストレージボリュームを追加することもできます。詳細な手順については、[StarRocks クラスタのスケーリング - BE をスケールアップ](../administration/Scale_up_down.md)を参照してください。

  追加のストレージボリュームを追加した後、StarRocks はすべてのテーブルでデータを再バランスします。

- クラウドストレージを追加

  StarRocks クラスタがクラウド上に展開されている場合は、クラウドプロバイダに連絡してクラウドストレージを必要に応じてスケーリングアップすることができます。詳細な手順については、クラウドプロバイダにお問い合わせください。