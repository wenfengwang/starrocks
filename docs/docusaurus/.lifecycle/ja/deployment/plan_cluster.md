---
displayed_sidebar: "Japanese"
---

# StarRocksクラスターの計画

このトピックでは、ノード数、CPUコア数、メモリサイズ、およびストレージサイズの観点から、本番環境のStarRocksクラスターのリソースを計画する方法について説明します。

## ノード数

StarRocksは主にFEノードとBEノードの2種類のコンポーネントで構成されています。各ノードは物理マシンまたは仮想マシンに別々にデプロイする必要があります。

### FEノード数

FEノードは主にメタデータ管理、クライアント接続管理、クエリプランニング、およびクエリスケジューリングを担当しています。

本番環境では、StarRocksクラスターには少なくとも**3つ**のフォロワーFEノードをデプロイすることを推奨します。これにより、単一障害点（SPOF）を防ぎます。

StarRocksはメタデータをFEノード全体で管理するためにBDB JEプロトコルを使用します。StarRocksはすべてのフォロワーFEノードからリーダーFEノードを選出します。リーダーFEノードだけがメタデータを書き込むことができます。他のフォロワーFEノードは、リーダーFEノードからのログに基づいてメタデータを更新します。リーダーFEノードが失敗するたびに、StarRocksはフォロワーFEノードが半分以上生きている限り、新しいリーダーFEノードを再選出します。

アプリケーションが高度に同時実行クエリリクエストを生成する場合は、クラスターにObserver FEノードを追加することができます。Observer FEノードはクエリリクエストの処理のみを行い、リーダーFEノードの選出には参加しません。

### BEノード数

BEノードはデータストレージとSQL実行を担当しています。

本番環境では、StarRocksクラスターには少なくとも**3つ**のBEノードをデプロイすることを推奨します。これにより、高いデータ信頼性とサービス可用性が確保されます。少なくとも3つのBEノードがデプロイされ、StarRocksクラスターに追加されると、BEの高可用性クラスターが自動的に形成されます。1つのBEノードの故障はBEサービス全体の可用性に影響しません。

StarRocksクラスターを使用して高度に同時実行クエリを処理できるように、BEノードの数を増やすことができます。

### CNノード数

CNノードはStarRocksのオプションのコンポーネントであり、SQL実行のみを担当しています。

CNノードの数を増やすことで、StarRocksクラスター内でデータ分布を変更することなく、計算リソースを弾力的にスケールアップすることができます。

## CPUおよびメモリ

通常、FEサービスは多くのCPUおよびメモリリソースを消費しません。各FEノードに8 CPUコアと16 GB RAMを割り当てることを推奨します。

FEサービスとは異なり、BEサービスは、アプリケーションが大規模なデータセットで高度に同時実行または複雑なクエリを処理する場合、著しくCPUおよびメモリを消費することがあります。そのため、各BEノードには16 CPUコアと64 GB RAMを割り当てることを推奨します。

## ストレージ容量

### FEストレージ

FEノードは、ストレージ内にStarRocksのメタデータのみを維持するため、ほとんどのシナリオで各FEノードには100 GBのHDDストレージが十分です。

### BEストレージ

#### BEの初期ストレージスペースの見積り

StarRocksクラスターで必要な総ストレージスペースは、生データのサイズ、データのレプリカ数、および使用するデータ圧縮アルゴリズムの圧縮比に同時に影響を受けます。

以下の式で、すべてのBEノードに必要な合計ストレージスペースを見積もることができます：

```Plain
合計BEストレージスペース = 生データサイズ * レプリカ数/圧縮比

生データサイズ = 行のすべてのフィールドによって占められるスペースの合計 * 行数
```

StarRocksでは、表のデータはまず複数のパーティションに分割され、次に複数のタブレットに分割されます。タブレットはStarRocksでデータ管理の基本的な論理単位です。高いデータ信頼性を確保するために、各タブレットの複数のレプリカを維持し、それらを異なるBEに格納することができます。デフォルトでは、StarRocksは3つのレプリカを維持します。

現在、StarRocksは4つのデータ圧縮アルゴリズムをサポートしており、それらは圧縮比の高い順に以下のようにリストされています：zlib、Zstandard（またはzstd）、LZ4、およびSnappy。これらは3:1から5:1の圧縮比を提供できます。

合計ストレージスペースを決定した後、この数値をクラスター内のBEノード数で単純に割ることで、1つのBEノード当たりの平均ストレージスペースを見積ることができます。

#### 進行中に追加のストレージを含める

生データが増えてBEストレージスペースが不足する場合は、クラスターを垂直または水平にスケーリングしたり、単純にクラウドストレージをスケーリングアップすることで補充することができます。

- StarRocksクラスターに新しいBEノードを追加

  StarRocksクラスターに新しいBEノードを追加して、データをより多くのノードに均等に再配分できます。詳細な手順については、[StarRocksクラスターのスケーリング - BEをスケールアウト](../administration/Scale_up_down.md)を参照してください。

  新しいBEノードが追加されると、StarRocksは全てのBEノード間でデータを自動的に再バランスします。この自動バランシングは全てのテーブルタイプでサポートされています。

- 既存のBEノードに追加のストレージボリュームを追加

  既存のBEノードに追加のストレージボリュームを追加することもできます。詳細な手順については、[StarRocksクラスターのスケーリング - BEをスケールアップ](../administration/Scale_up_down.md)を参照してください。

  追加のストレージボリュームが追加されると、StarRocksは全てのテーブルでデータを再バランスします。

- クラウドストレージを追加

  クラウド上にStarRocksクラスターを展開している場合は、クラウドストレージを必要に応じてスケーリングアップすることができます。詳細な手順については、クラウドプロバイダに連絡してください。
