---
displayed_sidebar: "Japanese"
---

# ユーザー定義変数

このトピックでは、ユーザー定義変数の宣言と使用方法について説明します。

StarRocks 2.5 以降のバージョンでは、ユーザー定義変数がサポートされています。これらの変数は、後のSQLステートメントで参照される特定の値を格納するために使用され、SQLステートメントの記述を簡素化し、重複した計算を回避します。

## 使用上の注意

- ユーザー定義変数はセッション内に存在する、ユーザーによって作成される変数です。これは、他のユーザーが宣言したユーザー定義変数に他者がアクセスできないことを意味し、セッションが閉じられるとこれらの変数は失効します。
- StarRocks では、SHOWステートメントを使用して既存のユーザー定義変数を表示することはサポートされていません。
- 次の種類の値は、ユーザー定義変数として宣言することができません: BITMAP、HLL、PERCENTILE、ARRAY。 JSONタイプのユーザー定義変数は、ストレージのためにSTRINGタイプに変換されます。

## ユーザー定義変数の宣言

### 構文

```Plain
SET @var_name = expr [, ...];
```

> **注意**
>
> - すべての変数は、単一のアットマーク（@）が先行しなければなりません。
> - 複数の変数を同じSETステートメントで宣言することができ、コンマ（`,`）で区切る必要があります。
> - 同じ変数を複数回宣言することができます。新しく宣言した値が元の値を上書きします。
> - 未宣言の変数が使用される場合、変数の値はデフォルトで`NULL`であり、NULLの型はSTRINGです。

### パラメータ

| **パラメータ** | **必須** | **説明**                                                                                       |
| ------------- | -------- | --------------------------------------------------------------------------------------------- |
| var_name      | はい     | ユーザー定義変数の名前。命名規則は以下の通りです:<ul><li>名前には、文字、数字（0-9）、アンダースコア（\_）を含めることができます。 </li><li>名前は64文字を超えることはできません。</li></ul>ユーザー定義変数として文字列を宣言することができます。例: @'my-var'、@"my-var"、@\`my-var\`。 STRINGタイプのユーザー定義変数には、文字、数字、アンダースコア (_) 以外の文字を含めることができます。 |
| expr          | はい     | ユーザー定義変数の値。このパラメータには、数値（たとえば43）や複雑な式（SELECTステートメントによって返される値など）を指定できます。変数のデータ型は、式によって返される結果のデータ型と同じです。 |

### 例

例1: 数値をユーザー定義変数として宣言する。

```SQL
SET @var = 43;
```

例2: SELECTクエリによって返される値をユーザー定義変数として宣言する。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

例3: 同じSETステートメント内で複数のユーザー定義変数を宣言する。

```SQL
SET @v1=1, @v2=2;
```

## SQLでのユーザー定義変数の使用

- SQLステートメントの記述を簡素化します。たとえば、次のSELECTステートメントを実行すると、StarRocksは`@var`を`1`と解釈します。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 重複した計算を回避します。たとえば、次のSELECTステートメントを実行すると、StarRocksは`@var`を`select sum(c1) from tbl`の結果と解釈します。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```