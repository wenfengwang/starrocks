---
displayed_sidebar: "Japanese"
---

# ユーザー定義変数

このトピックでは、ユーザー定義変数の宣言と使用方法について説明します。

StarRocks 2.5以降のバージョンでは、ユーザー定義変数がサポートされています。これらの変数は、後のSQLステートメントで参照される特定の値を格納するために使用され、これによりSQLステートメントの記述が簡素化され、重複した計算を避けることができます。

## 使用上の注意

- ユーザー定義変数はユーザーによって作成され、セッションに存在する変数です。これは他のユーザーが宣言したユーザー定義変数にアクセスできないことを意味し、セッションが終了するとこれらの変数は無効になります。
- StarRocksは、既に存在するユーザー定義変数を表示するためにSHOWステートメントを使用することをサポートしていません。
- 次の種類の値はユーザー定義変数として宣言することができません: BITMAP、HLL、PERCENTILE、ARRAY。JSONタイプのユーザー定義変数は、ストレージのためにSTRINGタイプに変換されます。

## ユーザー定義変数の宣言

### 構文

```Plain
SET @var_name = expr [, ...];
```

> **注意**
>
> - すべての変数は単一の「@」記号で始まる必要があります。
> - 複数の変数を同じSETステートメントで宣言することができ、コンマ（`,`）で区切る必要があります。
> - 同じ変数を複数回宣言することができます。新しく宣言された値が元の値を上書きします。
> - 宣言されていない変数を使用する場合、変数の値はデフォルトで`NULL`となり、NULLのタイプはSTRINGです。

### パラメータ

| **パラメータ** | **必須** | **説明**                                              |
| ------------- | ------------ | ------------------------------------------------------------ |
| var_name      | はい          | ユーザー定義変数の名前。以下の命名規則に従います：<ul><li>名前には文字、数字（0-9）、アンダースコア（_）を含めることができます。</li><li>名前は64文字を超えることはできません。</li></ul>例えば、@'my-var'、@"my-var"、および@\`my-var\`のように文字列をユーザー定義変数として宣言できます。STRING型のユーザー定義変数には、文字、数字、アンダースコア（_）以外の文字、例えばピリオド（.）などを含めることができます。 |
| expr          | はい          | ユーザー定義変数の値。このパラメータには数字（たとえば43）または複雑な式（SELECTステートメントによって返される値など）を指定できます。変数のデータタイプは、式によって返される結果のデータタイプと同じです。 |

### 例

例1: 数値をユーザー定義変数として宣言。

```SQL
SET @var = 43;
```

例2: SELECTクエリによって返される値をユーザー定義変数として宣言。

```SQL
SET @var = (SELECT SUM(v1) FROM test);
```

例3: 同じSETステートメントで複数のユーザー定義変数を宣言。

```SQL
SET @v1=1, @v2=2;
```

## SQLでのユーザー定義変数の使用

- SQLステートメントの記述を簡素化します。たとえば、次のSELECTステートメントを実行すると、StarRocksは`@var`を`1`と解釈します。

  ```Plain
  SET @var = 1;
  SELECT @var, v1 from test;
  ```

- 重複した計算を避けます。たとえば、次のSELECTステートメントを実行すると、StarRocksは`@var`を`select sum(c1) from tbl`コマンドの結果と解釈します。

  ```Plain
  SET @var = (select sum(c1) from tbl);
  SELECT @var, v1 from test;
  ```