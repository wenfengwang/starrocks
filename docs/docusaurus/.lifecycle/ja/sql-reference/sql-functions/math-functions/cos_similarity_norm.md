---
displayed_sidebar: "Japanese"
---

# cos_similarity_norm

## 説明

2つの正規化されたベクトルの類似性を計算し、それらの間の角度の余弦を計算することによって測定します。角度はベクトルの方向によって形成されますが、それらの大きさの違いは無視されます。この関数は、入力ベクトルが正規化されていることを前提としています。余弦類似度を計算する前にベクトルを正規化する必要がある場合は、[cosine_similarity](./cos_similarity.md)を使用してください。

類似性は-1から1の間です。ベクトル間の角度が小さいほど、余弦類似度が大きくなります。

- 2つのベクトルが同じ方向を向いている場合、0度の角度を持ち、余弦類似度は1になります。
- 直行するベクトルは90度の角度を持ち、余弦類似度は0になります。
- 反対方向を向くベクトルは180度の角度を持ち、余弦類似度は-1になります。

## 構文

```Haskell
cosine_similarity_norm(a, b)
```

## パラメーター

`a`と`b`は比較するベクトルです。それらは同じ次元を持っている必要があります。対応するデータ型は`Array<float>`です。2つの配列は同じ数の要素を持つ必要があります。そうでない場合、エラーが返されます。

## 戻り値

範囲[-1、1]内のFLOAT値を返します。入力パラメーターがnullまたは無効の場合、エラーが報告されます。

## 例

1. ベクトルを格納するテーブルを作成し、このテーブルにデータを挿入します。

    ```SQL
    CREATE TABLE t1_similarity 
    (id int, data array<float>)
    DISTRIBUTED BY HASH(id);

    INSERT INTO t1_similarity VALUES
    (1, array<float>[0.1, 0.2, 0.3]), 
    (2, array<float>[0.2, 0.1, 0.3]), 
    (3, array<float>[0.3, 0.2, 0.1]);
    ```

2. `data`列内の各行の`data`配列と配列`[0.1, 0.2, 0.3]`との類似性を計算し、結果を降順でリストします。

    ```Plain
    SELECT id, data, cosine_similarity_norm([0.1, 0.2, 0.3], data) as dist
    FROM t1_similarity 
    ORDER BY dist DESC;

    +------+---------------+------------+
    | id   | data          | dist       |
    +------+---------------+------------+
    |    1 | [0.1,0.2,0.3] | 0.14000002 |
    |    2 | [0.2,0.1,0.3] | 0.13000001 |
    |    3 | [0.3,0.2,0.1] | 0.10000001 |
    +------+---------------+------------+
    ```