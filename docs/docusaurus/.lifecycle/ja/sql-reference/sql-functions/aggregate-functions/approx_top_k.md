---
displayed_sidebar: "Japanese"
---

# approx_top_k（約数上位k個）

## 説明

`expr`に沿って最も頻繁に発生する上位`k`個の項目値とその近似数を返します。

## 構文

```Haskell
APPROX_TOP_K(<expr> [ , <k> [ , <counter_num> ] ] )
```

## 引数

* `expr`: STRING、BOOLEAN、DATE、DATETIME、または数値型の式です。
* `k`: 0より大きいオプションのINTEGERリテラル。`k`が指定されていない場合、デフォルト値は`5`になります。
    * 最大値は`100000`です。
* `counter_num`: `k`以上のオプションのINTEGERリテラル。`counter_num`が大きいほど結果はより正確になります。しかし、これにはCPUおよびメモリコストが増加します。
    * 最大値は`100000`です。
    * `counter_num`が指定されていない場合、デフォルト値は`max(min(2 * k, 100), 100000)`になります。

## 戻り値

結果はSTRUCT型の配列として返されます。各STRUCTには、値（元の入力型とその項目）のための`item`フィールドと近似発生回数のための`count`フィールド（BIGINT型）が含まれます。配列は`count`を降順でソートされます。

この集約関数は、式`expr`に沿って最も頻繁に発生する上位`k`個の項目の値とその近似数を返します。各数の誤差は、`2.0 * numRows / counter_num`まで、ここで`numRows`は総行数です。`counter_num`の値が大きいほど、より高い正確さが提供されますが、メモリの使用量が増加します。`counter_num`よりも少ない異なる項目を持つ式は、正確な項目数を生成します。結果には`NULL`値が独自の項目として含まれます。

## 例

```plain text
MySQL > SELECT APPROX_TOP_K(L_LINESTATUS) FROM lineitem;
+-------------------------------------------------------------+
| approx_top_k(L_LINESTATUS)                                  |
+-------------------------------------------------------------+
| [{"item":"O","count":3004998},{"item":"F","count":2996217}] |
+-------------------------------------------------------------+

MySQL > SELECT APPROX_TOP_K(L_LINENUMBER) FROM lineitem GROUP BY L_RETURNFLAG
+-------------------------------------------------------------------------------------------------------------------------------------+
| approx_top_k(L_LINENUMBER)                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------+
| [{"item":1,"count":761151},{"item":2,"count":652280},{"item":3,"count":543265},{"item":4,"count":434834},{"item":5,"count":326135}] |
| [{"item":1,"count":368853},{"item":2,"count":316830},{"item":3,"count":263950},{"item":4,"count":211270},{"item":5,"count":158495}] |
| [{"item":1,"count":369996},{"item":2,"count":316718},{"item":3,"count":264179},{"item":4,"count":210911},{"item":5,"count":158657}] |
+-------------------------------------------------------------------------------------------------------------------------------------+
```

## キーワード

APPROX_TOP_K