---
displayed_sidebar: "Japanese"
---

# approx_top_k

## 説明

与えられた `expr` の中で最も頻繁に発生する上位 `k` 個のアイテム値とその概算カウントを返します。

## 構文

```Haskell
APPROX_TOP_K(<expr> [ , <k> [ , <counter_num> ] ] )
```

## 引数

* `expr`: STRING、BOOLEAN、DATE、DATETIME、または数値型の式。
* `k`: 任意の 0 より大きな INTEGER リテラル。`k` が指定されていない場合、デフォルトは `5` です。
    * 最大値は `100000`
* `counter_num`: `k` 以上の任意の INTEGER リテラル。`counter_num` が大きいほど結果はより正確になりますが、CPU およびメモリのコストも増加します。
    * 最大値は `100000`
    * `counter_num` が指定されていない場合、デフォルトは `max(min(2 * k, 100), 100000)` です。

## 戻り値

結果は、それぞれの STRUCT に `item` フィールド（元の入力型を持つ）と `count` フィールド（BIGINT 型）を含む ARRAY 型として返されます。配列は `count` の降順でソートされます。

この集約関数は、式 `expr` で最も頻繁に発生する上位 `k` 個のアイテム値とその概算カウントを返します。各カウントの誤差は `2.0 * numRows / counter_num` までとなります。ここで `numRows` は行の合計数です。`counter_num` の値が大きいほど正確性が向上しますが、メモリの使用量が増加します。`counter_num` が `counter_num` よりも少ない異なるアイテムを持つ式では、正確なアイテムのカウントが得られます。結果には `NULL` 値も結果内の独自のアイテムとして含まれます。

## 例

```plain text
MySQL > SELECT APPROX_TOP_K(L_LINESTATUS) FROM lineitem;
+-------------------------------------------------------------+
| approx_top_k(L_LINESTATUS)                                  |
+-------------------------------------------------------------+
| [{"item":"O","count":3004998},{"item":"F","count":2996217}] |
+-------------------------------------------------------------+

MySQL > SELECT APPROX_TOP_K(L_LINENUMBER) FROM lineitem GROUP BY L_RETURNFLAG
+-------------------------------------------------------------------------------------------------------------------------------------+
| approx_top_k(L_LINENUMBER)                                                                                                          |
+-------------------------------------------------------------------------------------------------------------------------------------+
| [{"item":1,"count":761151},{"item":2,"count":652280},{"item":3,"count":543265},{"item":4,"count":434834},{"item":5,"count":326135}] |
| [{"item":1,"count":368853},{"item":2,"count":316830},{"item":3,"count":263950},{"item":4,"count":211270},{"item":5,"count":158495}] |
| [{"item":1,"count":369996},{"item":2,"count":316718},{"item":3,"count":264179},{"item":4,"count":210911},{"item":5,"count":158657}] |
+-------------------------------------------------------------------------------------------------------------------------------------+
```

## キーワード

APPROX_TOP_K