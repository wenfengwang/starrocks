---
displayed_sidebar: "Japanese"
---

# array_sortby

## 説明

別の配列やラムダ式から作成された配列の要素に基づいて配列の要素を昇順で並べ替えます。詳細については、[Lambda式](../Lambda_expression.md)を参照してください。この機能は v2.5 からサポートされています。

2つの配列の要素は、キーと値のペアのようになっています。たとえば、b = [7,5,6] は a = [3,1,4] のソートキーです。キーと値のペアの関係に従い、2つの配列の要素は以下のような一対一のマッピングを持ちます。

| **配列** | **要素1** | **要素2** | **要素3** |
| ------ | -------- | -------- | -------- |
| a      | 3        | 1        | 4        |
| b      | 7        | 5        | 6        |

配列 `b` を昇順でソートすると、[5,6,7] になります。これに応じて配列 `a` は [1,4,3] になります。

| **配列** | **要素1** | **要素2** | **要素3** |
| ------ | -------- | -------- | -------- |
| a      | 1        | 4        | 3        |
| b      | 5        | 6        | 7        |

## 構文

```Haskell
array_sortby(array0, array1)
array_sortby(<lambda function>, array0 [, array1...])
```

- `array_sortby(array0, array1)`

   `array1` の昇順にしたがって `array0` を並べ替えます。

- `array_sortby(<lambda function>, array0 [, array1...])`

   ラムダ式から返された配列に従って `array0` を並べ替えます。

## パラメータ

- `array0`: 並べ替えたい配列です。配列、配列式、または `null` である必要があります。配列の要素は並べ替え可能でなければなりません。
- `array1`: `array0` を並べ替えるために使用される並べ替え配列です。配列、配列式、または `null` である必要があります。
- `lambda function`: 並べ替え配列を生成するために使用されるラムダ式です。

## 戻り値

配列を返します。

## 使用上の注意

- この機能は配列の要素を昇順でしか並べ替えることができません。
- `NULL` の値は返される配列の先頭に配置されます。
- 配列の要素を降順で並べ替えたい場合は、[reverse](./reverse.md) 関数を使用してください。
- 並べ替え配列 (`array1`) が null の場合、`array0` のデータは変更されません。
- 返される配列の要素は `array0` の要素と同じデータ型を持ちます。null の値の属性も同じです。
- 2つの配列は同じ数の要素を持っていなければなりません。そうでない場合、エラーが返されます。

## 例

この機能の使用方法を示すために、次の表を使用します。

```SQL
CREATE TABLE `test_array` (
  `c1` int(11) NULL COMMENT "",
  `c2` ARRAY<int(11)> NULL COMMENT "",
  `c3` ARRAY<int(11)> NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`c1`)
COMMENT "OLAP"
DISTRIBUTED BY HASH(`c1`)
PROPERTIES (
"replication_num" = "3",
"storage_format" = "DEFAULT",
"enable_persistent_index" = "false",
"compression" = "LZ4"
);

insert into test_array values
(1,[4,3,5],[82,1,4]),
(2,null,[23]),
(3,[4,2],[6,5]),
(4,null,null),
(5,[],[]),
(6,NULL,[]),
(7,[],null),
(8,[null,null],[3,6]),
(9,[432,21,23],[5,4,null]);

select * from test_array order by c1;
+------+-------------+------------+
| c1   | c2          | c3         |
+------+-------------+------------+
|    1 | [4,3,5]     | [82,1,4]   |
|    2 | NULL        | [23]       |
|    3 | [4,2]       | [6,5]      |
|    4 | NULL        | NULL       |
|    5 | []          | []         |
|    6 | NULL        | []         |
|    7 | []          | NULL       |
|    8 | [null,null] | [3,6]      |
|    9 | [432,21,23] | [5,4,null] |
+------+-------------+------------+
9 rows in set (0.00 sec)
```

Example 1: `c3` を `c2` に従って並べ替えます。この例は比較のために array_sort() の結果も提供します。

```Plaintext
select c1, c3, c2, array_sort(c2), array_sortby(c3,c2)
from test_array order by c1;
+------+------------+-------------+----------------+----------------------+
| c1   | c3         | c2          | array_sort(c2) | array_sortby(c3, c2) |
+------+------------+-------------+----------------+----------------------+
|    1 | [82,1,4]   | [4,3,5]     | [3,4,5]        | [1,82,4]             |
|    2 | [23]       | NULL        | NULL           | [23]                 |
|    3 | [6,5]      | [4,2]       | [2,4]          | [5,6]                |
|    4 | NULL       | NULL        | NULL           | NULL                 |
|    5 | []         | []          | []             | []                   |
|    6 | []         | NULL        | NULL           | []                   |
|    7 | NULL       | []          | []             | NULL                 |
|    8 | [3,6]      | [null,null] | [null,null]    | [3,6]                |
|    9 | [5,4,null] | [432,21,23] | [21,23,432]    | [4,null,5]           |
+------+------------+-------------+----------------+----------------------+
```

Example 2: ラムダ式から生成された `c2` に基づいて配列 `c3` を並べ替えます。この例は Example 1 と同等です。また、比較のために array_sort() の結果も提供します。

```Plaintext
select
    c1,
    c3,
    c2,
    array_sort(c2) as sorted_c2_asc,
    array_sortby((x,y) -> y, c3, c2) as sorted_c3_by_c2
from test_array order by c1;
+------+------------+-------------+---------------+-----------------+
| c1   | c3         | c2          | sorted_c2_asc | sorted_c3_by_c2 |
+------+------------+-------------+---------------+-----------------+
|    1 | [82,1,4]   | [4,3,5]     | [3,4,5]       | [82,1,4]        |
|    2 | [23]       | NULL        | NULL          | [23]            |
|    3 | [6,5]      | [4,2]       | [2,4]         | [5,6]           |
|    4 | NULL       | NULL        | NULL          | NULL            |
|    5 | []         | []          | []            | []              |
|    6 | []         | NULL        | NULL          | []              |
|    7 | NULL       | []          | []            | NULL            |
|    8 | [3,6]      | [null,null] | [null,null]   | [3,6]           |
|    9 | [5,4,null] | [432,21,23] | [21,23,432]   | [4,null,5]      |
+------+------------+-------------+---------------+-----------------+
```

Example 3: `c2+c3` の昇順に基づいて配列 `c3` を並べ替えます。

```Plain
select
    c3,
    c2,
    array_map((x,y)-> x+y,c3,c2) as sum,
    array_sort(array_map((x,y)-> x+y, c3, c2)) as sorted_sum,
    array_sortby((x,y) -> x+y, c3, c2) as sorted_c3_by_sum
from test_array where c1=1;
+----------+---------+----------+------------+------------------+
| c3       | c2      | sum      | sorted_sum | sorted_c3_by_sum |
+----------+---------+----------+------------+------------------+
| [82,1,4] | [4,3,5] | [86,4,9] | [4,9,86]   | [1,4,82]         |
+----------+---------+----------+------------+------------------+
```

## 参照

[array_sort](array_sort.md)