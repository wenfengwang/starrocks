これらのクエリは、SQLクライアントで実行できます。

#### ニューヨーク市では1時間あたりに何回の交通事故が発生していますか？

```sql
SELECT COUNT(*),
       date_trunc("hour", crashdata.CRASH_DATE) AS 時間
FROM crashdata
GROUP BY 時間
ORDER BY 時間 ASC
LIMIT 200;
```

ここには出力の一部があります。これは月曜日と火曜日である1月6日と7日についてより詳しく見ています。これは祝日ではない週の平日の朝を示すものとして、元旦を見ることは通常のラッシュアワートラフィックの朝を表していない可能性があります。

```plaintext
|       14 | 2014-01-06 06:00:00 |
|       16 | 2014-01-06 07:00:00 |
# highlight-start
|       43 | 2014-01-06 08:00:00 |
|       44 | 2014-01-06 09:00:00 |
|       21 | 2014-01-06 10:00:00 |
# highlight-end
|       28 | 2014-01-06 11:00:00 |
|       34 | 2014-01-06 12:00:00 |
|       31 | 2014-01-06 13:00:00 |
|       35 | 2014-01-06 14:00:00 |
|       36 | 2014-01-06 15:00:00 |
|       33 | 2014-01-06 16:00:00 |
|       40 | 2014-01-06 17:00:00 |
|       35 | 2014-01-06 18:00:00 |
|       23 | 2014-01-06 19:00:00 |
|       16 | 2014-01-06 20:00:00 |
|       12 | 2014-01-06 21:00:00 |
|       17 | 2014-01-06 22:00:00 |
|       14 | 2014-01-06 23:00:00 |
|       10 | 2014-01-07 00:00:00 |
|        4 | 2014-01-07 01:00:00 |
|        1 | 2014-01-07 02:00:00 |
|        3 | 2014-01-07 03:00:00 |
|        2 | 2014-01-07 04:00:00 |
|        6 | 2014-01-07 06:00:00 |
|       16 | 2014-01-07 07:00:00 |
# highlight-start
|       41 | 2014-01-07 08:00:00 |
|       37 | 2014-01-07 09:00:00 |
|       33 | 2014-01-07 10:00:00 |
# highlight-end
```

月曜日または火曜日の朝のラッシュアワートラフィック時に約40件の事故が発生し、17:00時にも同様の件数があります。

#### ニューヨーク市の平均気温は？

```sql
SELECT avg(HourlyDryBulbTemperature),
       date_trunc("hour", weatherdata.DATE) AS 時間
FROM weatherdata
GROUP BY 時間
ORDER BY 時間 ASC
LIMIT 100;
```

出力：

注意：これは2014年のデータであり、最近のニューヨーク市はこれほど寒くはありません。

```plaintext
+-------------------------------+---------------------+
| avg(HourlyDryBulbTemperature) | Time                |
+-------------------------------+---------------------+
|                            25 | 2014-01-01 00:00:00 |
|                            25 | 2014-01-01 01:00:00 |
|                            24 | 2014-01-01 02:00:00 |
|                            24 | 2014-01-01 03:00:00 |
|                            24 | 2014-01-01 04:00:00 |
|                            24 | 2014-01-01 05:00:00 |
|                            25 | 2014-01-01 06:00:00 |
|                            26 | 2014-01-01 07:00:00 |
```

#### ニューヨーク市で視界が悪い場合に運転しても安全でしょうか？

視界が悪い（0から1.0マイル）状態での交通事故の数を見てみましょう。この質問に答えるために、DATETIME列を使用して2つのテーブルをJOINします。

```sql
SELECT COUNT(DISTINCT c.COLLISION_ID) AS 事故数,
       truncate(avg(w.HourlyDryBulbTemperature), 1) AS 温度_F,
       truncate(avg(w.HourlyVisibility), 2) AS 視界,
       max(w.HourlyPrecipitation) AS 降水量,
       date_format((date_trunc("hour", c.CRASH_DATE)), '%Y年%m月%d日 %H:%i') AS 時間
FROM crashdata c
LEFT JOIN weatherdata w
ON date_trunc("hour", c.CRASH_DATE)=date_trunc("hour", w.DATE)
WHERE w.HourlyVisibility BETWEEN 0.0 AND 1.0
GROUP BY 時間
ORDER BY 事故数 DESC
LIMIT 100;
```

視界が悪い条件下で1時間あたりの最も多い事故数は129件です。考慮すべき点がいくつかあります：

- 2014年2月3日は月曜日でした
- 午前8時はラッシュアワーです
- 雨が降っていました（その1時間の降水量は0.12インチでした）
- 気温は32度Fです（水の凝固点）
- 視界は0.25マイルと悪く、通常のニューヨーク市の視界は10マイルです

```plaintext
+---------+--------+------------+---------------+-------------------+
| 事故数 | 温度_F | 視界 | 降水量 | 時間 |
+---------+--------+------------+---------------+-------------------+
|     129 |     32 |       0.25 | 0.12          | 2014年02月03日 08:00 |
|     114 |     32 |       0.25 | 0.12          | 2014年02月03日 09:00 |
|     104 |     23 |       0.33 | 0.03          | 2015年01月09日 08:00 |
|      96 |   26.3 |       0.33 | 0.07          | 2015年03月01日 14:00 |
|      95 |     26 |       0.37 | 0.12          | 2015年03月01日 15:00 |
|      93 |     35 |       0.75 | 0.09          | 2015年01月18日 09:00 |
|      92 |     31 |       0.25 | 0.12          | 2014年02月03日 10:00 |
|      87 |   26.8 |        0.5 | 0.09          | 2015年03月01日 16:00 |
|      85 |     55 |       0.75 | 0.20          | 2015年12月23日 17:00 |
|      85 |     20 |       0.62 | 0.01          | 2015年01月06日 11:00 |
|      83 |   19.6 |       0.41 | 0.04          | 2015年03月05日 13:00 |
|      80 |     20 |       0.37 | 0.02          | 2015年01月06日 10:00 |
|      76 |   26.5 |       0.25 | 0.06          | 2015年03月05日 09:00 |
|      71 |     26 |       0.25 | 0.09          | 2015年03月05日 10:00 |
|      71 |   24.2 |       0.25 | 0.04          | 2015年03月05日 11:00 |
```

#### 氷の状態での運転はどうでしょうか？

水蒸気は40度Fで氷に昇華することができます。このクエリは0から40度Fの温度を見ています。

```sql
SELECT COUNT(DISTINCT c.COLLISION_ID) AS 事故数,
       truncate(avg(w.HourlyDryBulbTemperature), 1) AS 温度_F,
       truncate(avg(w.HourlyVisibility), 2) AS 視界,
       max(w.HourlyPrecipitation) AS 降水量,
       date_format((date_trunc("hour", c.CRASH_DATE)), '%Y年%m月%d日 %H:%i') AS 時間
FROM crashdata c
LEFT JOIN weatherdata w
ON date_trunc("hour", c.CRASH_DATE)=date_trunc("hour", w.DATE)
WHERE w.HourlyDryBulbTemperature BETWEEN 0.0 AND 40.5 
GROUP BY 時間
ORDER BY 事故数 DESC
LIMIT 100;
```
凍結気温の結果は少し驚きでした。寒い1月の日曜日の朝に都市での交通量がそれほど多くないことを予想していませんでした。 [weather.com](https://weather.com/storms/winter/news/northeast-storm-rain-snow-wind) をチェックしてみると、その日は大きな嵐で多くのクラッシュがあったことがわかりました。データでも同様のことが見られます。

```plaintext
+---------+--------+------------+---------------+-------------------+
| クラッシュ | Temp_F | 視界 | 降水量 | 時間              |
+---------+--------+------------+---------------+-------------------+
|     192 |     34 |        1.5 | 0.09          | 18 Jan 2015 08:00 |
|     170 |     21 |       NULL |               | 21 Jan 2014 10:00 |
|     145 |     19 |       NULL |               | 21 Jan 2014 11:00 |
|     138 |   33.5 |          5 | 0.02          | 18 Jan 2015 07:00 |
|     137 |     21 |       NULL |               | 21 Jan 2014 09:00 |
|     129 |     32 |       0.25 | 0.12          | 03 Feb 2014 08:00 |
|     114 |     32 |       0.25 | 0.12          | 03 Feb 2014 09:00 |
|     104 |     23 |        0.7 | 0.04          | 09 Jan 2015 08:00 |
|      98 |     16 |          8 | 0.00          | 06 Mar 2015 08:00 |
|      96 |   26.3 |       0.33 | 0.07          | 01 Mar 2015 14:00 |
```

注意して運転してください！