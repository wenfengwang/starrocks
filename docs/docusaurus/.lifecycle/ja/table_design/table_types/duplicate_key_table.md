---
displayed_sidebar: "Japanese"
---

# 重複キー テーブル

重複キーテーブルはStarRocksのデフォルトモデルです。テーブルを作成する際にモデルを指定しなかった場合、自動的に重複キーテーブルが作成されます。

重複キーテーブルを作成すると、そのテーブルにソートキーを定義することができます。フィルタ条件にソートキーカラムが含まれている場合、StarRocksはクエリの高速化のためにテーブルからデータを迅速にフィルタリングできます。重複キーテーブルでは、新しいデータをテーブルに追加することができますが、既存のデータを修正することはできません。

## シナリオ

重複キーテーブルは以下のシナリオに適しています：

- 生ログや生の操作レコードなどの生データを分析すること。
- 事前集計方法に制約されることなく、さまざまな方法でデータをクエリすること。
- ログデータや時系列データを読み込むこと。新しいデータは追加モードで書き込まれ、既存のデータは更新されません。

## テーブルの作成

特定の時間範囲でイベントデータを分析したいとします。この例では、`detail`という名前のテーブルを作成し、`event_time`と`event_type`をソートキーカラムとして定義します。

テーブルを作成するためのステートメント：

```SQL
CREATE TABLE IF NOT EXISTS detail (
    event_time DATETIME NOT NULL COMMENT "イベントの日時",
    event_type INT NOT NULL COMMENT "イベントの種類",
    user_id INT COMMENT "ユーザーID",
    device_code INT COMMENT "デバイスコード",
    channel INT COMMENT ""
)
DUPLICATE KEY(event_time, event_type)
DISTRIBUTED BY HASH(user_id);
```

> **NOTICE**
>
> - テーブルを作成する際、`DISTRIBUTED BY HASH`句を使用してバケツ列を指定する必要があります。詳細については、[バケッティング](../Data_distribution.md#design-partitioning-and-bucketing-rules)を参照してください。
> - v2.5.7以降では、StarRocksはテーブルを作成したりパーティションを追加したりする際に、バケツの数（BUCKETS）を自動的に設定することができます。バケツの数を手動で設定する必要はもはやありません。詳細については、[バケットの数を決定する](../Data_distribution.md#determine-the-number-of-buckets)を参照してください。

## 使用上の注意

- テーブルのソートキーに関する以下の点に注意してください：
  - ソートキーカラムを明示的に定義するには、`DUPLICATE KEY`キーワードを使用できます。

    > 注意：ソートキーカラムを明示的に指定しない場合、StarRocksは**最初の3つ**の列をソートキーカラムとして使用します。

  - 重複キーテーブルでは、ソートキーは一部またはすべての次元列で構成されることができます。

- ビットマップインデックスやブルームフィルターインデックスなどのインデックスをテーブル作成時に作成できます。

- 同じレコードが2つロードされた場合、重複キーテーブルは1つではなく2つのレコードとしてそれらを保持します。

## 次の手順

テーブルを作成したら、さまざまなデータ取り込み方法を使用してデータをStarRocksにロードできます。StarRocksがサポートするデータ取り込み方法についての情報については、[データロードの概要](../../loading/Loading_intro.md)を参照してください。
> 注意：重複キーテーブルを使用するテーブルにデータをロードする際、テーブルにデータを追加することしかできません。テーブル内の既存のデータを修正することはできません。