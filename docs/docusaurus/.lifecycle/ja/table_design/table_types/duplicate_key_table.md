---
displayed_sidebar: "Japanese"
---

# 重複キー テーブル

重複キー テーブルはStarRocksのデフォルトモデルです。テーブルを作成する際にモデルを指定しない場合、自動的に重複キー テーブルが作成されます。

重複キー テーブルを作成する際、そのテーブルに対してソートキーを定義することができます。もしフィルタ条件がそのソートキーを含んでいる場合、StarRocksはクエリの加速のためにテーブルからデータを高速にフィルタすることができます。重複キー テーブルは新しいデータをテーブルに追加することを可能としますが、既存のデータを修正することはできません。

## シナリオ

重複キー テーブルは以下のシナリオに適しています:

- 生データ（生ログや生の操作履歴など）の解析
- プリアグリゲーションの方法に制限されることなく、様々な方法でデータをクエリ
- ログデータや時系列データを読み込む。新しいデータは追加のみが書き込まれ、既存データは更新されません。

## テーブルを作成

特定の時間範囲内でイベントデータを解析したいとします。この例では、`detail`というテーブルを作成し、`event_time`と`event_type`をソートキーカラムとして定義します。

テーブルを作成するためのステートメント:

```SQL
CREATE TABLE IF NOT EXISTS detail (
    event_time DATETIME NOT NULL COMMENT "イベントの日時",
    event_type INT NOT NULL COMMENT "イベントのタイプ",
    user_id INT COMMENT "ユーザのID",
    device_code INT COMMENT "デバイスコード",
    channel INT COMMENT ""
)
DUPLICATE KEY(event_time, event_type)
DISTRIBUTED BY HASH(user_id);
```

> **注意**
>
> - テーブルを作成する際、`DISTRIBUTED BY HASH`句を使用してバケティングカラムを指定する必要があります。詳細は[バケティング](../Data_distribution.md#design-partitioning-and-bucketing-rules)を参照してください。
> - v2.5.7から、テーブルを作成したりパーティションを追加したりする際にバケツの数（BUCKETS）を自動的に設定することができます。手動でバケツの数を設定する必要はもはやありません。詳細は[バケツの数を決定する](../Data_distribution.md#determine-the-number-of-buckets)を参照してください。

## 使用上の注意

- テーブルのソートキーに関する以下の点に注意してください:
  - ソートキーカラムを明示的に定義するために`DUPLICATE KEY`キーワードを使用することができます。

    > 注意: デフォルトでは、ソートキーカラムが指定されていない場合、StarRocksは最初の3つのカラムをソートキーカラムとして使用します。

  - 重複キー テーブルでは、ソートキーは一部またはすべてのディメンションカラムで構成されることができます。

- BITMAPインデックスやBloomfilterインデックスなどのインデックスをテーブル作成時に作成することができます。

- 2つの同一のレコードがロードされた場合、重複キー テーブルは1つではなく2つのレコードとしてそれらを保持します。

## 次の手順

テーブルが作成されたら、StarRocksにさまざまなデータインジェクション方法を使用してデータをロードすることができます。StarRocksがサポートするデータインジェクション方法についての情報については、[データのロードの概要](../../loading/Loading_intro.md)を参照してください。
> 注意: 重複キーテーブルを使用するテーブルにデータをロードする場合、テーブルにデータを追加することしかできません。テーブル内の既存データを修正することはできません。