---
displayed_sidebar: "Japanese"
---

# ストリームロード

## 1. ストリームロードは、CSV形式のファイルの最初の数行に含まれる列名を識別したり、データの読み取り中に最初の数行をスキップしたりする機能をサポートしていますか？

ストリームロードは、CSV形式のファイルの最初の数行に含まれる列名を識別する機能をサポートしていません。ストリームロードは、最初の数行を他の行と同様に通常のデータと見なします。

v2.5およびそれ以前のバージョンでは、ストリームロードは、データの読み取り中にCSVファイルの最初の数行をスキップする機能をサポートしていませんでした。読み込みたいCSVファイルの最初の数行が列名を保持している場合は、次のいずれかの対処を行ってください。

- データをエクスポートするツールの設定を変更します。その後、列名を最初の数行に保持しないCSVファイルとしてデータを再エクスポートします。
- `sed -i '1d' filename` のようなコマンドを使用して、CSVファイルの最初の数行を削除します。
- 読み込みコマンドまたはステートメントで、`-H "where: <column_name> != '<column_name>'"` を使用して、CSVファイルの最初の数行をフィルタリングします。`<column_name>` は最初の数行に含まれる列名のいずれかです。StarRocksはまず変換してからソースデータをフィルタリングします。そのため、最初の数行の列名が対応する宛先のデータ型に変換されない場合、`NULL` 値が返されます。つまり、宛先のStarRocksテーブルには `NOT NULL` に設定された列を含めることができません。
- 読み込みコマンドまたはステートメントで、`-H "max_filter_ratio:0.01"` を追加して、1%以下の最大誤差許容値を設定し、ただし、数行のエラーを許容できるようにします。これにより、`ErrorURL` がエラー行を示す場合でも、ストリームロードジョブは成功する場合があります。`max_filter_ratio` を大きな値に設定しないでください。`max_filter_ratio` を大きな値に設定すると、重要なデータ品質の問題が見逃される可能性があります。

v3.0以降、ストリームロードは `skip_header` パラメータをサポートし、CSVファイルの最初の数行をスキップするかどうかを指定します。詳細については、[CSVパラメータ](../../sql-reference/sql-statements/data-manipulation/STREAM_LOAD.md#csv-parameters) をご参照ください。

## 2. パーティション列にロードされるデータが標準のDATE型やINT型ではない場合、例えばデータが202106.00のような形式である場合、Stream Loadを使用してロードする場合にはどのようにデータを変換すればよいですか？

StarRocksは、ロード時にデータの変換をサポートしています。詳細については、[ロード時のデータ変換](../../loading/Etl_in_loading.md) をご参照ください。

例えば、`TEST` という名前のCSV形式のファイルをロードしたい場合、ファイルには `NO`、`DATE`、`VERSION`、`PRICE` の4つの列が含まれており、そのうち `DATE` 列のデータが202106.00のような非標準形式であるとします。StarRocksで `DATE` をパーティション列として使用したい場合は、まず、`NO`、`VERSION`、`PRICE`、`DATE` の4つの列からなるStarRocksテーブルを作成し、`DATE` 列のデータ型をDATE、DATETIME、またはINTに指定する必要があります。最後に、Stream Loadジョブを作成する際に、次の設定を読み込みコマンドまたはステートメントで指定する必要があります。これにより、ソースの `DATE` 列のデータ型を宛先列のデータ型に変換します。

```Plain
-H "columns: NO,DATE_1, VERSION, PRICE, DATE=LEFT(DATE_1,6)"
```

上記の例では、`DATE_1` は、一時的に名前が付けられた列で、宛先の `DATE` 列にマッピングされ、宛先の `DATE` 列にロードされる最終的な結果は、`left()` 関数によって計算されます。ソース列の一時的な名前を最初にリストし、その後、データの変換に関数を使用する必要があります。サポートされている関数は、非集計関数およびウィンドウ関数を含むスカラー関数です。

## 3. ストリームロードジョブが「body exceed max size: 10737418240, limit: 10737418240」エラーを報告した場合、どのように対処すればよいですか？

ソースデータファイルのサイズが10 GBを超えており、ストリームロードでサポートされている最大ファイルサイズです。次のいずれかの対処を行ってください。

- `seq -w 0 n` を使用して、ソースデータファイルをより小さいファイルに分割します。
- `curl -XPOST http:///be_host:http_port/api/update_config?streaming_load_max_mb=<file_size>` を使用して、[BE構成項目](../../administration/Configuration.md#configure-be-dynamic-parameters) `streaming_load_max_mb` の値を調整し、最大ファイルサイズを増やします。