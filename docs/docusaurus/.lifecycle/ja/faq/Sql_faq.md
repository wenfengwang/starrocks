---
displayed_sidebar: "日本語"
---

# SQL

このトピックでは、SQLに関するよくある質問に対する回答を提供します。

## マテリアライズドビューをビルドするときに、「メモリを割り当てることができません。」というエラーが発生する

この問題を解決するには、**be.conf**ファイルの`memory_limitation_per_thread_for_schema_change`パラメータの値を増やします。このパラメータは、スキーマを変更する単一のタスクに割り当てることができる最大ストレージを指します。デフォルトの最大ストレージの値は2 GBです。

## StarRocksはクエリ結果をキャッシュすることができますか？

StarRocksは直接最終的なクエリ結果をキャッシュしません。バージョン2.5以降から、StarRocksはクエリキャッシュ機能を使用して、最初の段階の集計の中間結果をキャッシュしています。以前のクエリと意味的に等価な新しいクエリは、キャッシュされた計算結果を再利用して計算を高速化することができます。クエリキャッシュはBEメモリを使用します。詳細については、[クエリキャッシュ](../using_starrocks/query_cache.md)を参照してください。

## 計算に`Null`が含まれる場合、ISNULL()関数を除いて関数の計算結果はfalseになります

標準SQLでは、`NULL`の値を含むオペランドを使用したすべての計算は`NULL`を返します。

## BIGINTデータ型の値を等価クエリの値に引用符で囲むとクエリ結果が正しくない理由は何ですか？

### 問題の説明

次の例を参照してください：

```plaintext
select cust_id,idno 

from llyt_dev.dwd_mbr_custinfo_dd 

where Pt= ‘2021-06-30’ 

and cust_id = ‘20210129005809043707’ 

limit 10 offset 0;
+---------------------+-----------------------------------------+

|   cust_id           |      idno                               |

+---------------------+-----------------------------------------+

|  20210129005809436  | yjdgjwsnfmdhjw294F93kmHCNMX39dw=        |

|  20210129005809436  | sdhnswjwijeifme3kmHCNMX39gfgrdw=        |

|  20210129005809436  | Tjoedk3js82nswndrf43X39hbggggbw=        |

|  20210129005809436  | denuwjaxh73e39592jwshbnjdi22ogw=        |

|  20210129005809436  | ckxwmsd2mei3nrunjrihj93dm3ijin2=        |

|  20210129005809436  | djm2emdi3mfi3mfu4jro2ji2ndimi3n=        |

+---------------------+-----------------------------------------+
select cust_id,idno 

from llyt_dev.dwd_mbr_custinfo_dd 

where Pt= ‘2021-06-30’ 

and cust_id = 20210129005809043707 

limit 10 offset 0;
+---------------------+-----------------------------------------+

|   cust_id           |      idno                               |

+---------------------+-----------------------------------------+

|  20210189979989976  | xuywehuhfuhruehfurhghcfCNMX39dw=        |

+---------------------+-----------------------------------------+
```

### 解決策

STRINGデータ型とINTEGERデータ型を比較する場合、これら2つのタイプのフィールドはDOUBLEデータ型にキャストされます。したがって、引用符を追加することはできません。それ以外の場合、WHERE句で定義された条件がインデックス化されません。

## StarRocksはDECODE関数をサポートしていますか？

StarRocksはOracleデータベースのDECODE関数をサポートしていません。StarRocksはMySQLと互換性があるため、CASE WHENステートメントを使用することができます。

## StarRocksのプライマリキーテーブルにデータをロードした直後に最新のデータをクエリできますか？

はい。StarRocksはGoogle Mesaを参照する方法でデータをマージします。StarRocksでは、BEがデータマージをトリガーし、データマージには2種類のコンパクションがあります。データマージが完了していない場合、クエリ中に完了します。したがって、データをロードした直後に最新のデータを読み取ることができます。

## StarRocksに格納されているutf8mb4文字は切り捨てられるか、または文字化けしますか？

いいえ。

## `alter table`コマンドを実行すると「テーブルの状態が正常ではありません」というエラーが発生します

このエラーは、以前の変更が完了していないために発生します。次のコードを実行して前の変更の状態を確認できます：

```SQL
show tablet from lineitem where State="ALTER"; 
```

変更操作にかかる時間はデータのボリュームに関連しています。一般的に、変更は数分で完了します。StarRocksのテーブルを変更している間はデータをロードしないことをお勧めします。データのロードは変更の完了速度を低下させるためです。

## Apache Hiveの外部テーブルをクエリする際に「org.apache.doris.common.DdlException: get hive partition meta data failed: java.net.UnknownHostException:hadooptest」エラーが発生します

このエラーは、Apache Hiveのパーティションのメタデータを取得できない場合に発生します。この問題を解決するには、**core-sit.xml**と**hdfs-site.xml**を**fe.conf**ファイルと**be.conf**ファイルにコピーします。

## データをクエリする際に「planner use long time 3000 remaining task num 1」というエラーが発生します

このエラーは、通常はフルガベージコレクション（full GC）によって発生します。バックエンドの監視や**fe.gc**ログを使用して確認することができます。この問題を解決するには、次のいずれかの操作を行います：

- SQLのクライアントが複数のフロントエンド（FE）に同時にアクセスできるようにして、負荷を分散させます。
- Java Virtual Machine（JVM）のヒープサイズを**fe.conf**ファイルで8 GBから16 GBに変更して、メモリを増やしフルGCの影響を軽減します。

## 列Aのカーディナリティが小さい場合、`select B from tbl order by A limit 10`のクエリ結果が毎回異なります

SQLは列Aが順序付けられていることを保証できますが、列Bの順序が各クエリごとに同じであることを保証することはできません。MySQLは独立したデータベースであるため、列Aと列Bの順序を保証することができます。

StarRocksは分散データベースであり、基礎テーブルに格納されているデータはシャーディングパターンに従っています。列Aのデータは複数のマシンに分散されているため、複数のマシンから返される列Bの順序はクエリごとに異なる場合があります。これにより、各クエリ毎にBの順序が一貫しない結果となります。この問題を解決するには、`select B from tbl order by A,B limit 10`を`select B from tbl order by A,B limit 10`に変更します。

## SELECT *とSELECTの効率の違いはなぜ大きな差があるのですか？

この問題を解決するには、プロファイルを確認しMERGEの詳細を確認します：

- ストレージ層での集計が時間を多く取るかどうかを確認します。

- インジケーターカラムが多すぎる場合は調べます。1000万行の数百のカラムを集計する場合。

```plaintext
MERGE:

    - aggr: 26s270ms

    - sort: 15s551ms
```

## DELETEはネストした関数をサポートしますか？

ネストした関数はサポートされていません。たとえば、`DELETE from test_new WHERE to_days(now())-to_days(publish_time) >7;`内の`to_days(now())`を含むようなネストした関数はサポートされていません。

## データベースに数百のテーブルがある場合、使用効率を向上させる方法は？

効率を向上させるために、MySQLのクライアントサーバーに接続する際に`-A`パラメータを追加します：`mysql -uroot -h127.0.0.1 -P8867 -A`。MySQLのクライアントサーバーはデータベース情報を事前に読み込みません。

## BEログとFEログが占有するディスク容量を減らす方法は？

ログレベルとそれに対応するパラメータを調整します。詳細については、[パラメータ設定](../administration/Configuration.md)を参照してください。

## 単一のテーブルのレプリケーション数を変更すると「table *** is colocate table, cannot change replicationNum」というエラーが発生します

共置テーブルを作成する場合、`group`プロパティを設定する必要があります。そのため、単一のテーブルのレプリケーション数を変更することはできません。グループ内のすべてのテーブルのレプリケーション数を変更するために、次の手順を実行します：

1. グループ内のすべてのテーブルの`group_with`を`empty`に設定します。
2. グループ内のすべてのテーブルに適切な`replication_num`を設定します。
3. `group_with`を元の値に戻します。

## VARCHARを最大値に設定することでストレージに影響がありますか？

VARCHARは可変長データ型であり、実際のデータ長に基づいて長さが変更されるデータ型です。テーブルを作成する際に異なるvarchar長を指定しても、同じデータに対するクエリパフォーマンスにはほとんど影響しません。

## テーブルを切り捨てると「create partititon timeout」というエラーが発生します

テーブルを切り取るには、対応するパーティションを作成してからスワップする必要があります。作成する必要のあるパーティションが多い場合、このエラーが発生します。また、多数のデータロードタスクがある場合、コンパクションプロセス中にロックが長時間維持されます。したがって、テーブルを作成する際にロックが獲得できなくなります。データロードタスクが多い場合は、**be.conf**ファイルで`tablet_map_shard_size`を`512`に設定して、ロックの競合を減らすことができます。

## Apache Hiveの外部テーブルにアクセスする際に「Failed to specify server's Kerberos principal name」というエラーが発生します
**hdfs-site.xml**ファイルの**fe.conf**と**be.conf**に以下の情報を追加してください：

```HTML
<property>

<name>dfs.namenode.kerberos.principal.pattern</name>

<value>*</value>

</property>
```

## "2021-10"はStarRocksで日付形式ですか？

いいえ。

## "2021-10"をパーティションフィールドとして使用できますか？

いいえ、"2021-10"を"2021-10-01"に変更する関数を使用してから、"2021-10-01"をパーティションフィールドとして使用してください。

## StarRocksのデータベースやテーブルのサイズをクエリする場所はどこですか？

[SHOW DATA](../sql-reference/sql-statements/data-manipulation/SHOW_DATA.md)コマンドを使用できます。

`SHOW DATA;`は現在のデータベースのすべてのテーブルのデータサイズとレプリカを表示します。

`SHOW DATA FROM <db_name>.<table_name>;`は指定したデータベースの指定したテーブルのデータサイズ、レプリカの数、行数を表示します。