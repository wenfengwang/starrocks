---
displayed_sidebar: "Japanese"
---

# SQL

このトピックでは、SQLに関するよくある質問について回答します。

## マテリアライズドビューをビルドする際に「メモリを割り当てることができません。」というエラーが発生する場合

この問題を解決するには、**be.conf**ファイル内の`memory_limitation_per_thread_for_schema_change`パラメータの値を増やしてください。このパラメータは、スキーマ変更のために割り当てられる最大ストレージを示します。最大ストレージのデフォルト値は2 GBです。

## StarRocksはクエリ結果をキャッシュしますか？

StarRocksは直接最終クエリ結果をキャッシュしません。v2.5以降、StarRocksはクエリキャッシュ機能を使用して、第一段階の集計の中間結果をキャッシュに保存します。以前のクエリと意味的に等価な新しいクエリは、計算を加速させるためにキャッシュされた計算結果を再利用します。クエリキャッシュはBEメモリを使用します。詳細については、[クエリキャッシュ](../using_starrocks/query_cache.md)を参照してください。

## 計算に`NULL`が含まれる場合、ISNULL()関数以外の関数の計算結果が誤っています

標準SQLでは、`NULL`値を含むオペランドを含むすべての計算は`NULL`を返します。

## BIGINTデータ型の値に引用符を付けて等価クエリを実行した場合、クエリ結果が正しくありません。なぜですか？

### 問題の説明

次の例を参照してください：

```plaintext
select cust_id,idno 

from llyt_dev.dwd_mbr_custinfo_dd 

where Pt= ‘2021-06-30’ 

and cust_id = ‘20210129005809043707’ 

limit 10 offset 0;
+---------------------+-----------------------------------------+

|   cust_id           |      idno                               |

+---------------------+-----------------------------------------+

|  20210129005809436  | yjdgjwsnfmdhjw294F93kmHCNMX39dw=        |

|  20210129005809436  | sdhnswjwijeifme3kmHCNMX39gfgrdw=        |

|  20210129005809436  | Tjoedk3js82nswndrf43X39hbggggbw=        |

|  20210129005809436  | denuwjaxh73e39592jwshbnjdi22ogw=        |

|  20210129005809436  | ckxwmsd2mei3nrunjrihj93dm3ijin2=        |

|  20210129005809436  | djm2emdi3mfi3mfu4jro2ji2ndimi3n=        |

+---------------------+-----------------------------------------+
select cust_id,idno 

from llyt_dev.dwd_mbr_custinfo_dd 

where Pt= ‘2021-06-30’ 

and cust_id = 20210129005809043707 

limit 10 offset 0;
+---------------------+-----------------------------------------+

|   cust_id           |      idno                               |

+---------------------+-----------------------------------------+

|  20210189979989976  | xuywehuhfuhruehfurhghcfCNMX39dw=        |

+---------------------+-----------------------------------------+
```

### 解決策

STRINGデータ型とINTEGERデータ型を比較すると、これら2つのタイプのフィールドがDOUBLEデータ型にキャストされます。そのため、引用符を追加することはできません。さもないと、WHERE句で定義された条件がインデックス化されません。

## StarRocksはDECODE関数をサポートしていますか？

StarRocksはOracleデータベースのDECODE関数をサポートしていません。StarRocksはMySQLと互換性があるため、CASE WHEN文を使用できます。

## StarRocksのプライマリキーテーブルにデータをロードした直後に最新データをクエリできますか？

はい。StarRocksはGoogle Mesaを参照する方法でデータをマージします。StarRocksでは、BEがデータマージをトリガし、2つの種類のコンパクションでデータをマージします。データマージが完了していない場合、クエリ実行中に完了します。そのため、データロード後すぐに最新データを読み取ることができます。

## StarRocksに保存されたutf8mb4文字は切り捨てられたり文字化けが発生しますか？

いいえ。

## `alter table`コマンドを実行すると「テーブルの状態が正常ではありません」というエラーが発生します

このエラーは、以前の変更が完了していないために発生します。以下のコードを実行して、以前の変更の状態を確認できます：

```SQL
show tablet from lineitem where State="ALTER"; 
```

変更操作にかかる時間はデータ量に関連しています。通常、変更は数分で完了します。テーブルの変更中にStarRocksにデータをロードしないようにお勧めします。データのロードは変更のスピードを遅くします。

## Apache Hiveの外部テーブルをクエリする際に「get partition detail failed: org.apache.doris.common.DdlException: get hive partition meta data failed: java.net.UnknownHostException:hadooptest」というエラーが発生します

このエラーは、Apache Hiveパーティションのメタデータを取得できない場合に発生します。この問題を解決するには、**core-sit.xml**と**hdfs-site.xml**を**fe.conf**ファイルと**be.conf**ファイルにコピーしてください。

## データをクエリする際に「planner use long time 3000 remaining task num 1」というエラーが発生します

このエラーは通常、フルガベージコレクション（full GC）によって発生します。バックエンドの監視と**fe.gc**ログを使用して確認できます。この問題を解決するには、次のいずれかの操作を実行してください：

- SQLのクライアントが複数のフロントエンド（FE）に同時にアクセスできるようにし、負荷を分散させます。
- Java仮想マシン（JVM）のヒープサイズを**fe.conf**ファイルで8 GBから16 GBに変更して、メモリを増やしてフルGCの影響を減らします。

## 列Aの基数が小さい場合、「select B from tbl order by A limit 10」というクエリの結果が毎回異なります

SQLは列Aが順序付けられていることだけを保証し、列Bの順序が各クエリごとに同じであることは保証できません。MySQLはスタンドアロンのデータベースであるため、列Aと列Bの順序を保証できます。

StarRocksは分散データベースであり、基礎テーブルに保存されているデータはシャーディングパターンに従っています。列Aのデータは複数のマシンに分散されているため、複数のマシンから返された列Bの順序がクエリごとに異なる可能性があり、その結果、Bの順序が毎回一致しないことがあります。この問題を解決するには、「select B from tbl order by A,B limit 10」に変更してください。

## SELECT * と SELECTの列効率に大きな差があるのはなぜですか？

この問題を解決するには、プロファイルをチェックしてMERGEの詳細を確認してください：

- ストレージレイヤーの集計に時間がかかりすぎていないかどうかを確認してください。 

- 指標列が多すぎる場合に億単位の行の数百の列を集計していないかを確認してください。

```plaintext
MERGE:

    - aggr: 26s270ms

    - sort: 15s551ms
```

## DELETEはネストされた関数をサポートしていますか？

ネストされた関数はサポートされていません。例えば、`DELETE from test_new WHERE to_days(now())-to_days(publish_time) >7;`内の`to_days(now())`のようなネストされた関数はサポートされません。

## データベースに数百のテーブルがある場合、効率を改善する方法は？

効率を向上させるには、MySQLのクライアントサーバに接続する際に`-A`パラメータを追加してください：`mysql -uroot -h127.0.0.1 -P8867 -A`。MySQLのクライアントサーバは、事前にデータベース情報を読み込まないようにします。

## BEログとFEログが占有するディスクスペースを減らす方法は？

ログレベルと対応するパラメータを調整してください。詳細については、[Parameter Configuration](../administration/Configuration.md)を参照してください。

## 単一のテーブルのレプリケーション数を変更しようとすると「table *** is colocate table, cannot change replicationNum」というエラーが発生します

コロケートされたテーブルを作成する際に、`group`プロパティを設定する必要があります。そのため、単一のテーブルのレプリケーション数を変更することはできません。グループ内のすべてのテーブルのレプリケーション数を変更するには、次の手順を実行できます：

1. グループ内のすべてのテーブルの`group_with`を `empty` に設定してください。
2. グループ内のすべてのテーブルに適切な `replication_num` を設定してください。
3. `group_with` を元の値に戻してください。

## VARCHARを最大値に設定するとストレージに影響しますか？

VARCHARは可変長のデータ型であり、指定した長さは実際のデータ長に基づいて変更できます。テーブル作成時に異なるvarchar長を指定することは、同じデータに対するクエリのパフォーマンスにほとんど影響しません。

## テーブルを切り捨てる際に「create partititon timeout」というエラーが発生します

テーブルを切り捨てるには、対応するパーティションを作成し、その後スワップする必要があります。多数のパーティションを作成する必要がある場合、このエラーが発生します。また、多数のデータロードタスクがある場合、コンパクション中にロックが長時間保持されます。そのため、テーブルの作成時にロックを取得できません。多数のデータロードタスクがある場合は、**be.conf**ファイルで`tablet_map_shard_size`を`512`に設定して、ロックの競合を減らしてください。

## Apache Hiveの外部テーブルにアクセスする際に「Failed to specify server's Kerberos principal name」というエラーが発生します
**fe.conf**ファイルと**be.conf**ファイルに次の情報を**hdfs-site.xml**に追加してください：

```HTML
<property>

<name>dfs.namenode.kerberos.principal.pattern</name>

<value>*</value>

</property>
```

## "2021-10"はStarRocksの日付形式ですか？

いいえ。

## "2021-10"をパーティションフィールドとして使用できますか？

いいえ、「2021-10」を「2021-10-01」と変換する関数を使用し、その後「2021-10-01」をパーティションフィールドとして使用します。

## StarRocksのデータベースやテーブルのサイズをどこでクエリできますか？

[SHOW DATA](../sql-reference/sql-statements/data-manipulation/SHOW_DATA.md)コマンドを使用できます。

`SHOW DATA;`は現在のデータベースのすべてのテーブルのデータサイズとレプリカを表示します。

`SHOW DATA FROM <db_name>.<table_name>;`は指定されたデータベースの指定されたテーブルのデータサイズ、レプリカの数、行数を表示します。