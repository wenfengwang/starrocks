---
displayed_sidebar: "Japanese"
---

# 機能

StarRocksは、スケールの大きなデータ上で高速かつリアルタイムな分析体験を実現するための豊富な機能を提供しています。

## MPPフレームワーク

StarRocksは、大規模並列処理（MPP）フレームワークを採用しています。クエリリクエストは複数の物理処理ユニットに分割され、複数のマシンで並列実行されます。各マシンには専用のCPUとメモリリソースがあります。MPPフレームワークは、すべてのCPUコアとマシンのリソースを最大限に活用します。クラスタが拡張されるにつれて、単一のクエリのパフォーマンスは持続的に向上します。

![MPP](../assets/1.1-3-mpp.png)

上の図では、StarRocksはSQLステートメントをセマンティクスに基づいて複数の論理実行ユニット（クエリフラグメント）に解析します。各フラグメントは、計算の複雑さに基づいて1つまたは複数の物理実行ユニット（フラグメントインスタンス）によって実装されます。物理実行ユニットは、StarRocksでの最小のスケジューリング単位です。実行ユニットはバックエンド（BE）にスケジュールされ、実行されます。1つの論理実行ユニットには、スキャン、プロジェクト、集約などのオペレータが含まれる場合があります（図の右側に表示されています）。各物理実行ユニットはデータの一部のみを処理し、結果はマージされて最終的なデータが生成されます。**論理実行ユニットの並行実行により、すべてのCPUコアと物理マシンのリソースを最大限に活用し、クエリのスピードを向上させます。**

![MPP](../assets/1.1-4-mpp.png)

他の多くのデータ分析システムで使用されるScatter-Gatherフレームワークとは異なり、MPPフレームワークはより多くのリソースを利用してクエリリクエストを処理できます。Scatter-Gatherフレームワークでは、最終的なマージ操作を行えるのはギャザーノードだけです。MPPフレームワークでは、データは複数のノードにシャッフルされてマージ操作が行われます。高カーディナリティフィールドや大規模テーブルの結合などの複雑なクエリでは、StarRocksのMPPフレームワークはScatter-Gatherフレームワークに比べて明らかなパフォーマンスの利点があります。

## フルベクトル化実行エンジン

フルベクトル化実行エンジンは、CPUの処理能力をより効率的に利用するために、データを列単位で整理・処理するエンジンです。具体的には、StarRocksはデータを列単位で保存し、メモリ上でデータを整理し、SQLオペレータを列単位で計算します。列単位の整理は、CPUキャッシュを最大限に活用します。列単位の計算は、仮想関数呼び出しと分岐判断の数を減らすため、より効率的なCPU命令フローを実現します。

ベクトル化実行エンジンは、SIMD命令も最大限に活用します。このエンジンは、より少ない命令でより多くのデータ操作を完了することができます。標準的なデータセットに対するテストでは、このエンジンによりオペレータの全体的なパフォーマンスが3倍から10倍向上します。

オペレータのベクトル化に加えて、StarRocksではクエリエンジンの他の最適化も実装されています。例えば、StarRocksはエンコードされたデータ上でオペレータを直接実行するための「エンコードデータによる操作 (Operation on Encoded Data)」技術を使用しています。これにより、デコードの必要なしにエンコードされた文字列上でオペレータを直接実行できます。これにより、SQLの複雑さが著しく低減し、クエリのスピードが2倍以上向上します。

## ストレージと計算の分離

[ストレージと計算の分離アーキテクチャ](./Architecture.md)は、3.0から導入されました。このアーキテクチャでは、計算とストレージを切り離してリソースの分離、コンピュートノードの弾力的なスケーリング、高パフォーマンスなクエリを実現します。ストレージと計算の分離により、StarRocksはより柔軟性があり、高いパフォーマンスとデータの可用性、そして低いコストを実現します。

![shared-data](../assets/share_data_arch.png)

ストレージと計算の分離モードでは、計算とストレージを切り離して独立してスケーリングすることができます。これにより、ストレージと計算の結合モードでは計算ノードを追加するたびにストレージをスケーリングする必要があるというコストを解消します。さらに、計算は数秒以内に動的にスケールすることができ、特にトラフィックのピークと谷が顕著な場合にリソースの利用効率が向上します。

ストレージ層では、オブジェクトストレージのほぼ無制限の容量と高い信頼性を活用して、大量のデータのストレージとデータの永続化を実現します。StarRocksは、AWS S3やGoogle Cloud Storage、Azure Blob Storage、HDFSなどのさまざまなオブジェクトストレージシステム、およびMinIOなどの他のS3互換ストレージと連携することができます。

ユーザーは、StarRocksをパブリッククラウド、プライベートクラウド、またはオンプレミスのデータセンターに展開することができます。StarRocksは、Kubernetesベースの展開をサポートし、ストレージと計算が分離されたクラスターの自動デプロイメントのためのOperatorを提供します。

ストレージと計算の分離モードのStarRocksは、ストレージと計算が結合されたモードと同様の機能を提供します。データの書き込みやホットデータのクエリパフォーマンスも同じです。ユーザーはストレージと計算が結合されたモードと同様に、データの更新、データレイク分析、マテリアライズドビューアクセラレーションなどを実行することができます。

ストレージと計算が分離されたStarRocksクラスターを展開する方法については、[共有データクラスターの展開](../deployment/shared_data/s3.md)を参照してください。

## コストベースの最適化

![CBO](../assets/1.1-5-cbo.png)

複数のテーブルの結合クエリのパフォーマンスは最適化が難しいものです。実行エンジンだけでは優れたパフォーマンスを提供することはできません。なぜなら、実行計画の複雑さは複数のオーダーにわたる場合があります。関連テーブルが多くなるほど、実行計画も増えるため、最適な計画を選択するのはNP困難な状況です。効率的なマルチテーブル分析のためには、優れたクエリ最適化技術が必要です。

StarRocksは、ゼロから新しい[CBO (Cost-based optimizer)](../using_starrocks/Cost_based_optimizer.md)を設計しています。このCBOはカスケードのようなフレームワークを採用しており、ベクトル化実行エンジンに特化した最適化とイノベーションを組み合わせています。これらの最適化には共通テーブル式（CTE）の再利用、サブクエリの書き換え、Lateral Join、Join Reorder、分散Join実行の戦略選択、および低基数最適化が含まれます。CBOは合計99のTPC-DS SQLステートメントをサポートしています。

CBOにより、特に複雑なマルチテーブル結合クエリにおいて、StarRocksは競合他社よりも優れたパフォーマンスを提供することができます。

## リアルタイムで更新可能な列指向型ストレージエンジン

StarRocksは、同じタイプのデータを連続して保存できる列指向型ストレージエンジンです。列指向型ストレージでは、データをより効率的な方法でエンコードすることができます。このエンコードにより、圧縮率が増加し、ストレージコストが低下します。列指向型ストレージはまた、合計データ読み込みI/Oの削減にもつながり、クエリのパフォーマンスが向上します。また、ほとんどのOLAPのシナリオでは、特定の列のみがクエリ対象となります。列指向型ストレージにより、ユーザーは一部の列のみをクエリできるため、ディスクI/Oを大幅に削減することができます。

StarRocksは、数秒でデータをロードしてリアルタイムの分析を行うことができます。StarRocksのストレージエンジンは、各データ投入操作の原子性、一貫性、独立性、耐久性（ACID）を保証します。データのロードトランザクションでは、トランザクション全体が成功するか失敗します。同時トランザクションは互いに影響しませんので、トランザクションレベルの分離性が提供されます。

StarRocksのストレージエンジンは、効率的な部分更新やUpsert操作が可能なDelete-and-insertパターンを使用しています。ストレージエンジンはプライマリキーインデックスを使用してデータを効率的にフィルタリングし、データ読み取り時のソートやマージ操作を不要にします。また、セカンダリインデックスをフル活用することも可能です。これにより、巨大なデータの更新においても高速で予測可能なクエリのパフォーマンスを提供します。

## インテリジェントなマテリアライズドビュー

StarRocksは、インテリジェントな[マテリアライズドビュー](../using_starrocks/Materialized_view.md)を使用してクエリとデータウェアハウスのレイヤー化を高速化します。StarRocksのマテリアライズドビューは、他の類似製品のマテリアライズドビューとは異なり、ベーステーブルとのデータ同期を手動で行う必要がありません。マテリアライズドビューは、ベーステーブルのデータ変更に応じてデータを自動的に更新し、追加のメンテナンス操作を必要としません。さらに、マテリアライズドビューの選択も自動化されています。StarRocksがクエリのパフォーマンス向上のために適切なマテリアライズドビュー（MV）を特定した場合、自動的にクエリをMVを利用するように書き換えます。このインテリジェントなプロセスにより、手動の介入なしでクエリの効率が大幅に向上します。

StarRocksのMVは、伝統的なETLデータモデリングプロセスを代替することができます。データ処理を上流のアプリケーションで変換する代わりに、MVを使用してデータを変換するオプションが提供されます。これにより、データ処理パイプラインをシンプルにすることができます。

例えば、図に示すように、データレイク上の生データを外部MVに基づいて正規化されたテーブルを作成することができます。正規化されたテーブルから非同期マテリアライズドビューを介して非正規化されたテーブルを作成することもできます。正規化されたテーブルからさらに他のMVを作成し、高同時クエリとより良いクエリのパフォーマンスをサポートすることもできます。

![MV](../assets/1.1-7-mv.png)

## データレイク分析

![DLA](../assets/1.1-8-dla.png)

ローカルデータの効率的な分析に加えて、StarRocksはApache Hive、Apache Iceberg、Apache Hudi、Delta Lakeなどの[データレイク](../data_source/catalog/catalog_overview.md)に格納されているデータを分析するためのコンピュートエンジンとしても機能します。StarRocksの重要な機能の1つは、外部カタログです。外部カタログは外部で管理されるメタストアとの連携を提供します。この機能により、データの移行を必要とせずにユーザーはシームレスに外部データソースをクエリすることができます。そのため、HDFSやAmazon S3などのさまざまなシステムや、Parquet、ORC、CSVなどのさまざまなファイル形式など、さまざまなシステムからのデータを分析することができます。

上の図は、データレイクの分析シナリオを示しており、StarRocksがデータの計算と分析を担当し、データレイクがデータのストレージ、組織、およびメンテナンスを担当しています。データレイクは、さまざまなBI、AI、アドホック、レポートなどのユースケースにおける「単一の真実のソース」のレポートを生成するために、オープンストレージフォーマットでデータを保存し、柔軟なスキーマを使用します。StarRocksは、ベクトル化エンジンとCBOの利点を最大限に活用し、データレイク分析のパフォーマンスを大幅に向上させます。